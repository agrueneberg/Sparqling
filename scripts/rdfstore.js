(function(){typeof console=="undefined"&&(console={log:function(){}});var v={"extends":function(a,b){b.prototype=new a},stackCounterLimit:1E3,stackCounter:0};v.recur=function(a){v.stackCounter===v.stackCounterLimit?(v.stackCounter=0,setTimeout(a,0)):(v.stackCounter++,a())};v.clone=function(a){return JSON.parse(JSON.stringify(a))};v.shuffle=function(a){for(var b,e,c=a.length;c;b=parseInt(Math.random()*c),e=a[--c],a[c]=a[b],a[b]=e);return a};v.include=function(a,b,e){for(var c=a.length-1;c>=0;c--){var h=
!1,h=e==null?a[c]===b:e(a[c],b)===0;if(h===!0)return!0}return!1};v.remove=function(a,b){for(var e=[],c=0;c<a.length;c++)a[c]!==b&&e.push(a[c]);return e};v.repeat=function(a,b,e,c,h){arguments.length===4&&(h={});a<b?(h._i=a,e(function(e,h){v.recur(function(){v.repeat(a+1,b,e,c,h)})},h)):c(h)};v.meanwhile=function(a,b,e,c){arguments.length===3&&(c={});c._stack_counter==null&&(c._stack_counter=0);a===!0?b(function(a,b,c){c._stack_counter%40==39?(c._stack_counter+=1,setTimeout(function(){v.neanwhile(a,
b,e,c)},0)):(c._stack_counter+=1,v.meanwhile(a,b,e,c))},c):e(c)};v.seq=function(){var a=arguments;return function(b){v.repeat(0,a.length,function(e,b){var h=arguments.callee;a[b._i](function(){e(h,b)})},function(){b()})}};v.partition=function(a,b){for(var e=a.length%b,c=[],h=0;h<e;h++)c.push(null);e=[];for(h=0;h<a.length;h++)c.push(a[h]),c.length%b==0&&(e.push(c),c=[]);return e};v.keys=function(a){var b=[],e;for(e in a)b.push(e);return b};v.iso8601=function(a){function b(a){return a<10?"0"+a:a}return a.getUTCFullYear()+
"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"Z"};v.parseStrictISO8601=function(a){var b=a.match(RegExp("([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?")),a=0,e=new Date(b[1],0,1);if(b[3])e.setMonth(b[3]-1);else throw"missing ISO8061 component";if(b[5])e.setDate(b[5]);else throw"missing ISO8061 component";if(b[7])e.setHours(b[7]);else throw"missing ISO8061 component";
if(b[8])e.setMinutes(b[8]);else throw"missing ISO8061 component";if(b[10])e.setSeconds(b[10]);else throw"missing ISO8061 component";b[12]&&e.setMilliseconds(Number("0."+b[12])*1E3);b[14]&&(a=Number(b[16])*60+Number(b[17]),a*=b[15]=="-"?1:-1);a-=e.getTimezoneOffset();b=new Date;b.setTime(Number(Number(e)+a*6E4));return b};v.parseISO8601=function(a){var b=a.match(RegExp("([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?")),a=
0,e=new Date(b[1],0,1);b[3]&&e.setMonth(b[3]-1);b[5]&&e.setDate(b[5]);b[7]&&e.setHours(b[7]);b[8]&&e.setMinutes(b[8]);b[10]&&e.setSeconds(b[10]);b[12]&&e.setMilliseconds(Number("0."+b[12])*1E3);b[14]&&(a=Number(b[16])*60+Number(b[17]),a*=b[15]=="-"?1:-1);a-=e.getTimezoneOffset();b=new Date;b.setTime(Number(Number(e)+a*6E4));return b};v.parseISO8601Components=function(a){var a=a.match(RegExp("([0-9]{4})(-([0-9]{2}))(-([0-9]{2}))(T([0-9]{2}):([0-9]{2})(:([0-9]{2}))?(.([0-9]+))?)?(Z|([-+])([0-9]{2})(:([0-9]{2}))?)?")),
b,e,c,h,f,g,n,i;b=Number(a[1]);e=a[3]-1;c=Number(a[5]);h=Number(a[7]);f=Number(a[8]);g=Number(a[10]);a[12]&&(n=Number("0."+a[12])*1E3);a[13]==="Z"?i=0:a[14]?(i=0,a[17]&&(i=Number(a[17])),i+=Number(a[15])*60,i*=a[14]=="-"?-1:1):a[14]==null&&a[11]&&(i=Number(a[12])*60);return{year:isNaN(b)?null:b,month:isNaN(e)?null:e,date:isNaN(c)?null:c,hours:isNaN(h)?null:h,minutes:isNaN(f)?null:f,seconds:isNaN(g)?null:g,millisecs:isNaN(n)?null:n,timezone:isNaN(i)?null:i}};v.compareDateComponents=function(a,b){var e=
v.parseISO8601Components(a),c=v.parseISO8601Components(b);if(e.timezone==null&&c.timezone==null||e.timezone!=null&&c.timezone!=null)return e=v.parseISO8601(a),c=v.parseISO8601(b),e.getTime()==c.getTime()?0:e.getTime()<c.getTime()?-1:1;else if(e.timezone!=null&&c.timezone==null){var e=v.parseISO8601(a),c=v.parseISO8601(b),e=e.getTime(),c=c.getTime(),h=50400;return e<c&&e<c+h?-1:e>c&&e>c-h?1:null}else return e=v.parseISO8601(a),c=v.parseISO8601(b),e=e.getTime(),c=c.getTime(),h=50400,e<c&&e+h<c?-1:e>
c&&e+h>c?1:null};v.lexicalFormLiteral=function(a,b){var e=a.value,c=a.lang,h=a.type,f=null;if(e!=null&&h!=null&&typeof h!="string"){e=h.value;if(e==null)e=h.suffix,h=b.namespaces[h.prefix],a.type=h+e,e=h+e;f=e.indexOf("hexBinary")!=-1?'"'+a.value.toLowerCase()+'"^^<'+e+">":'"'+a.value+'"^^<'+e+">"}else f=c==null&&h==null?'"'+e+'"':h==null?'"'+e+'"@'+c:h.indexOf("hexBinary")!=-1?'"'+a.value.toLowerCase()+'"^^<'+h+">":'"'+a.value+'"^^<'+h+">";return f};v.lexicalFormBaseUri=function(a,b){var e=null;
if(a.value==null)var e=a.prefix,c=a.suffix,h=b.namespaces[e],e=h!=null?h+c:e+":"+c;else e=a.value;if(e===null)return null;else e.indexOf(":")==-1&&(e=(b.base||"")+e);return e};v.lexicalFormTerm=function(a,b){if(a.token==="uri")return{uri:v.lexicalFormBaseUri(a,b)};else if(a.token==="literal")return{literal:v.lexicalFormLiteral(a,b)};else if(a.token==="blank")return{blank:"_:"+a.value};else throw"Error, cannot get lexical form of unknown token: "+a.token;};v.normalizeUnicodeLiterals=function(a){for(var b=
a.match(/\\u[0-9abcdefABCDEF]{4,4}/g)||[],e={},c=0;c<b.length;c++)e[b[c]]==null&&(e[b[c]]=!0,a=a.replace(RegExp("\\"+b[c],"g"),eval("'"+b[c]+"'")));return a};v.hashTerm=function(a){try{if(a==null)return"";if(a.token==="uri")return"u"+a.value;else if(a.token==="blank")return"b"+a.value;else if(a.token==="literal"){var b="l"+a.value;b+=a.type||"";b+=a.lang||"";return b}}catch(e){if(typeof a==="object"){b="";for(p in a)b=b+p+a[p];return b}return a}};var pa={PriorityQueue:function(a){var b=[],e={},c=
!1,h,f=a.maxSize||10;h=function(a,b){return e[b].priority-e[a].priority};var g=function(){b.sort(h);c=!0};return{debugContents:b,debugStore:e,debugSort:g,push:function(a,h){if(b.length===f){c||g();if(e[a]==null){delete e[b[0]];b[0]=a;var i=e[b[b.length-1]].priority-1;e[a]={object:h,priority:i}}else i=e[b[b.length-1]].priority-1,e[a].priority=i;c=!1}else b.length===0?(b.push(a),e[a]={object:h,priority:1E3}):(i=e[b[b.length-1]].priority-1,e[a]==null?(e[a]={object:h,priority:i},b.push(a)):(e[a].priority=
i,c=!1))},remove:function(a){if(e[a]!=null){delete e[a];for(var h=null,c=0;c<b.length;c++)if(b[c]===a){h=c;break}h!=null&&b.splice(h,1)}},fetch:function(a){var h=e[a];return e[a]!=null?(c||g(),e[a].priority=e[b[b.length-1]].priority-1,c=!1,h.object):null}}}},G={};G.Tree=function(a,b,e,c){if(arguments.length!=0){var h=null;if(e===!0)try{if(h=window.localStorage,h==null)throw"not found";}catch(f){throw"Local storage is not present, cannot create persistent storage";}h==null&&(h=function(){var a={};
return{setItem:function(e,b){a[e]=b},getItem:function(e){return a[e]||null},removeItem:function(e){delete a[e]},get:function(e){var b=0,h;for(h in a){if(e===b)return h;b++}return""},length:a.length}}());this.storage=h;this.order=a;this.name=b;this.diskManager=new G.LocalStorageManager(b,h,c);this.root=this.diskManager._readRootNode();this.root==null?(this.root=this._allocateNode(),this.root.isLeaf=!0,this.root.level=0,this._diskWrite(this.root),this._updateRootNode(this.root),this.root=this.root.pointer):
this.root=this.diskManager._diskRead(this.root).pointer;this.comparator=function(a,e){return a<e?-1:a>e?1:0};this.merger=null}};G.Tree.prototype._allocateNode=function(){return new G.Node};G.Tree.prototype._diskWrite=function(a){this.diskManager._diskWrite(a)};G.Tree.prototype._diskRead=function(a){return this.diskManager._diskRead(a)};G.Tree.prototype._diskDelete=function(a){this.diskManager._diskDelete(a)};G.Tree.prototype._updateRootNode=function(a){this.diskManager._updateRootNode(a);return a};
G.Tree.prototype.search=function(a,b){for(var e=!0,c=this._diskRead(this.root);e;){for(var h=0;h<c.numberActives&&this.comparator(a,c.keys[h].key)===1;)h++;if(h<c.numberActives&&this.comparator(c.keys[h].key,a)===0)return b!=null&&b==!0?!0:c.keys[h].data;else c.isLeaf===!0?e=!1:c=this._diskRead(c.children[h])}return null};G.Tree.prototype.walk=function(a){this._walk(a,this._diskRead(this.root))};G.Tree.prototype._walk=function(a,b){if(b.isLeaf)for(var e=0;e<b.numberActives;e++)a(b.keys[e]);else{for(e=
0;e<b.numberActives;e++)this._walk(a,this._diskRead(b.children[e])),a(b.keys[e]);this._walk(a,this._diskRead(b.children[b.numberActives]))}};G.Tree.prototype.walkNodes=function(a){this._walkNodes(a,this._diskRead(this.root))};G.Tree.prototype._walkNodes=function(a,b){if(b.isLeaf)a(b);else{a(b);for(var e=0;e<b.numberActives;e++)this._walkNodes(a,this._diskRead(b.children[e]));this._walkNodes(a,this._diskRead(b.children[b.numberActives]))}};G.Tree.prototype._splitChild=function(a,b,e){var c=this._allocateNode();
c.isLeaf=e.isLeaf;c.level=e.level;c.numberActives=this.order-1;var h=e.keys[this.order-1];e.keys[this.order-1]=null;for(var f=0;f<this.order-1;f++)c.keys[f]=e.keys[f+this.order],e.keys[f+this.order]=null,e.isLeaf||(c.children[f]=e.children[f+this.order],e.children[f+this.order]=null);e.isLeaf||(c.children[f]=e.children[f+this.order],e.children[f+this.order]=null);e.numberActives=this.order-1;for(f=a.numberActives+1;f>b+1;f--)a.children[f]=a.children[f-1];this._diskWrite(c);a.children[b+1]=c.pointer;
for(f=a.numberActives;f>b;f--)a.keys[f]=a.keys[f-1];a.keys[b]=h;a.numberActives++;this._diskWrite(a);this._diskWrite(e)};G.Tree.prototype.insert=function(a,b){var e=this._diskRead(this.root);if(e.numberActives===2*this.order-1){var c=this._allocateNode();c.isLeaf=!1;c.level=e.level+1;c.numberActives=0;c.children[0]=e.pointer;this._diskWrite(c);this._splitChild(c,0,e);this.root=c.pointer;this._updateRootNode(c);this._insertNonFull(c,a,b)}else this._insertNonFull(e,a,b)};G.Tree.prototype._insertNonFull=
function(a,b,e){for(var c=a.numberActives-1;!a.isLeaf;){for(;c>=0&&this.comparator(b,a.keys[c].key)===-1;)c--;c++;var h=this._diskRead(a.children[c]);h.numberActives===2*this.order-1&&(this._splitChild(a,c,h),this.comparator(b,a.keys[c].key)===1&&c++);a=this._diskRead(a.children[c]);c=a.numberActives-1}for(;c>=0&&this.comparator(b,a.keys[c].key)===-1;)a.keys[c+1]=a.keys[c],c--;a.keys[c+1]={key:b,data:e};a.numberActives++;this._diskWrite(a)};G.Tree.prototype["delete"]=function(a){for(var b=this._diskRead(this.root),
e=null,c=!0,h=null,f=null,g=null,i=!0;i===!0;){for(i=!1;c===!0;){m=0;if(b.numberActives===0)return!1;for(;m<b.numberActives&&this.comparator(a,b.keys[m].key)===1;)m++;h=m;m<b.numberActives&&this.comparator(a,b.keys[m].key)===0&&(c=!1);if(c===!0){if(b.isLeaf===!0)return!1;e=b;b=this._diskRead(b.children[m]);if(b===null)return!1;h===e.numberActives?(f=this._diskRead(e.children[h-1]),g=null):h===0?(f=null,g=this._diskRead(e.children[1])):(f=this._diskRead(e.children[h-1]),g=this._diskRead(e.children[h+
1]));b.numberActives===this.order-1&&e!=null&&(g!=null&&g.numberActives>this.order-1?(this._moveKey(e,m,-1),b=this._diskRead(b.pointer)):f!=null&&f.numberActives>this.order-1?(this._moveKey(e,m,1),b=this._diskRead(b.pointer)):f!=null&&f.numberActives===this.order-1?b=this._mergeSiblings(e,m,-1):g!=null&&g.numberActives===this.order-1&&(b=this._mergeSiblings(e,m,1)))}}if(b.isLeaf&&b.numberActives>this.order-1)return this._deleteKeyFromNode(b,h),!0;if(b.isLeaf&&b.pointer===this.root)return this._deleteKeyFromNode(b,
h),!0;try{if(b.isLeaf===!1)if(f=e=null,(e=this._diskRead(b.children[h])).numberActives>this.order-1){var r=this._getMaxKeyPos(e),a=r.node.keys[r.index];b.keys[h]=a;this._diskWrite(b);b=e;a=a.key;c=i=!0}else if((e=this._diskRead(b.children[h+1])).numberActives>this.order-1)r=this._getMinKeyPos(e),a=r.node.keys[r.index],b.keys[h]=a,this._diskWrite(b),b=e,a=a.key,c=i=!0;else if((e=this._diskRead(b.children[h])).numberActives===this.order-1&&(f=this._diskRead(b.children[h+1])).numberActives===this.order-
1){var s=this._mergeNodes(e,b.keys[h],f);b.children[h]=s.pointer;h++;for(var m=h;m<b.numberActives;m++)b.children[m]=b.children[m+1],b.keys[m-1]=b.keys[m];b.children[m]=null;b.keys[m-1]=null;b.numberActives--;if(b.numberActives===0&&this.root===b.pointer)this.root=s.pointer,this._updateRootNode(s);this._diskWrite(b);b=s;c=i=!0}}catch(t){console.log("!!!"),console.log(t)}b.isLeaf&&b.numberActives>this.order-1&&c===!1&&this._deleteKeyFromNode(b,h);if(i===!1)return!0}};G.Tree.prototype._moveKey=function(a,
b,e){e===1&&b--;var c=this._diskRead(a.children[b]),h=this._diskRead(a.children[b+1]);if(e==-1){c.keys[c.numberActives]=a.keys[b];c.children[c.numberActives+1]=h.children[0];h.children[0]=null;c.numberActives++;a.keys[b]=h.keys[0];for(e=1;e<h.numberActives;e++)h.keys[e-1]=h.keys[e],h.children[e-1]=h.children[e];h.children[h.numberActives-1]=h.children[h.numberActives];h.numberActives--}else{h.children[h.numberActives+1]=h.children[h.numberActives];for(e=h.numberActives;e>0;e--)h.children[e]=h.children[e-
1],h.keys[e]=h.keys[e-1];h.keys[0]=null;h.children[0]=null;h.children[0]=c.children[c.numberActives];h.keys[0]=a.keys[b];h.numberActives++;c.children[c.numberActives]=null;a.keys[b]=c.keys[c.numberActives-1];c.keys[c.numberActives-1]=null;c.numberActives--}this._diskWrite(c);this._diskWrite(h);this._diskWrite(a)};G.Tree.prototype._mergeSiblings=function(a,b){var e,c,h;b===a.numberActives?(b--,c=this._diskRead(a.children[a.numberActives-1]),h=this._diskRead(a.children[a.numberActives])):(c=this._diskRead(a.children[b]),
h=this._diskRead(a.children[b+1]));var f=this._allocateNode();f.isLeaf=c.isLeaf;f.level=c.level;for(e=0;e<this.order-1;e++)f.keys[e]=c.keys[e],f.children[e]=c.children[e];f.keys[this.order-1]=a.keys[b];f.children[this.order-1]=c.children[this.order-1];for(e=0;e<this.order-1;e++)f.keys[e+this.order]=h.keys[e],f.children[e+this.order]=h.children[e];f.children[2*this.order-1]=h.children[this.order-1];this._diskWrite(f);a.children[b]=f.pointer;for(e=b;e<a.numberActives;e++)a.keys[e]=a.keys[e+1],a.children[e+
1]=a.children[e+2];f.numberActives=c.numberActives+h.numberActives+1;a.numberActives--;for(e=a.numberActives;e<2*this.order-1;e++)a.keys[e]=null;if(a.numberActives===0&&this.root===a.pointer)this.root=f.pointer,f.isLeaf=f.level?!1:!0;this._diskWrite(f);this.root===f.pointer&&this._updateRootNode(f);this._diskWrite(a);this._diskDelete(c);this._diskDelete(h);return f};G.Tree.prototype._deleteKeyFromNode=function(a,b){var e=2*this.order-1;if(a.numberActives<e)e=a.numberActives;var c;if(a.isLeaf===!1)return!1;
for(c=b;c<e-1;c++)a.keys[c]=a.keys[c+1];a.keys.splice(e-1,a.keys.length-(e-1));a.numberActives--;this._diskWrite(a);return!0};G.Tree.prototype._mergeNodes=function(a,b,e){var c,h;c=this._allocateNode();c.isLeaf=!0;for(h=0;h<a.numberActives;h++)c.keys[h]=a.keys[h],c.children[h]=a.children[h];c.children[a.numberActives]=a.children[a.numberActives];c.keys[a.numberActives]=b;for(h=0;h<e.numberActives;h++)c.keys[h+a.numberActives+1]=e.keys[h],c.children[h+a.numberActives+1]=e.children[h];c.children[2*
this.order-1]=e.children[e.numberActives];c.numberActives=a.numberActives+e.numberActives+1;c.isLeaf=a.isLeaf;c.level=a.level;this._diskWrite(c);this._diskDelete(a);this._diskDelete(e);return c};G.Tree.prototype.audit=function(a){var b=[],e=[],c=this,h=function(h){for(var f=0;f<e.length;f++)if(c.comparator(e[f],h)===0){var i=" !!! duplicated key "+h;a===!0&&console.log(i);b.push(i)}},f=null,c=this;this.walkNodes(function(g){a===!0&&(console.log("--- Node at "+g.level+" level"),console.log(" - pointer: "+
g.pointer),console.log(" - leaf? "+g.isLeaf),console.log(" - num actives? "+g.numberActives),console.log(" - keys: "));for(var i=g.numberActives;i<g.keys.length;i++)g.keys[i]!=null&&a===!0&&(console.log(" * warning : redundant key data"),b.push(" * warning : redundant key data"));for(i=g.numberActives+1;i<g.children.length;i++)g.children[i]!=null&&a===!0&&(console.log(" * warning : redundant children data"),b.push(" * warning : redundant key data"));if(g.isLeaf===!1)for(i=0;i<g.numberActives;i++){var r=
c._diskRead(g.children[i]).keys[c._diskRead(g.children[i]).numberActives-1].key,s=c._diskRead(g.children[i+1]).keys[0].key;a===!0&&console.log("   "+g.keys[i].key+"("+r+","+s+")");if(c.comparator(g.keys[i].key,r)===-1){var m=" !!! value max left "+r+" > key "+g.keys[i].key;a===!0&&console.log(m);b.push(m)}c.comparator(g.keys[i].key,s)===1&&(m=" !!! value min right "+s+" < key "+g.keys[i].key,a===!0&&console.log(m),b.push(m));h(g.keys[i].key);e.push(g.keys[i].key)}else{f===null?f=g.level:f!=g.level&&
(m=" !!! Leaf node with wrong level value",a===!0&&console.log(m),b.push(m));for(i=0;i<g.numberActives;i++)a===!0&&console.log(" "+g.keys[i].key),h(g.keys[i].key),e.push(g.keys[i].key)}g.pointer!=c.root&&(g.numberActives>2*c.order-1&&(a===!0&&(m=" !!!! MAX num keys restriction violated "),console.log(m),b.push(m)),g.numberActives<c.order-1&&(a===!0&&(m=" !!!! MIN num keys restriction violated "),console.log(m),b.push(m)))});return b};G.Tree.prototype.clear=function(){this.diskManager.clear();this.root=
this._allocateNode();this.root.isLeaf=!0;this.root.level=0;this._diskWrite(this.root);this._updateRootNode(this.root);this.root=this.root.pointer};G.Tree.prototype._getMaxKeyPos=function(a){for(var b={};;){if(a===null)break;if(a.isLeaf===!0){b.node=a;b.index=a.numberActives-1;break}else b.node=a,b.index=a.numberActives-1,a=this._diskRead(a.children[a.numberActives])}return b};G.Tree.prototype._getMinKeyPos=function(a){for(var b={};;){if(a===null)break;if(a.isLeaf===!0){b.node=a;b.index=0;break}else b.node=
a,b.index=0,a=this._diskRead(a.children[0])}return b};G.Node=function(){this.numberActives=0;this.isLeaf=null;this.keys=[];this.children=[];this.level=0};G.LocalStorageManager=function(a,b,e){this.name=a;this.storage=b;this.maxSize=e;this.bufferCache=new pa.PriorityQueue({maxSize:e});this.counter=this.storage.getItem("__"+this.name+"__ID_COUNTER__")||0};G.LocalStorageManager.prototype.clear=function(){for(var a=this.storage.length,b=[],e=0;e<a;e++){var c=this.storage.key(e);(c.indexOf(this.name)==
0||c.indexOf("__"+this.name)==0)&&b.push(c)}for(e=0;e<b.length;e++)this.storage.removeItem(b[e]);this.bufferCache=new pa.PriorityQueue({maxSize:this.maxSize})};G.LocalStorageManager.prototype._genIndex=function(){var a=this.name+this.counter;this.counter++;this.storage.setItem("__"+this.name+"__ID_COUNTER__",this.counter);return a};G.LocalStorageManager.prototype._diskRead=function(a){if(typeof a==="object")a=a.pointer;var b=this.bufferCache.fetch(a);if(b==null&&(b=this.storage.getItem(a),b!=null))b=
this._decode(b),b.pointer=a,this.bufferCache.push(a,b);return b};G.LocalStorageManager.prototype._diskWrite=function(a){if(a.pointer==null)a.pointer=this._genIndex();var b=a.children,e=[];if(a.isLeaf===!1)for(var c=0;c<b.length;c++)b[c]==null?e.push(null):typeof b[c]==="object"?e.push(b[c].pointer):e.push(b[c]);a.children=e;this.storage.setItem(a.pointer,this._encode(a));a.children=b;this.bufferCache.push(a.pointer,a)};G.LocalStorageManager.prototype._diskDelete=function(a){this.storage.removeItem(a.pointer);
this.bufferCache.remove(a.pointer)};G.LocalStorageManager.prototype._updateRootNode=function(a){if(a.pointer)this.storage.setItem("__"+this.name+"__ROOT_NODE__",a.pointer);else throw"Cannot set as root of the b-tree a node without pointer";};G.LocalStorageManager.prototype._readRootNode=function(){var a=this.storage.getItem("__"+this.name+"__ROOT_NODE__");return a==null?null:this._diskRead(a)};G.LocalStorageManager.prototype._encode=function(a){for(var b=""+a.numberActives,b=b+":"+a.pointer,b=b+":"+
a.level,b=b+":"+(a.isLeaf?1:0),e=0,c="",h=0;h<a.keys.length;h++)a.keys[h]!=null&&(c=typeof a.keys[h].key==="number"?c+":"+a.keys[h].key:c+":"+("_"+(a.keys[h].key.subject||"")+"_"+(a.keys[h].key.predicate||"")+"_"+(a.keys[h].key.object||"")+"_"+(a.keys[h].key.graph||"")),a.keys[h].data==null?c+=":n:":c=typeof a.keys[h].data=="string"?c+":s:"+a.keys[h].data:typeof a.keys[h].data=="number"?a.keys[h]%1==0?c+":i:"+a.keys[h].data:c+":f:"+a.keys[h].data:c+":o:"+JSON.stringify(a.keys[h].data).replace(":",
"&colon;"),e++);b=b+":"+e+c;if(a.isLeaf===!1){e="";for(h=c=0;h<a.children.length;h++)a.children[h]!=null&&(e=e+":"+a.children[h],c++);b=b+":"+c+e}return b};G.LocalStorageManager.prototype._decode=function(a){var b=new G.Node,a=a.split(":");b.numberActives=parseInt(a[0]);b.pointer=a[1];b.level=parseInt(a[2]);b.isLeaf=a[3]==="1"?!0:!1;for(var e=parseInt(a[4]),c=5,h,f,g,i=0;i<e;i++)h=a[c],h[0]=="_"?(h=h.split("_"),h={subject:parseInt(h[1])||null,predicate:parseInt(h[2])||null,object:parseInt(h[3])||
null,graph:parseInt(h[4]||null)}):h=parseInt(a[c]),f=a[c+1],g=a[c+2],f==="n"?g=void 0:f==="i"?g=parseInt(g):f==="f"?g=parseFloat(g):f==="o"&&(g=JSON.parse(g.replace("&colon;",":"))),b.keys.push({key:h,data:g}),c+=3;if(b.isLeaf===!1){e=parseInt(a[c]);c++;for(i=0;i<e;i++)b.children[i]=a[c],c++}return b};var R={NodeKey:function(a,b){this.subject=a.subject;this.predicate=a.predicate;this.object=a.object;this.graph=a.graph;this.order=b}};R.NodeKey.prototype.comparator=function(a){for(var b=0;b<this.order.length;b++){var e=
this.order[b];if(a[e]==null)break;else if(this[e]<a[e])return-1;else if(this[e]>a[e])return 1}return 0};R.Pattern=function(a){this.subject=a.subject;this.predicate=a.predicate;this.object=a.object;this.graph=a.graph;this.indexKey=[];this.keyComponents={};for(var b=[],e=[],a=["subject","predicate","object","graph"],c=0;c<a.length;c++)typeof this[a[c]]==="string"?(e.push(a[c]),this.keyComponents[a[c]]=null):(b.push(a[c]),this.keyComponents[a[c]]=this[a[c]],this.indexKey.push(a[c]));this.order=b.concat(e);
this.key=new R.NodeKey(this.keyComponents,this.order)};var Z={Tree:function(a,b){if(arguments!=0)this.componentOrder=a.componentOrder,G.Tree.call(this,a.order,a.name,a.persistent,a.cacheMaxSize),this.comparator=function(a,b){for(var h=0;h<this.componentOrder.length;h++){var f=this.componentOrder[h],g=a[f],f=b[f];if(g<f)return-1;else if(g>f)return 1}return 0},this.rangeComparator=function(a,b){for(var h=0;h<this.componentOrder.length;h++){var f=this.componentOrder[h];if(b[f]==null||a[f]==null)break;
else if(a[f]<b[f])return-1;else if(a[f]>b[f])return 1}return 0},b!=null&&b(this)}};v["extends"](G.Tree,Z.Tree);Z.Tree.prototype.insert=function(a,b){G.Tree.prototype.insert.call(this,a,null);b&&b(!0);return!0};Z.Tree.prototype.search=function(a,b){var e=G.Tree.prototype.search.call(this,a,!0);b&&b(e);return e};Z.Tree.prototype.range=function(a,b){var e=null,e=typeof this.root==="string"?this._rangeTraverse(this,this._diskRead(this.root),a):this._rangeTraverse(this,this.root,a);b&&b(e);return e};Z.Tree.prototype._rangeTraverse=
function(a,b,e){for(var e=e.key,c=[],h=[b],f;h.length>0;){b=h.shift();for(f=0;f<b.numberActives&&a.rangeComparator(b.keys[f].key,e)===-1;)f++;if(b.isLeaf===!0)for(;f<b.numberActives&&a.rangeComparator(b.keys[f].key,e)===0;)c.push(b.keys[f].key),f++;else{var g=a._diskRead(b.children[f]);for(h.push(g);;)if(f<b.numberActives&&a.rangeComparator(b.keys[f].key,e)===0)c.push(b.keys[f].key),f++,g=a._diskRead(b.children[f]),h.push(g);else break}}return c};var V={QuadBackend:function(a,b){if(arguments!=0){this.indexMap=
{};this.treeOrder=a.treeOrder;this.indices=["SPOG","GP","OGS","POG","GSP","OS"];this.componentOrders={SPOG:["subject","predicate","object","graph"],GP:["graph","predicate","subject","object"],OGS:["object","graph","subject","predicate"],POG:["predicate","object","graph","subject"],GSP:["graph","subject","predicate","object"],OS:["object","subject","predicate","graph"]};for(var e=0;e<this.indices.length;e++){var c=this.indices[e];this.indexMap[c]=new Z.Tree({order:this.treeOrder,componentOrder:this.componentOrders[c],
persistent:a.persistent,name:(a.name||"")+c,cacheMaxSize:a.cacheMaxSize})}b&&b(this)}}};V.QuadBackend.prototype.clear=function(){for(var a=0;a<this.indices.length;a++)this.indexMap[this.indices[a]].clear()};V.QuadBackend.prototype._indexForPattern=function(a){for(var a=a.indexKey,b=this.indices,e=0;e<b.length;e++)for(var c=b[e],h=this.componentOrders[c],f=0;f<h.length;f++){if(v.include(a,h[f])===!1)break;if(f==a.length-1)return c}return"SPOG"};V.QuadBackend.prototype.index=function(a,b){for(var e=
0;e<this.indices.length;e++)this.indexMap[this.indices[e]].insert(a);b&&b(!0);return!0};V.QuadBackend.prototype.range=function(a,b){var e=this.indexMap[this._indexForPattern(a)].range(a);b&&b(e);return e};V.QuadBackend.prototype.search=function(a,b){var e=this.indexMap[this.indices[0]].search(a);b&&b(e!=null);return e!=null};V.QuadBackend.prototype["delete"]=function(a,b){for(var e,c=0;c<this.indices.length;c++)e=this.indices[c],e=this.indexMap[e],e["delete"](a);b&&b(!0);return!0};var M={Lexicon:function(a,
b){this.name=b||"";this.storage=null;try{this.storage=window.localStorage}catch(e){}if(this.storage==null)this.storage={setItem:function(){},getItem:function(){return null},removeItem:function(){},key:function(){return""},length:0};this.uriToOID={};this.OIDToUri={};this.literalToOID={};this.OIDToLiteral={};this.blankToOID={};this.OIDToBlank={};this.defaultGraphOid=0;this.defaultGraphUri="https://github.com/antoniogarrote/rdfstore-js#default_graph";this.defaultGraphUriTerm={token:"uri",prefix:null,
suffix:null,value:this.defaultGraphUri,oid:this.defaultGraphOid};this.oidCounter=parseInt(this.storage.getItem(this.pointer("oidCounter")))||1;this.storage.getItem(this.pointer("knownGraphs"))==null?(this.knownGraphs={},this.storage.setItem(this.pointer("knownGraphs"),JSON.stringify(this.knownGraphs))):this.knownGraphs=JSON.parse(this.storage.getItem(this.pointer("knownGraphs")));a!=null&&a(this)}};M.Lexicon.prototype.updateAfterWrite=function(){this.storage.setItem(this.pointer("oidCounter"),""+
this.oidCounter)};M.Lexicon.prototype.pointer=function(a,b){a=="uriToOID"?a="uo":a=="OIDToUri"?a="ou":a=="literalToOID"?a="lo":a=="OIDToLiteral"?a="ok":a=="blankToOID"?a="bo":a=="OIDToBlank"&&(a="ob");return b==null?this.name+"_l_"+a:this.name+"_l_"+a+"_"+b};M.Lexicon.prototype.clear=function(){this.uriToOID={};this.OIDToUri={};this.literalToOID={};this.OIDToLiteral={};this.blankToOID={};this.OIDToBlank={};for(var a=this.storage.length,b=this.name+"_l_",e=[],c=0;c<a;c++){var h=this.storage.key(c);
h.indexOf(b)==0&&e.push(h)}for(c=0;c<e.length;c++)this.storage.removeItem(e[c])};M.Lexicon.prototype.registerGraph=function(a){a!=this.defaultGraphOid&&(this.knownGraphs[a]=!0,this.storage.setItem(this.pointer("knownGraphs"),JSON.stringify(this.knownGraphs)));return!0};M.Lexicon.prototype.registeredGraphs=function(a){var b=[],e;for(e in this.knownGraphs)a===!0?b.push(this.retrieve(e)):b.push(e);return b};M.Lexicon.prototype.registerUri=function(a){if(a===this.defaultGraphUri)return this.defaultGraphOid;
else{if(this.uriToOID[a]==null){var b=this.storage.getItem(this.pointer("uriToOID",a));if(b==null){var b=this.oidCounter,e="u"+b;this.oidCounter++;this.uriToOID[a]=[b,0];this.OIDToUri[e]=a;this.storage.setItem(this.pointer("uriToOID",a),b+":0");this.storage.setItem(this.pointer("OIDToUri",e),a)}else{var c=b.split(":"),b=parseInt(c[0]),e="u"+b,c=parseInt(c[1])+1;this.uriToOID[a]=[b,c];this.OIDToUri[e]=a;this.storage.setItem(this.pointer("uriToOID",a),b+":0")}}else e=this.uriToOID[a],b=e[0],c=e[1]+
1,this.uriToOID[a]=[b,c],this.storage.setItem(this.pointer("uriToOID",a),b+":"+c);return b}};M.Lexicon.prototype.resolveUri=function(a){if(a===this.defaultGraphUri)return this.defaultGraphOid;else{var b=this.uriToOID[a];if(b!=null)return b[0];else if(b=this.storage.getItem(this.pointer("uriToOID",a)),b==null)return-1;else{var e=b.split(":"),b=parseInt(e[0]),c="u"+b,e=parseInt(e[1]);this.uriToOID[a]=[b,e];this.OIDToUri[c]=a;return b}}};M.Lexicon.prototype.resolveUriCost=function(a){return a===this.defaultGraphUri?
this.defaultGraphOid:(a=this.uriToOID[a],a!=null?a[1]:-1)};M.Lexicon.prototype.registerBlank=function(){var a=this.oidCounter;this.oidCounter++;a=""+a;this.storage.setItem(this.pointer("OIDToBlank",a),!0);this.OIDToBlank[a]=!0;return a};M.Lexicon.prototype.resolveBlank=function(){var a=this.oidCounter;this.oidCounter++;return""+a};M.Lexicon.prototype.resolveBlankCost=function(){return 0};M.Lexicon.prototype.registerLiteral=function(a){if(this.literalToOID[a]==null){var b=this.storage.getItem(this.pointer("literalToOID",
a));if(b==null){var b=this.oidCounter,e="l"+b;this.oidCounter++;this.literalToOID[a]=[b,0];this.OIDToLiteral[e]=a;this.storage.setItem(this.pointer("literalToOID",a),b+":0");this.storage.setItem(this.pointer("OIDToLiteral",e),a)}else e=b.split(":"),b=parseInt(e[0]),e=parseInt(e[1])+1,this.literalToOID[a]=[b,e],this.storage.setItem(this.pointer("literalToOID",a),b+":"+e)}else e=this.literalToOID[a],b=e[0],e=e[1]+1,this.storage.setItem(this.pointer("literalToOID",a),b+":"+e),this.literalToOID[a]=[b,
e];return b};M.Lexicon.prototype.resolveLiteral=function(a){var b=this.literalToOID[a];if(b!=null)return b[0];else{var e=this.storage.getItem(this.pointer("literalToOID",a));return e!=null?(b=e.split(":"),e=parseInt(b[0]),b=parseInt(b[1]),this.literalToOID[a]=[e,b],this.OIDToLiteral["l"+e]=a,e):-1}};M.Lexicon.prototype.resolveLiteralCost=function(a){a=this.literalToOID[a];return a!=null?a[1]:0};M.Lexicon.prototype.parseLiteral=function(a){var b=a.lastIndexOf("@");if(b!=-1&&a[b-1]==='"'){var e=a.substring(1,
b-1),a=a.substring(b+1,a.length);return{token:"literal",value:e,lang:a}}b=a.lastIndexOf("^^");if(b!=-1&&a[b-1]==='"'&&a[b+2]==="<"&&a[a.length-1]===">")return e=a.substring(1,b-1),a=a.substring(b+3,a.length-1),{token:"literal",value:e,type:a};e=a.substring(1,a.length-1);return{token:"literal",value:e}};M.Lexicon.prototype.parseUri=function(a){return{token:"uri",value:a}};M.Lexicon.prototype.retrieve=function(a){var b;try{if(a===this.defaultGraphOid)return{token:"uri",value:this.defaultGraphUri,prefix:null,
suffix:null,defaultGraph:!0};else{var e=this.OIDToUri["u"+a];if(e!=null)return this.parseUri(e);else{var c=this.OIDToLiteral["l"+a];if(c!=null)return this.parseLiteral(c);else{var h=this.OIDToBlank[""+a];if(h!=null)return{token:"blank",value:"_:"+a};else if(e=this.storage.getItem(this.pointer("OIDToUri","u"+a)),e!=null){this.OIDToUri["u"+a]=e;b=this.storage.getItem(this.pointer("uriToOID",e));var f=b.split(":"),g=parseInt(f[1]);this.uriToOID[e]=[a,g];return this.parseUri(e)}else if(c=this.storage.getItem(this.pointer("OIDToLiteral",
"l"+a)),c!=null){this.OIDToLiteral["l"+a]=c;b=this.storage.getItem(this.pointer("literalToOID",c));var i=b.split(":"),a=parseInt(i[0]),g=parseInt(i[1]);this.literalToOID[c]=[a,g];return this.parseLiteral(c)}else if(h=this.storage.getItem(this.pointer("OIDToBlank",""+a)),h!=null)return this.OIDToBlank[""+a]=!0,{token:"blank",value:"_:"+a};else throw"Null value for OID";}}}}catch(r){throw console.log("error in lexicon retrieving OID:"),console.log(a),r.message&&console.log(r.message),r.stack&&console.log(r.stack),
Error("Unknown retrieving OID in lexicon:"+a);}};M.Lexicon.prototype.unregister=function(a,b){try{return this.unregisterTerm(a.subject.token,b.subject),this.unregisterTerm(a.predicate.token,b.predicate),this.unregisterTerm(a.object.token,b.object),a.graph!=null&&this.unregisterTerm(a.graph.token,b.graph),!0}catch(e){return console.log("Error unregistering quad"),console.log(e.message),!1}};M.Lexicon.prototype.unregisterTerm=function(a,b){if(a==="uri"){if(b!=this.defaultGraphOid){var e="u"+b,c=this.OIDToUri[e],
h=this.uriToOID[c],f=h[1];if(""+h[0]===""+b)f===0?(delete this.OIDToUri[e],delete this.uriToOID[c],delete this.knownGraphs[b]):this.uriToOID[c]=[b,f-1];else throw"Not matching OID : "+b+" vs "+h[0];}}else if(a==="literal")if(this.oidCounter++,e="l"+b,c=this.OIDToLiteral[e],h=this.literalToOID[c],f=h[1],""+h[0]===""+b)f===0?(delete this.OIDToLiteral[e],delete this.literalToOID[c]):this.literalToOID[c]=[b,f-1];else throw"Not matching OID : "+b+" vs "+h[0];else a==="blank"&&delete this.OIDToBlank[""+
b]};var P={};P.load=function(a,b,e){jQuery.ajax({url:a,headers:{Accept:b},success:function(a,b,f){if((""+f.status)[0]=="2"){for(var b=f.getAllResponseHeaders().split("\n"),f={},g=0;g<b.length;g++){var i=b[g].split(":");f[i[0]]=i[1]}e(!0,{headers:f,data:a})}},error:function(a){(""+a.status)[0]=="3"?redirection==0?e(!1,500):(a=a.getAllResponseHeaders().Location||a.getAllResponseHeaders().location,a!=null?P.load(a,b,e,redirection-1):e(!1,500)):e(!1,a.statusCode())}})};var qa=null;(function(){var a=function(a,
e){a.stack="";for(var b in e)a[b]=e[b]};if(typeof window!=="undefined"){var b=window.jsonld=window.jsonld||{};Exception=function(e){a(this,e)};if(!Object.keys)Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on non-object");var e=[],b;for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&e.push(b);return e};if(!Array.prototype.filter)Array.prototype.filter=function(a,e){if(this==null)throw new TypeError;var b=Object(this),h=b.length>>>0;if(typeof a!="function")throw new TypeError;
for(var c=[],g=0;g<h;g++)if(g in b){var f=b[g];a.call(e,f,g,b)&&c.push(f)}return c}}else typeof module!=="undefined"&&module.exports&&(b={},Exception=function(e){a(this,e);this.stack=Error().stack});qa=b;var e={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",xsd:"http://www.w3.org/2001/XMLSchema#",dcterms:"http://purl.org/dc/terms/",foaf:"http://xmlns.com/foaf/0.1/",cal:"http://www.w3.org/2002/12/cal/ical#",vcard:"http://www.w3.org/2006/vcard/ns# ",
geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",cc:"http://creativecommons.org/ns#",sioc:"http://rdfs.org/sioc/ns#",doap:"http://usefulinc.com/ns/doap#",com:"http://purl.org/commerce#",ps:"http://purl.org/payswarm#",gr:"http://purl.org/goodrelations/v1#",sig:"http://purl.org/signature#",ccard:"http://purl.org/commerce/creditcard#"},c={xsd:"http://www.w3.org/2001/XMLSchema#"},h={"boolean":c.xsd+"boolean","double":c.xsd+"double",integer:c.xsd+"integer"},f=function(a,e,b){e in a?a[e].constructor===Array?
a[e].push(b):a[e]=[a[e],b]:a[e]=b},g=function(a){var e;if(a.constructor===Object){e={};var b=Object.keys(a).sort(),h;for(h in b){var c=b[h];e[c]=g(a[c])}}else if(a.constructor===Array)for(h in e=[],a)e[h]=g(a[h]);else e=a;return e},i=function(a){var e={"@id":"@id","@language":"@language","@literal":"@literal","@type":"@type"};if(a){var b={},h;for(h in a)a[h].constructor===String&&a[h]in e&&(b[a[h]]=h);for(h in b)e[h]=b[h]}return e},r=function(a,e){var b=null;e in a&&(a[e].constructor===String?b=a[e]:
a[e].constructor===Object&&"@id"in a[e]&&(b=a[e]["@id"]));return b},s=function(a,e,b){var h=null,c;for(c in a)if(c.length>0&&c[0]!=="@"&&e===r(a,c)){h=c;b!==null&&(b[c]=g(a[c]));break}h===null&&e==="@type"&&(h=i(a)["@type"]);if(h===null)for(c in a)if(c.length>0&&c[0]!=="@"){var f=r(a,c);if(f!==null&&e.indexOf(f)===0&&e.length>f.length){h=c+":"+e.substr(f.length);b!==null&&(b[c]=g(a[c]));break}}h===null&&(h=e);return h},m=function(a,e,b){var h=e,c=i(a),f=e.indexOf(":");if(f!==-1)c=e.substr(0,f),c in
a&&(h=r(a,c)+e.substr(f+1),b!==null&&(b[c]=g(a[c])));else if(e in a)h=r(a,e),b!==null&&(b[e]=g(a[e]));else for(var k in c)if(e===c[k]){h=k;break}return h},t=function(a){var e=!1;a!==null&&a.constructor===Object&&!("@literal"in a)&&(e=Object.keys(a).length>1||!("@id"in a));return e};b.normalize=function(a){return(new F).normalize(a)};b.expand=function(a){return(new F).expand({},null,a)};b.compact=function(a,e){var h=null;if(e!==null){var e=b.expand(e),c;e.constructor===Array?(h=[],c=e):c=[e];a.constructor===
Array&&(a=b.mergeContexts({},a));for(var f in c){var i={},n=(new F).compact(g(a),null,c[f],i);if(Object.keys(i).length>0){var k=i,i={},o=Object.keys(k).sort(),u=void 0;for(u in o){var m=o[u];i[m]=k[m]}k=Object.keys(n);k.sort();k.unshift("@context");n["@context"]=i;var i={},r;for(r in k)o=k[r],i[o]=n[o];n=i}h===null?h=n:h.push(n)}}return h};b.mergeContexts=function(a,e){a.constructor===Array&&(a=b.mergeContexts({},a));var h=g(a);if(e.constructor===Array)for(var c in e)h=b.mergeContexts(h,e[c]);else{for(var f in e)if(f.indexOf("@")!==
0)for(var i in h)if(h[i]===e[f]){delete h[i];break}for(f in e)h[f]=g(e[f])}return h};b.expandTerm=m;b.compactIri=function(a,e){return s(a,e,null)};b.frame=function(a,e,b){return(new F).frame(a,e,b)};b.toTriples=function(a,e,h){var c=null,a=b.normalize(a),h=h||null;h===null&&(c=[],h=function(a,b,h){c.push({subject:v.lexicalFormTerm(a),predicate:v.lexicalFormTerm(b),object:v.lexicalFormTerm(h),graph:e})});var g=!1,f;for(f in a){var i=a[f],n=i["@id"],n=n[0]=="_"?{token:"blank",value:n.split(":")[1]}:
{token:"uri",value:n},k;for(k in i)if(k!=="@id"){var o=i[k];o.constructor!==Array&&(o=[o]);for(var u in o)if(g=o[u],k==="@type"||k==="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"?(k="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",g={token:"uri",value:g}):typeof g==="string"?g={token:"literal",value:g}:g["@id"]!=null?g=g["@id"][0]=="_"?{token:"blank",value:g["@id"].split(":")[1]}:{token:"uri",value:g["@id"]}:g["@type"]!=null?g={token:"literal",value:g["@literal"],type:g["@type"]}:g["@language"]!=
null&&(g={token:"literal",value:g["@literal"],lang:g["@language"]}),g=h(n,{token:"uri",value:k},g)===!1)break;if(g)break}if(g)break}return c};b.resolve=function(a,e,b){var h={},c=function(a,e){if(a.constructor===Array)for(var b in a)c(a[b]);else if(a.constructor===Object)for(var g in a)if(g==="@context")if(a[g].constructor===Array){var f=a[g];for(b in f)f[b].constructor===String&&(e?f[b]=h[f[b]]:h[f[b]]={})}else a[g].constructor===String&&(e?a[g]=h[a[g]]:h[a[g]]={})};c(a,!1);var g=Object.keys(h).length,
f=null;if(g===0)b(a,f);else for(var i in h)e(i,function(e,n){--g;if(e===null)f=f||[],f.push({url:i,error:n});else try{h[i]=e.constructor===String?JSON.parse(e)["@context"]:e["@context"]}catch(k){f=f||[],f.push({url:i,error:k})}g===0&&(f===null&&c(a,!0),b(a,f))})};var F=function(){};F.prototype.compact=function(a,e,b,c){var f,k=i(a);if(b===null)f=null,this.getCoerceType(a,e,c);else if(b.constructor===Array){f=[];for(var o in b)f.push(this.compact(a,e,b[o],c))}else if(b.constructor===Object&&"@id"in
b&&b["@id"].constructor===Array)f={},f[k["@id"]]=this.compact(a,e,b["@id"],c);else if(t(b)){f={};for(var u in b)if(b[u]!=="@context"&&(k=s(a,u,c),k!==u||!(k in f)))f[k]=this.compact(a,u,b[u],c)}else{e=this.getCoerceType(a,e,c);o=null;b.constructor===Object?"@language"in b||(o="@type"in b?b["@type"]:"@id"in b?"@id":e):b.constructor===String&&(o=e);if(e===null&&(o===h["boolean"]||o===h.integer||o===h["double"]))e=o;if(e!==null)if(o===null)throw{message:"Cannot coerce type when a language is specified. The language information would be lost."};
else if(o!==e)throw new Exception({message:"Cannot coerce type because the type does not match.",type:o,expected:e});else b.constructor===Object?"@id"in b?f=b["@id"]:"@literal"in b&&(f=b["@literal"]):f=b,e===h["boolean"]?f=f==="true"||f!=0:e===h["double"]?f=parseFloat(f):e===h.integer&&(f=parseInt(f));else if(b.constructor===Object)for(u in f={},b)f[k[u]]=b[u];else f=g(b);o==="@id"&&(f.constructor===Object?f[k["@id"]]=s(a,f[k["@id"]],c):f=s(a,f,c))}return f};F.prototype.expand=function(a,e,c){var k;
if(c===null)k=null;else if(e===null&&c.constructor===String)k=m(a,c,null);else if(c.constructor===Array){k=[];for(var o in c)k.push(this.expand(a,e,c[o]))}else if(c.constructor===Object){"@context"in c&&(a=b.mergeContexts(a,c["@context"]));k={};for(var u in c)u==="@embed"||u==="@explicit"||u==="@default"||u==="@omitDefault"?f(k,u,g(c[u])):u!=="@context"&&f(k,m(a,u,null),this.expand(a,u,c[u]))}else{o=this.getCoerceType(a,e,null);k=i(a);if(o===null&&(c.constructor===Number||c.constructor===Boolean))o=
c.constructor===Boolean?h["boolean"]:(""+c).indexOf(".")==-1?h.integer:h["double"];e===k["@id"]||e===k["@type"]?k=m(a,c,null):o!==null?(k={},o==="@id"?k["@id"]=m(a,c,null):(k["@type"]=o,o===h["double"]&&(c=c.toExponential(6).replace(/(e(?:\+|-))([0-9])$/,"$10$2")),k["@literal"]=""+c)):k=""+c}return k};F.prototype.normalize=function(a){var b=[];if(a!==null){this.ng={tmp:null,c14n:null};var h=this.expand(e,null,a);this.nameBlankNodes(h);a={};x(null,null,h,a);for(var c in a){var h=a[c],g={},f=Object.keys(h).sort(),
i;for(i in f){var n=f[i];g[n]=h[n]}b.push(g)}this.canonicalizeBlankNodes(b);b.sort(function(a,e){return k(a["@id"],e["@id"])})}return b};F.prototype.getCoerceType=function(a,e,b){var h=null,e=m(a,e,null);e==="@id"||e==="@type"?h="@id":(e=s(a,e,null),e in a&&a[e].constructor===Object&&"@type"in a[e]&&(h=m(a,a[e]["@type"],b),b!==null&&(b[e]=g(a[e]))));return h};var y=function(a){return a.indexOf("_:")===0},Ta=function(a){return a.constructor===Object&&"@id"in a&&y(a["@id"])},k=function(a,e){var b=0;
if(a.constructor===Array&&e.constructor===Array)for(var h=0;h<a.length&&b===0;++h)b=k(a[h],e[h]);else b=a<e?-1:a>e?1:0;return b},o=function(a,e,b){var h=0;b in a?h=b in e?k(a[b],e[b]):-1:b in e&&(h=1);return h},z=function(a,e){var b=0;a.constructor===String?b=e.constructor!==String?-1:k(a,e):e.constructor===String?b=1:(b=o(a,e,"@literal"),b===0&&("@literal"in a?(b=o(a,e,"@type"),b===0&&(b=o(a,e,"@language"))):b=k(a["@id"],e["@id"])));return b},u=function(a,e){var b=0,h;for(h in a)if(h!=="@id"){b=
k(a[h].constructor===Array?a[h].length:1,e[h].constructor===Array?e[h].length:1);if(b===0){var c=a[h],g=e[h];c.constructor!==Array&&(c=[c],g=[g]);c=c.filter(function(a){return!Ta(a)});g=g.filter(function(a){return!Ta(a)});b=k(c.length,g.length)}if(b===0){c.sort(z);g.sort(z);for(var f=0;f<c.length&&b===0;++f)b=z(c[f],g[f])}if(b!==0)break}return b},H=function(a){var e=-1,b={next:function(){++e;return b.current()},current:function(){return"_:"+a+e},inNamespace:function(e){return e.indexOf("_:"+a)===
0}};return b},T=function(a,e,b){if(a!==null)if(a.constructor===Array)for(var h in a)T(a[h],e,b);else if(a.constructor===Object){"@id"in a?a["@id"].constructor==Array?T(a["@id"],e,b):t(a)&&(e[a["@id"]]=a):t(a)&&(!("@id"in a)||Ta(a))&&b.push(a);for(var c in a)T(a[c],e,b)}},x=function(a,e,b,h){var c=null;if(b!==null)if(b.constructor===Array)for(var f in b)x(a,e,b[f],h);else if(b.constructor===Object)if("@literal"in b||e==="@type")c=g(b);else if(b["@id"].constructor===Array){if(a!==null)throw{message:"Embedded graph literals cannot be flattened."};
for(var i in b["@id"])x(a,e,b["@id"][i],h)}else{b["@id"]in h?f=h[b["@id"]]:(f={"@id":b["@id"]},h[b["@id"]]=f);var c={"@id":f["@id"]},k;for(k in b)i=b[k],i!==null&&k!=="@id"&&(k in f?f[k].constructor!==Array&&(f[k]=[f[k]]):f[k]=[],x(f[k],k,i,h),f[k].length===1&&(f[k]=f[k][0]))}else c=b;c!==null&&a!==null&&(a.constructor===Array?(e=!1,c.constructor===Object&&"@id"in c&&(e=a.filter(function(a){return a.constructor===Object&&"@id"in a&&a["@id"]===c["@id"]}).length>0),e||a.push(c)):a[e]=c)};F.prototype.nameBlankNodes=
function(a){var e=this.ng.tmp=H("tmp"),b={},h=[];T(a,b,h);for(var c in h)if(a=h[c],!("@id"in a)){for(;e.next()in b;);a["@id"]=e.current();b[e.current()]=a}};F.prototype.renameBlankNode=function(a,e){var b=a["@id"];a["@id"]=e;var h=this.subjects;h[e]=h[b];delete h[b];this.edges.refs[e]=this.edges.refs[b];this.edges.props[e]=this.edges.props[b];delete this.edges.refs[b];delete this.edges.props[b];var c=this.edges.refs[e].all,g;for(g in c){var f=c[g].s;f===b&&(f=e);var i=h[f],k=this.edges.props[f].all,
n;for(n in k)if(k[n].s===b){k[n].s=e;var f=k[n].p,f=i[f].constructor===Object?[i[f]]:i[f].constructor===Array?i[f]:[],o;for(o in f)f[o].constructor===Object&&"@id"in f[o]&&f[o]["@id"]===b&&(f[o]["@id"]=e)}}k=this.edges.props[e].all;for(g in k){var f=k[g].s,c=this.edges.refs[f].all,u;for(u in c)if(c[u].s===b)c[u].s=e}};F.prototype.canonicalizeBlankNodes=function(a){this.renamed={};this.mappings={};this.serializations={};var e=this.edges={refs:{},props:{}},b=this.subjects={},h=[],c;for(c in a){var g=
a[c]["@id"];b[g]=a[c];e.refs[g]={all:[],bnodes:[]};e.props[g]={all:[],bnodes:[]};y(g)&&h.push(a[c])}this.collectEdges();var a=this.ng.c14n=H("c14n"),f=this.ng.tmp;for(c in h){var i=h[c],g=i["@id"];if(a.inNamespace(g)){for(;f.next()in b;);this.renameBlankNode(i,f.current());g=i["@id"]}this.serializations[g]={props:null,refs:null}}for(var f=!0,n=this;h.length>0;){f&&(f=!1,h.sort(function(a,e){return n.deepCompareBlankNodes(a,e)}));var i=h.shift(),g=i["@id"],i=["props","refs"],o;for(o in i){var u=i[o];
if(this.serializations[g][u]===null){var m={};m[g]="s1"}else m=this.serializations[g][u].m;var r=Object.keys(m);r.sort(function(a,e){return k(m[a],m[e])});var s=[];for(c in r){var t=r[c];!a.inNamespace(g)&&t in b&&(this.renameBlankNode(b[t],a.next()),s.push(t))}r=h;h=[];for(c in r){var t=r[c],v=t["@id"];if(!a.inNamespace(v)){for(var F in s)this.markSerializationDirty(v,s[F],u)&&(f=!0);h.push(t)}}}}for(var x in e.props)if(e.props[x].bnodes.length>0){var i=b[x],Y;for(Y in i)Y.indexOf("@")!==0&&i[Y].constructor===
Array&&i[Y].sort(z)}};MappingBuilder=function(){this.count=1;this.processed={};this.mapping={};this.adj={};this.keyStack=[{keys:["s1"],idx:0}];this.done={};this.s=""};MappingBuilder.prototype.copy=function(){var a=new MappingBuilder;a.count=this.count;a.processed=g(this.processed);a.mapping=g(this.mapping);a.adj=g(this.adj);a.keyStack=g(this.keyStack);a.done=g(this.done);a.s=this.s;return a};MappingBuilder.prototype.mapNode=function(a){a in this.mapping||(this.mapping[a]=a.indexOf("_:c14n")===0?"c"+
a.substr(6):"s"+this.count++);return this.mapping[a]};MappingBuilder.prototype.serialize=function(a,e){if(this.keyStack.length>0)for(var b=this.keyStack.pop();b.idx<b.keys.length;++b.idx){var h=b.keys[b.idx];if(!(h in this.adj)){this.keyStack.push(b);break}if(h in this.done)this.s+="_"+h;else{this.done[h]=!0;var c=h,h=this.adj[h],g=h.i;if(g in a){var f=a[g],i="",k=!0,n=void 0;for(n in f)if(n!=="@id"){k?k=!1:i+="|";i+="<"+n+">";var o=f[n].constructor===Array?f[n]:[f[n]],u;for(u in o){var m=o[u];m.constructor===
Object?"@id"in m?i+=y(m["@id"])?"_:":"<"+m["@id"]+">":(i+='"'+m["@literal"]+'"',"@type"in m?i+="^^<"+m["@type"]+">":"@language"in m&&(i+="@"+m["@language"])):i+='"'+m+'"'}}c+="["+i+"]";f=!0;c+="[";var g=e.refs[g].all,r;for(r in g)f?f=!1:c+="|",c+="<"+g[r].p+">",c+=y(g[r].s)?"_:":"<"+g[r].s+">";c+="]"}c+=h.k.join("");this.s+=c;this.keyStack.push({keys:h.k,idx:0});this.serialize(a,e)}}};F.prototype.markSerializationDirty=function(a,e,b){var h=!1,a=this.serializations[a];a[b]!==null&&e in a[b].m&&(a[b]=
null,h=!0);return h};var A=function(a,e){var b=0;return b=a.length==e.length?k(a,e):a.length>e.length?k(a.substr(0,e.length),e):k(a,e.substr(0,a.length))};F.prototype.serializeCombos=function(a,e,b,h,c,f,i){if(i.length>0){f=g(f);f[h.mapNode(i[0].s)]=i[0].s;for(var k=h.copy(),i=i.slice(1),n=Math.max(1,i.length),o=0;o<n;++o){var u=o===0?h:k.copy();this.serializeCombos(a,e,b,u,c,f,i);i.unshift.apply(i,i.splice(1,i.length))}}else if(i=Object.keys(f).sort(),h.adj[b]={i:e,k:i,m:f},h.serialize(this.subjects,
this.edges),a[c]===null||A(h.s,a[c].s)<=0){for(k in i)this.serializeBlankNode(a,f[i[k]],h,c);h.serialize(this.subjects,this.edges);if(a[c]===null||A(h.s,a[c].s)<=0&&h.s.length>=a[c].s.length)a[c]={s:h.s,m:h.mapping}}};F.prototype.serializeBlankNode=function(a,e,b,h){if(!(e in b.processed)){b.processed[e]=!0;var c=b.mapNode(e),g=b.copy(),f=this.edges[h][e].bnodes,i={},k=[],n;for(n in f)f[n].s in b.mapping?i[b.mapping[f[n].s]]=f[n].s:k.push(f[n]);f=Math.max(1,k.length);for(n=0;n<f;++n){var o=n===0?
b:g.copy();this.serializeCombos(a,e,c,o,h,i,k)}}};F.prototype.deepCompareBlankNodes=function(a,e){var b=0,h=a["@id"],c=e["@id"];if(h===c)b=0;else if(b=this.shallowCompareBlankNodes(a,e),b===0)for(var f=["props","refs"],i=0;b===0&&i<f.length;++i){var b=f[i],n=this.serializations[h],o=this.serializations[c];if(n[b]===null){var u=new MappingBuilder;if(b==="refs")u.mapping=g(n.props.m),u.count=Object.keys(u.mapping).length+1;this.serializeBlankNode(n,h,u,b)}if(o[b]===null){u=new MappingBuilder;if(b===
"refs")u.mapping=g(o.props.m),u.count=Object.keys(u.mapping).length+1;this.serializeBlankNode(o,c,u,b)}b=k(n[b].s,o[b].s)}return b};F.prototype.shallowCompareBlankNodes=function(a,e){var b=0,h=Object.keys(a),c=Object.keys(e),b=k(h.length,c.length);b===0&&(b=k(h.sort(),c.sort()));b===0&&(b=u(a,e));if(b===0)var g=this.edges.refs[a["@id"]].all,f=this.edges.refs[e["@id"]].all,b=k(g.length,f.length);if(b===0)for(h=0;h<g.length&&b===0;++h)b=this.compareEdges(g[h],f[h]);return b};F.prototype.compareEdges=
function(a,e){var b=0,h=y(a.s),c=y(e.s),g=this.ng.c14n;h!=c?b=h?1:-1:(h||(b=k(a.s,e.s)),b===0&&(b=k(a.p,e.p)),b===0&&g!==null&&(h=g.inNamespace(a.s),g=g.inNamespace(e.s),h!=g?b=h?1:-1:h&&(b=k(a.s,e.s))));return b};F.prototype.collectEdges=function(){var a=this.edges.refs,e=this.edges.props,b;for(b in this.subjects){var h=this.subjects[b],c;for(c in h)if(c!=="@id"){var g=h[c],g=g.constructor!==Array?[g]:g,f;for(f in g){var i=g[f];i.constructor===Object&&"@id"in i&&i["@id"]in this.subjects&&(i=i["@id"],
a[i].all.push({s:b,p:c}),e[b].all.push({s:i,p:c}))}}}var k=this;for(b in a)a[b].all.sort(function(a,e){return k.compareEdges(a,e)}),a[b].bnodes=a[b].all.filter(function(a){return y(a.s)});for(b in e)e[b].all.sort(function(a,e){return k.compareEdges(a,e)}),e[b].bnodes=e[b].all.filter(function(a){return y(a.s)})};var G=function(a,e){var b=!1;if(!("@type"in e)){var h=Object.keys(e).filter(function(a){return a.indexOf("@")!==0});if(h.length===0)b=!0;else if(a.constructor===Object&&"@id"in a){var b=!0,
c;for(c in h)if(!(h[c]in a)){b=!1;break}}}return b},E=function(a,e,b,h,c,g,f,i){var k=e["@id"],n=k in h?h[k]:null;if(("@embed"in b&&b["@embed"]||!("@embed"in b)&&i.defaults.embedOn)&&(n===null||n.autoembed&&!c)){if(n===null)n={},h[k]=n;else if(n.parent!==null){if(n.parent[n.key].constructor===Array){var o=n.parent[n.key],u;for(u in o)if(o[u].constructor===Object&&"@id"in o[u]&&o[u]["@id"]===k){o[u]={"@id":e["@id"]};break}}else n.parent[n.key]={"@id":e["@id"]};var m=function(a){var e=Object.keys(h),
b;for(b in e)b=e[b],b in h&&h[b].parent!==null&&h[b].parent["@id"]===a&&(delete h[b],m(b))};m(k)}n.autoembed=c;n.parent=g;n.key=f;if(b["@explicit"]===!0||i.defaults.explicitOn)for(r in e)r!=="@id"&&!(r in b)&&delete e[r];c=Object.keys(e);for(u in c){var r=c[u];if(r.indexOf("@")!==0){r in b?(g=b[r],f=!1):(g=e[r].constructor===Array?[]:{},f=!0);var k=e[r],k=k.constructor===Array?k:[k],s;for(s in k)k[s].constructor===Object&&"@id"in k[s]&&k[s]["@id"]in a&&(k[s]=a[k[s]["@id"]]);e[r]=C(a,k,g,h,f,e,r,i)}}for(r in b)if(r.indexOf("@")!==
0&&(!(r in e)||e[r]===null))g=b[r],g.constructor===Array?e[r]=[]:(g.constructor===Array&&(g=g.length>0?g[0]:{}),g["@omitDefault"]===!0||i.defaults.omitDefaultOn||(e[r]="@default"in g?g["@default"]:null))}else e={"@id":e["@id"]};return e},C=function(a,e,b,h,c,g,f,i){var k=null,n=-1,o;b.constructor===Array?(k=[],o=b,o.length===0&&o.push({})):(o=[b],n=1);for(var u=[],m=0;m<o.length&&n!==0;++m){b=o[m];if(b.constructor!==Object)throw{message:"Invalid JSON-LD frame. Frame must be an object or an array.",
frame:b};u[m]=[];for(var r=0;r<e.length&&n!==0;++r){var s=e[r],z=!1,H="@type";if("@type"in b&&s.constructor===Object&&H in s)for(var v=s[H].constructor===Array?s[H]:[s[H]],F=b[H].constructor===Array?b[H]:[b[H]],x=0;x<F.length&&!z;++x){var H=F[x],y;for(y in v)if(v[y]===H){z=!0;break}}if(z||G(s,b))u[m].push(s),--n}}for(var T in u)for(var A in u[T])b=o[T],e=u[T][A],t(e)&&(e=E(a,e,b,h,c,g,f,i)),k===null?k=e:(b=e!==null&&e.constructor===Object&&"@id"in e&&Object.keys(e).length===1&&e["@id"]in h,g===null&&
b||k.push(e));return k};F.prototype.frame=function(a,e,h){var a=b.normalize(a),c=null;if("@context"in e)c=g(e["@context"]),e=b.expand(e);else if(e.constructor===Array){e.length>0&&"@context"in e[0]&&(c=g(e[0]["@context"]));var h=[],f;for(f in e)h.push(b.expand(e[f]));e=h}var h={defaults:{embedOn:!0,explicitOn:!1,omitDefaultOn:!1}},i={};for(f in a)i[a[f]["@id"]]=a[f];a=C(i,a,e,{},!1,null,null,h);c!==null&&a!==null&&(a=b.compact(c,a));return a}})();var ia={parser:{}};ia.parser.parse=function(a,b){typeof a===
"string"&&(a=JSON.parse(a));return qa.toTriples(a,b)};var W={RDFLoader:function(a){this.precedences=["text/turtle","text/n3","application/ld+json","application/json"];this.parsers={"text/turtle":ja.parser,"text/n3":ja.parser,"application/ld+json":ia.parser,"application/json":ia.parser};if(a!=null)for(var b in a.parsers)this.parsers[b]=a.parsers[b];if(a&&a.precedences!=null)for(b in this.precedences=a.precedences,a.parsers)v.include(this.precedences,b)||this.precedences.push(b);this.acceptHeaderValue=
"";for(a=0;a<this.precedences.length;a++)a!=0?this.acceptHeaderValue=this.acceptHeaderValue+","+this.precedences[a]:this.acceptHeaderValue+=this.precedences[a]}};W.RDFLoader.prototype.registerParser=function(a,b){this.parsers[a]=b;this.precedences.push(a)};W.RDFLoader.prototype.unregisterParser=function(a){delete this.parsers[a];for(var b=[],e=0;e<this.precedences.length;e++)this.precedences[e]!=a&&b.push(this.precedences[e]);this.precedences=b};W.RDFLoader.prototype.setAcceptHeaderPrecedence=function(a){this.precedences=
a};W.RDFLoader.prototype.load=function(a,b,e){var c=this;P.load(a,this.acceptHeaderValue,function(h,f){if(h==!0){var g=f.headers["Content-Type"]||f.headers["content-type"],i=f.data;if(g!=null){var g=g.split(";")[0],r;for(r in c.parsers)if(r.indexOf("/")!=-1){var s=r.split("/");if(s[1]==="*"){if(g.indexOf(s[0])!=-1)return c.tryToParse(c.parsers[r],b,i,e)}else if(g.indexOf(r)!=-1)return c.tryToParse(c.parsers[r],b,i,e);else if(g.indexOf(s[1])!=-1)return c.tryToParse(c.parsers[r],b,i,e)}else if(g.indexOf(r)!=
-1)return c.tryToParse(c.parsers[r],a,b,e);e(!1,"Unknown media type : "+g)}else console.log("Unknown media type"),console.log(f.headers),e(!1,"Uknown media type")}else e(!1,"Network error: "+f)})};W.RDFLoader.prototype.loadFromFile=function(a,b,e,c){try{var h=this;require("fs").readFile(e.split("file:/")[1],function(e,f){if(e)throw e;f=f.toString("utf8");h.tryToParse(a,b,f,c)})}catch(f){c(!1,f)}};W.RDFLoader.prototype.tryToParse=function(a,b,e,c){try{typeof e==="string"&&(e=v.normalizeUnicodeLiterals(e));
var h=a.parse(e,b);h!=null?c(!0,h):c(!1,"parsing error")}catch(f){console.log(f.message),console.log(f.stack),c(!1,"parsing error with mime type : "+f)}};var L={AbstractQueryTree:function(){}};L.AbstractQueryTree.prototype.parseQueryString=function(a){return ra.parser.parse(a)};L.AbstractQueryTree.prototype.parseExecutableUnit=function(a){if(a.kind==="select")return this.parseSelect(a);else if(a.kind==="ask")return this.parseSelect(a);else if(a.kind==="modify")return this.parseSelect(a);else if(a.kind===
"construct")return this.parseSelect(a);else if(a.kind==="insertdata")return this.parseInsertData(a);else if(a.kind==="deletedata")return this.parseInsertData(a);else if(a.kind==="load")return a;else if(a.kind==="clear")return a;else if(a.kind==="drop")return a;else if(a.kind==="create")return a;else throw Error("unknown executable unit: "+a.kind);};L.AbstractQueryTree.prototype.parseSelect=function(a){return a==null?(console.log("error parsing query"),null):(a.pattern=this.build(a.pattern,{freshCounter:0}),
a)};L.AbstractQueryTree.prototype.parseInsertData=function(a){return a==null?(console.log("error parsing query"),null):a};L.AbstractQueryTree.prototype.build=function(a,b){if(a.token==="groupgraphpattern")return this._buildGroupGraphPattern(a,b);else if(a.token==="basicgraphpattern"){var e={kind:"BGP",value:a.triplesContext};return e=L.translatePathExpressionsInBGP(e,b)}else if(a.token==="graphunionpattern"){var e=this.build(a.value[0],b),c=this.build(a.value[1],b);return{kind:"UNION",value:[e,c]}}else if(a.token===
"graphgraphpattern")return{kind:"GRAPH",value:this.build(a.value,b),graph:a.graph};else throw Error("not supported token in query:"+a.token);};L.translatePathExpressionsInBGP=function(a,b){var e,c=[],h,f;for(f=0;f<a.value.length;f++)if(a.value[f].predicate&&a.value[f].predicate.token==="path"){e=a.value[f];h=a.value.slice(f+1);var g=L.translatePathExpression(e,b);e=null;if(g.kind==="BGP")c=c.concat(g.value);else if(g.kind==="ZERO_OR_MORE_PATH"||g.kind==="ONE_OR_MORE_PATH"){f=c.length>0?{kind:"JOIN",
lvalue:{kind:"BGP",value:c},rvalue:g}:g;if(g.kind==="ZERO_OR_MORE_PATH")if(g.y.token==="var"&&g.y.value.indexOf("fresh:")===0&&g.x.token==="var"&&g.x.value.indexOf("fresh:")===0)for(var i=0;i<a.value.length;i++){if(a.value[i].object&&a.value[i].object.token==="var"&&a.value[i].object.value===g.x.value)e=v.clone(a.value[i]),e.object=g.y}else if(g.y.token==="var"&&g.y.value.indexOf("fresh:")===0)for(i=0;i<a.value.length;i++)if(a.value[i].subject&&a.value[i].subject.token==="var"&&a.value[i].subject.value===
g.y.value)e=v.clone(a.value[i]),e.subject=g.x;return h.length>0?(g=L.translatePathExpressionsInBGP({kind:"BGP",value:h},b),e!=null?(c=c.concat([e]).concat(h),{kind:"UNION",value:[{kind:"JOIN",lvalue:f,rvalue:g},{kind:"BGP",value:c}]}):{kind:"JOIN",lvalue:f,rvalue:g}):f}else return g}else c.push(a.value[f]);a.value=c;return a};L.translatePathExpression=function(a,b){if(a.predicate.kind==="element")if(a.predicate.modifier==="+"){a.predicate.modifier=null;var e=L.translatePathExpression(a,b);return{kind:"ONE_OR_MORE_PATH",
path:e,x:a.subject,y:a.object}}else return a.predicate.modifier==="*"?(a.predicate.modifier=null,e=L.translatePathExpression(a,b),{kind:"ZERO_OR_MORE_PATH",path:e,x:a.subject,y:a.object}):(a.predicate=a.predicate.value,{kind:"BGP",value:[a]});else if(a.predicate.kind==="sequence"){for(var e=a.subject,c=a.object,h=a.graph,f,g,i=[],r=0;r<a.predicate.value.length;r++){r!=a.predicate.value.length-1?(f={token:"var",value:"fresh:"+b.freshCounter},b.freshCounter++):f=c;g={subject:e,predicate:a.predicate.value[r],
object:f};if(h!=null)g.graph=v.clone(h);i.push(g);r!=a.predicate.value.length-1&&(e=v.clone(f))}return L.translatePathExpressionsInBGP({kind:"BGP",value:i},b)}};L.AbstractQueryTree.prototype._buildGroupGraphPattern=function(a,b){for(var e=a.filters||[],c={kind:"EMPTY_PATTERN"},h=0;h<a.patterns.length;h++){var f=a.patterns[h];f.token==="optionalgraphpattern"?(f=this.build(f.value,b),c=f.kind==="FILTER"?{kind:"LEFT_JOIN",lvalue:c,rvalue:f.value,filter:f.filter}:{kind:"LEFT_JOIN",lvalue:c,rvalue:f,filter:!0}):
(f=this.build(f,b),c=c.kind=="EMPTY_PATTERN"?f:{kind:"JOIN",lvalue:c,rvalue:f})}if(e.length!=0)if(c.kind==="EMPTY_PATTERN")return{kind:"FILTER",filter:e,value:c};else if(c.kind==="LEFT_JOIN"&&c.filter===!0)return{kind:"FILTER",filter:e,value:c};else if(c.kind==="LEFT_JOIN")return{kind:"FILTER",filter:e,value:c};else if(c.kind==="JOIN")return{kind:"FILTER",filter:e,value:c};else if(c.kind==="UNION")return{kind:"FILTER",filter:e,value:c};else if(c.kind==="GRAPH")return{kind:"FILTER",filter:e,value:c};
else if(c.kind==="BGP")return{kind:"FILTER",filter:e,value:c};else throw Error("Unknow kind of algebra expression: "+c.kind);else return c};L.AbstractQueryTree.prototype.collectBasicTriples=function(a,b){b==null&&(b=[]);if(a.kind==="select")b=this.collectBasicTriples(a.pattern,b);else if(a.kind==="BGP")b=b.concat(a.value);else if(a.kind==="ZERO_OR_MORE_PATH")b=this.collectBasicTriples(a.path);else if(a.kind==="UNION")b=this.collectBasicTriples(a.value[0],b),b=this.collectBasicTriples(a.value[1],b);
else if(a.kind==="GRAPH")b=this.collectBasicTriples(a.value,b);else if(a.kind==="LEFT_JOIN"||a.kind==="JOIN")b=this.collectBasicTriples(a.lvalue,b),b=this.collectBasicTriples(a.rvalue,b);else if(a.kind==="FILTER")b=this.collectBasicTriples(a.value,b);else if(a.kind==="construct")b=this.collectBasicTriples(a.pattern,b);else if(a.kind!=="EMPTY_PATTERN")throw"Unknown pattern: "+a.kind;return b};L.AbstractQueryTree.prototype.bind=function(a,b){if(a.graph!=null&&a.graph.token&&a.graph.token==="var"&&b[a.graph.value]!=
null)a.graph=b[a.graph.value];if(a.filter!=null){for(var e=[],c=0;c<a.filter.length;c++)a.filter[c].value=this._bindFilter(a.filter[c].value,b),e.push(a.filter[c]);a.filter=e}if(a.kind==="select")a.pattern=this.bind(a.pattern,b);else if(a.kind==="BGP")a.value=this._bindTripleContext(a.value,b);else if(a.kind==="ZERO_OR_MORE_PATH"){a.path=this._bindTripleContext(a.path,b);if(a.x&&a.x.token==="var"&&b[a.x.value]!=null)a.x=b[a.x.value];if(a.y&&a.y.token==="var"&&b[a.y.value]!=null)a.y=b[a.y.value]}else if(a.kind===
"UNION")a.value[0]=this.bind(a.value[0],b),a.value[1]=this.bind(a.value[1],b);else if(a.kind==="GRAPH")a.value=this.bind(a.value,b);else if(a.kind==="LEFT_JOIN"||a.kind==="JOIN")a.lvalue=this.bind(a.lvalue,b),a.rvalue=this.bind(a.rvalue,b);else if(a.kind==="FILTER")a.filter=this._bindFilter(a.filter[c].value,b);else if(a.kind!=="EMPTY_PATTERN")throw"Unknown pattern: "+a.kind;return a};L.AbstractQueryTree.prototype._bindTripleContext=function(a,b){for(var e=0;e<a.length;e++){delete a[e].graph;delete a[e].variables;
for(var c in a[e]){var h=a[e][c];h.token==="var"&&b[h.value]!=null&&(a[e][c]=b[h.value])}}return a};L.AbstractQueryTree.prototype._bindFilter=function(a,b){if(a.expressionType!=null){var e=a.expressionType;if(e=="relationalexpression")a.op1=this._bindFilter(a.op1,b),a.op2=this._bindFilter(a.op2,b);else if(e=="conditionalor"||e=="conditionaland")for(e=0;e<a.operands.length;e++)a.operands[e]=this._bindFilter(a.operands[e],b);else if(e=="additiveexpression"){a.summand=this._bindFilter(a.summand,b);for(e=
0;e<a.summands.length;e++)a.summands[e].expression=this._bindFilter(a.summands[e].expression,b)}else if(e=="builtincall")for(e=0;e<a.args.length;e++)a.args[e]=this._bindFilter(a.args[e],b);else if(e=="multiplicativeexpression"){a.factor=this._bindFilter(a.factor,b);for(e=0;e<a.factors.length;e++)a.factors[e].expression=this._bindFilter(a.factors[e].expression,b)}else if(e=="unaryexpression")a.expression=this._bindFilter(a.expression,b);else if(e=="irireforfunction")for(e=0;e<a.factors.args;e++)a.args[e]=
this._bindFilter(a.args[e],b);else if(e=="atomic"&&a.primaryexpression=="var"&&b[a.value.value]!=null)e=b[a.value.value],a.primaryexpression=e.token==="uri"?"iri":"literal",a.value=e}return a};L.AbstractQueryTree.prototype.replace=function(a,b,e,c){if(a.graph!=null&&a.graph.token&&a.graph.token===b.token&&a.graph.value==b.value)a.graph=v.clone(e);if(a.filter!=null){for(var h=[],f=0;f<a.filter.length;f++)a.filter[f].value=this._replaceFilter(a.filter[f].value,b,e,c),h.push(a.filter[f]);a.filter=h}if(a.kind===
"select")a.pattern=this.replace(a.pattern,b,e,c);else if(a.kind==="BGP")a.value=this._replaceTripleContext(a.value,b,e,c);else if(a.kind==="ZERO_OR_MORE_PATH"){a.path=this._replaceTripleContext(a.path,b,e,c);if(a.x&&a.x.token===b.token&&a.value===b.value)a.x=v.clone(e);if(a.y&&a.y.token===b.token&&a.value===b.value)a.y=v.clone(e)}else if(a.kind==="UNION")a.value[0]=this.replace(a.value[0],b,e,c),a.value[1]=this.replace(a.value[1],b,e,c);else if(a.kind==="GRAPH")a.value=this.replace(a.value,b,e);else if(a.kind===
"LEFT_JOIN"||a.kind==="JOIN")a.lvalue=this.replace(a.lvalue,b,e,c),a.rvalue=this.replace(a.rvalue,b,e,c);else if(a.kind==="FILTER")a.value=this._replaceFilter(a.value,b,e,c);else if(a.kind!=="EMPTY_PATTERN")throw"Unknown pattern: "+a.kind;return a};L.AbstractQueryTree.prototype._replaceTripleContext=function(a,b,e,c){for(var h=0;h<a.length;h++)for(var f in a[h]){var g=a[h][f];if(g.token==="var"&&b.token==="var"&&g.value===b.value)a[h][f]=e;else if(g.token==="blank"&&b.token==="blank"&&g.value===b.value)a[h][f]=
e;else if((g.token==="literal"||g.token==="uri")&&(b.token==="literal"||b.token==="uri")&&g.token===b.token&&v.lexicalFormTerm(g,c)[g.token]===v.lexicalFormTerm(b,c)[g.token])a[h][f]=e}return a};L.AbstractQueryTree.prototype._replaceFilter=function(a,b,e,c){if(a.expressionType!=null){var h=a.expressionType;if(h=="relationalexpression")a.op1=this._replaceFilter(a.op1,b,e,c),a.op2=this._replaceFilter(a.op2,b,e,c);else if(h=="conditionalor"||h=="conditionaland")for(h=0;h<a.operands.length;h++)a.operands[h]=
this._replaceFilter(a.operands[h],b,e,c);else if(h=="additiveexpression"){a.summand=this._replaceFilter(a.summand,b,e,c);for(h=0;h<a.summands.length;h++)a.summands[h].expression=this._replaceFilter(a.summands[h].expression,b,e,c)}else if(h=="builtincall")for(h=0;h<a.args.length;h++)a.args[h]=this._replaceFilter(a.args[h],b,e,c);else if(h=="multiplicativeexpression"){a.factor=this._replaceFilter(a.factor,b,e,c);for(h=0;h<a.factors.length;h++)a.factors[h].expression=this._replaceFilter(a.factors[h].expression,
b,e,c)}else if(h=="unaryexpression")a.expression=this._replaceFilter(a.expression,b,e,c);else if(h=="irireforfunction")for(h=0;h<a.factors.args;h++)a.args[h]=this._replaceFilter(a.args[h],b,e,c);else if(h=="atomic"){c=null;if(a.primaryexpression==b.token&&a.value==b.value)c=e.value;else if(a.primaryexpression=="iri"&&b.token=="uri"&&a.value==b.value)c=e.value;if(c!=null)a.primaryexpression=e.token==="uri"?"iri":e.token,a.value=c}}return a};L.AbstractQueryTree.prototype.treeWithUnion=function(a){if(a==
null)return!1;if(a.kind==null)return!1;if(a.kind==="select")return this.treeWithUnion(a.pattern);else if(a.kind==="BGP")return this.treeWithUnion(a.value);else if(a.kind==="ZERO_OR_MORE_PATH")return!1;else if(a.kind==="UNION")if(console.log("UNION!!"),a.value[0].value!=null&&a.value[0].value.variables!=null&&a.value[1].value!=null&&a.value[1].value.variables!=null){if(console.log("COMPARING:"+a.value[0].variables.join("/")),console.log("VS "+a.values[1].variables.join("/")),a.value[0].variables.join("/")===
a.values[1].variables.join("/"))return this.treeWithUnion(a.value[0])?!0:this.treeWithUnion(a.value[1])}else return!0;else if(a.kind==="GRAPH")return!1;else if(a.kind==="LEFT_JOIN"||a.kind==="JOIN")if(this.treeWithUnion(a.lvalue))return!0;else this.treeWithUnion(a.rvalue);else return!1};var ra={};ra.parser=function(){function a(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,
escape)+'"'}var b={parse:function(e,b){function h(q){d<sa||(d>sa&&(sa=d,ab=[]),ab.push(q))}function f(){var q,a,e,b;j++;b=e=d;q=g();q!==null?(a=s(),a===null&&(a=v(),a===null&&(a=y(),a===null&&(a=A()))),a!==null?q=[q,a]:(q=null,d=b)):(q=null,d=b);q!==null&&(q={token:"query",kind:"query",prologue:q[0],units:[q[1]]});q===null&&(d=e);j--;j===0&&q===null&&h("[2] Query");return q}function g(){var q,a,e,b,c,g;j++;g=c=d;q=i();q=q!==null?q:"";if(q!==null){a=[];for(e=l();e!==null;)a.push(e),e=l();if(a!==null){e=
[];for(b=r();b!==null;)e.push(b),b=r();e!==null?q=[q,a,e]:(q=null,d=g)}else q=null,d=g}else q=null,d=g;q!==null&&(q={token:"prologue",base:q[0],prefixes:q[2]});q===null&&(d=c);j--;j===0&&q===null&&h("[3] Prologue");return q}function i(){var q,a,b,c,D,g;j++;g=D=d;q=[];for(a=l();a!==null;)q.push(a),a=l();if(q!==null)if(e.substr(d,4)==="BASE"?(a="BASE",d+=4):(a=null,j===0&&h('"BASE"')),a===null&&(e.substr(d,4)==="base"?(a="base",d+=4):(a=null,j===0&&h('"base"'))),a!==null){b=[];for(c=l();c!==null;)b.push(c),
c=l();b!==null?(c=Ba(),c!==null?q=[q,a,b,c]:(q=null,d=g)):(q=null,d=g)}else q=null,d=g;else q=null,d=g;q!==null&&(q=function(q,a){var d={token:"base"};d.value=a;return d}(D,q[3]));q===null&&(d=D);j--;j===0&&q===null&&h("[4] BaseDecl");return q}function r(){var q,a,b,c,D,g,f,i;j++;i=f=d;q=[];for(a=l();a!==null;)q.push(a),a=l();if(q!==null)if(e.substr(d,6)==="PREFIX"?(a="PREFIX",d+=6):(a=null,j===0&&h('"PREFIX"')),a===null&&(e.substr(d,6)==="prefix"?(a="prefix",d+=6):(a=null,j===0&&h('"prefix"'))),
a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(c=Ca(),c!==null){D=[];for(g=l();g!==null;)D.push(g),g=l();D!==null?(g=Ba(),g!==null?q=[q,a,b,c,D,g]:(q=null,d=i)):(q=null,d=i)}else q=null,d=i;else q=null,d=i}else q=null,d=i;else q=null,d=i;q!==null&&(q=function(q,a,d){q={token:"prefix"};q.prefix=a;q.local=d;return q}(f,q[3],q[5]));q===null&&(d=f);j--;j===0&&q===null&&h("[5] PrefixDecl");return q}function s(){var q,a,e,b,c,g,f,i,ea,o,n;j++;n=o=d;q=t();if(q!==null){a=[];for(e=l();e!==
null;)a.push(e),e=l();if(a!==null){e=[];for(b=k();b!==null;)e.push(b),b=k();if(e!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(c=u(),c!==null){g=[];for(f=l();f!==null;)g.push(f),f=l();if(g!==null)if(f=H(),f!==null){i=[];for(ea=l();ea!==null;)i.push(ea),ea=l();i!==null?(ea=M(),ea!==null?q=[q,a,e,b,c,g,f,i,ea]:(q=null,d=n)):(q=null,d=n)}else q=null,d=n;else q=null,d=n}else q=null,d=n;else q=null,d=n}else q=null,d=n}else q=null,d=n}else q=null,d=n;q!==null&&(q=function(q,a,d,e,b){for(var q=
{named:[],implicit:[]},h=0;h<d.length;h++){var B=d[h];B.kind==="default"?q.implicit.push(B.graph):q.named.push(B.graph)}q.named.length===0&&q.implicit.length===0&&q.implicit.push({token:"uri",prefix:null,suffix:null,value:"https://github.com/antoniogarrote/rdfstore-js#default_graph"});d={kind:"select",token:"executableunit"};d.dataset=q;d.projection=a.vars;d.modifier=a.modifier;d.pattern=e;if(b!=null&&b.limit!=null)d.limit=b.limit;if(b!=null&&b.offset!=null)d.offset=b.offset;if(b!=null&&b.order!=
null&&b.order!="")d.order=b.order;if(b!=null&&b.group!=null)d.group=b.group;return d}(o,q[0],q[2],q[4],q[6]));q===null&&(d=o);j--;j===0&&q===null&&h("[6] SelectQuery");return q}function m(){var q,a,e,b;j++;b=d;q=t();q!==null?(a=u(),a!==null?(e=H(),e!==null?q=[q,a,e]:(q=null,d=b)):(q=null,d=b)):(q=null,d=b);j--;j===0&&q===null&&h("[7] SubSelect");return q}function t(){var q,a,b,c,D,g,f,i,k,n,o,u,m,r,s,z,w,H,v,F,x;j++;F=v=d;q=[];for(a=l();a!==null;)q.push(a),a=l();if(q!==null)if(e.substr(d,6)==="SELECT"?
(a="SELECT",d+=6):(a=null,j===0&&h('"SELECT"')),a===null&&(e.substr(d,6)==="select"?(a="select",d+=6):(a=null,j===0&&h('"select"'))),a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.substr(d,8)==="DISTINCT"?(c="DISTINCT",d+=8):(c=null,j===0&&h('"DISTINCT"')),c===null&&(e.substr(d,8)==="distinct"?(c="distinct",d+=8):(c=null,j===0&&h('"distinct"'))),c===null&&(e.substr(d,7)==="REDUCED"?(c="REDUCED",d+=7):(c=null,j===0&&h('"REDUCED"')),c===null&&(e.substr(d,7)==="reduced"?(c="reduced",
d+=7):(c=null,j===0&&h('"reduced"')))),c=c!==null?c:"",c!==null){D=[];for(g=l();g!==null;)D.push(g),g=l();if(D!==null){x=d;f=[];for(i=l();i!==null;)f.push(i),i=l();if(f!==null)if(i=N(),i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();k!==null?f=[f,i,k]:(f=null,d=x)}else f=null,d=x;else f=null,d=x;if(f===null){x=d;f=[];for(i=l();i!==null;)f.push(i),i=l();if(f!==null)if(e.charCodeAt(d)===40?(i="(",d++):(i=null,j===0&&h('"("')),i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();if(k!==null)if(n=J(),
n!==null){o=[];for(u=l();u!==null;)o.push(u),u=l();if(o!==null)if(e.substr(d,2)==="AS"?(u="AS",d+=2):(u=null,j===0&&h('"AS"')),u===null&&(e.substr(d,2)==="as"?(u="as",d+=2):(u=null,j===0&&h('"as"'))),u!==null){m=[];for(r=l();r!==null;)m.push(r),r=l();if(m!==null)if(r=N(),r!==null){s=[];for(z=l();z!==null;)s.push(z),z=l();if(s!==null)if(e.charCodeAt(d)===41?(z=")",d++):(z=null,j===0&&h('")"')),z!==null){w=[];for(H=l();H!==null;)w.push(H),H=l();w!==null?f=[f,i,k,n,o,u,m,r,s,z,w]:(f=null,d=x)}else f=
null,d=x;else f=null,d=x}else f=null,d=x;else f=null,d=x}else f=null,d=x;else f=null,d=x}else f=null,d=x;else f=null,d=x}else f=null,d=x;else f=null,d=x}if(f!==null)for(g=[];f!==null;){g.push(f);x=d;f=[];for(i=l();i!==null;)f.push(i),i=l();if(f!==null)if(i=N(),i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();k!==null?f=[f,i,k]:(f=null,d=x)}else f=null,d=x;else f=null,d=x;if(f===null){x=d;f=[];for(i=l();i!==null;)f.push(i),i=l();if(f!==null)if(e.charCodeAt(d)===40?(i="(",d++):(i=null,j===0&&h('"("')),
i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();if(k!==null)if(n=J(),n!==null){o=[];for(u=l();u!==null;)o.push(u),u=l();if(o!==null)if(e.substr(d,2)==="AS"?(u="AS",d+=2):(u=null,j===0&&h('"AS"')),u===null&&(e.substr(d,2)==="as"?(u="as",d+=2):(u=null,j===0&&h('"as"'))),u!==null){m=[];for(r=l();r!==null;)m.push(r),r=l();if(m!==null)if(r=N(),r!==null){s=[];for(z=l();z!==null;)s.push(z),z=l();if(s!==null)if(e.charCodeAt(d)===41?(z=")",d++):(z=null,j===0&&h('")"')),z!==null){w=[];for(H=l();H!==null;)w.push(H),
H=l();w!==null?f=[f,i,k,n,o,u,m,r,s,z,w]:(f=null,d=x)}else f=null,d=x;else f=null,d=x}else f=null,d=x;else f=null,d=x}else f=null,d=x;else f=null,d=x}else f=null,d=x;else f=null,d=x}else f=null,d=x;else f=null,d=x}}else g=null;if(g===null){x=d;g=[];for(f=l();f!==null;)g.push(f),f=l();if(g!==null)if(e.charCodeAt(d)===42?(f="*",d++):(f=null,j===0&&h('"*"')),f!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?g=[g,f,i]:(g=null,d=x)}else g=null,d=x;else g=null,d=x}g!==null?q=[q,a,b,c,D,g]:(q=
null,d=F)}else q=null,d=F}else q=null,d=F;else q=null,d=F}else q=null,d=F;else q=null,d=F;q!==null&&(q=function(q,a,d){q=[];if(d.length===3&&d[1]==="*")return{vars:[{token:"variable",kind:"*"}],modifier:mb(a)};for(var e=0;e<d.length;e++){var b=d[e];b.length===3?q.push({token:"variable",kind:"var",value:b[1]}):q.push({token:"variable",kind:"aliased",expression:b[3],alias:b[7]})}return{vars:q,modifier:mb(a)}}(v,q[3],q[5]));q===null&&(d=v);j--;j===0&&q===null&&h("[8] SelectClause");return q}function v(){var q,
a,b,c,D,g,f,i,n,o,m,r;j++;r=m=d;q=[];for(a=l();a!==null;)q.push(a),a=l();if(q!==null)if(e.substr(d,9)==="CONSTRUCT"?(a="CONSTRUCT",d+=9):(a=null,j===0&&h('"CONSTRUCT"')),a===null&&(e.substr(d,9)==="construct"?(a="construct",d+=9):(a=null,j===0&&h('"construct"'))),a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(c=nb(),c!==null){D=[];for(g=l();g!==null;)D.push(g),g=l();if(D!==null){g=[];for(f=k();f!==null;)g.push(f),f=k();if(g!==null){f=[];for(i=l();i!==null;)f.push(i),i=l();if(f!==
null)if(i=u(),i!==null){n=[];for(o=l();o!==null;)n.push(o),o=l();n!==null?(o=H(),o!==null?q=[q,a,b,c,D,g,f,i,n,o]:(q=null,d=r)):(q=null,d=r)}else q=null,d=r;else q=null,d=r}else q=null,d=r}else q=null,d=r}else q=null,d=r;else q=null,d=r}else q=null,d=r;else q=null,d=r;q!==null&&(q=function(q,a,d,e,b){for(var q={named:[],implicit:[]},h=0;h<d.length;h++){var B=d[h];B.kind==="default"?q.implicit.push(B.graph):q.named.push(B.graph)}q.named.length===0&&q.implicit.length===0&&q.implicit.push({token:"uri",
prefix:null,suffix:null,value:"https://github.com/antoniogarrote/rdfstore-js#default_graph"});d={kind:"construct",token:"executableunit"};d.dataset=q;d.template=a;d.pattern=e;if(b!=null&&b.limit!=null)d.limit=b.limit;if(b!=null&&b.offset!=null)d.offset=b.offset;if(b!=null&&b.order!=null&&b.order!="")d.order=b.order;return d}(m,q[3],q[5],q[7],q[9]));q===null&&(d=m);j--;j===0&&q===null&&h("[9] ConstructQuery");return q}function y(){var q,a,b,c,D,g;j++;g=d;e.substr(d,8)==="DESCRIBE"?(q="DESCRIBE",d+=
8):(q=null,j===0&&h('"DESCRIBE"'));if(q!==null){b=fa();if(b!==null)for(a=[];b!==null;)a.push(b),b=fa();else a=null;a===null&&(e.charCodeAt(d)===42?(a="*",d++):(a=null,j===0&&h('"*"')));if(a!==null){b=[];for(c=k();c!==null;)b.push(c),c=k();b!==null?(c=u(),c=c!==null?c:"",c!==null?(D=H(),D!==null?q=[q,a,b,c,D]:(q=null,d=g)):(q=null,d=g)):(q=null,d=g)}else q=null,d=g}else q=null,d=g;j--;j===0&&q===null&&h("[10] DescribeQuery");return q}function A(){var q,a,b,c,D,g,f,i;j++;i=f=d;q=[];for(a=l();a!==null;)q.push(a),
a=l();if(q!==null)if(e.substr(d,3)==="ASK"?(a="ASK",d+=3):(a=null,j===0&&h('"ASK"')),a===null&&(e.substr(d,3)==="ask"?(a="ask",d+=3):(a=null,j===0&&h('"ask"'))),a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null){c=[];for(D=k();D!==null;)c.push(D),D=k();if(c!==null){D=[];for(g=l();g!==null;)D.push(g),g=l();D!==null?(g=u(),g!==null?q=[q,a,b,c,D,g]:(q=null,d=i)):(q=null,d=i)}else q=null,d=i}else q=null,d=i}else q=null,d=i;else q=null,d=i;q!==null&&(q=function(q,a,d){for(var q={named:[],
implicit:[]},e=0;e<a.length;e++){var b=a[e];b.kind==="implicit"?q.implicit.push(b.graph):q.named.push(b.graph)}q.named.length===0&&q.implicit.length===0&&q.implicit.push({token:"uri",prefix:null,suffix:null,value:"https://github.com/antoniogarrote/rdfstore-js#default_graph"});a={kind:"ask",token:"executableunit"};a.dataset=q;a.pattern=d;return a}(f,q[3],q[5]));q===null&&(d=f);j--;j===0&&q===null&&h("[11] AskQuery");return q}function k(){var q,a,b,c,D,g,f;j++;f=g=d;e.substr(d,4)==="FROM"?(q="FROM",
d+=4):(q=null,j===0&&h('"FROM"'));q===null&&(e.substr(d,4)==="from"?(q="from",d+=4):(q=null,j===0&&h('"from"')));if(q!==null){a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(b=o(),b===null&&(b=z()),b!==null){c=[];for(D=l();D!==null;)c.push(D),D=l();c!==null?q=[q,a,b,c]:(q=null,d=f)}else q=null,d=f;else q=null,d=f}else q=null,d=f;q!==null&&(q=q[2]);q===null&&(d=g);j--;j===0&&q===null&&h("[12] DatasetClause");return q}function o(){var q,a,b,e;j++;e=b=d;q=[];for(a=l();a!==null;)q.push(a),a=l();
q!==null?(a=O(),a!==null?q=[q,a]:(q=null,d=e)):(q=null,d=e);q!==null&&(q={graph:q[1],kind:"default",token:"graphClause"});q===null&&(d=b);j--;j===0&&q===null&&h("[13] DefaultGraphClause");return q}function z(){var q,a,b,c,D;j++;D=c=d;e.substr(d,5)==="NAMED"?(q="NAMED",d+=5):(q=null,j===0&&h('"NAMED"'));q===null&&(e.substr(d,5)==="named"?(q="named",d+=5):(q=null,j===0&&h('"named"')));if(q!==null){a=[];for(b=l();b!==null;)a.push(b),b=l();a!==null?(b=O(),b!==null?q=[q,a,b]:(q=null,d=D)):(q=null,d=D)}else q=
null,d=D;q!==null&&(q={graph:q[2],kind:"named",token:"graphCluase"});q===null&&(d=c);j--;j===0&&q===null&&h("[14] NamedGraphClause");return q}function u(){var q,a,b,c,D,g,f;j++;f=g=d;e.substr(d,5)==="WHERE"?(q="WHERE",d+=5):(q=null,j===0&&h('"WHERE"'));q===null&&(e.substr(d,5)==="where"?(q="where",d+=5):(q=null,j===0&&h('"where"')));q=q!==null?q:"";if(q!==null){a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(b=S(),b!==null){c=[];for(D=l();D!==null;)c.push(D),D=l();c!==null?q=[q,a,b,c]:(q=
null,d=f)}else q=null,d=f;else q=null,d=f}else q=null,d=f;q!==null&&(q=q[2]);q===null&&(d=g);j--;j===0&&q===null&&h("[16] WhereClause");return q}function H(){var a,b,e,c,D,g;j++;g=D=d;a=T();a=a!==null?a:"";a!==null?(b=C(),b=b!==null?b:"",b!==null?(e=G(),e=e!==null?e:"",e!==null?(c=I(),c=c!==null?c:"",c!==null?a=[a,b,e,c]:(a=null,d=g)):(a=null,d=g)):(a=null,d=g)):(a=null,d=g);a!==null&&(a=function(a,q,d,b){a={};if(b!=null){if(b.limit!=null)a.limit=b.limit;if(b.offset!=null)a.offset=b.offset}if(q!=
null)a.group=q;a.order=d;return a}(D,a[0],a[2],a[3]));a===null&&(d=D);j--;j===0&&a===null&&h("[17] SolutionModifier");return a}function T(){var a,b,B,c,g,f,i,k;j++;k=i=d;e.substr(d,5)==="GROUP"?(a="GROUP",d+=5):(a=null,j===0&&h('"GROUP"'));a===null&&(e.substr(d,5)==="group"?(a="group",d+=5):(a=null,j===0&&h('"group"')));if(a!==null){b=[];for(B=l();B!==null;)b.push(B),B=l();if(b!==null)if(e.substr(d,2)==="BY"?(B="BY",d+=2):(B=null,j===0&&h('"BY"')),B===null&&(e.substr(d,2)==="by"?(B="by",d+=2):(B=
null,j===0&&h('"by"'))),B!==null){c=[];for(g=l();g!==null;)c.push(g),g=l();if(c!==null){f=x();if(f!==null)for(g=[];f!==null;)g.push(f),f=x();else g=null;g!==null?a=[a,b,B,c,g]:(a=null,d=k)}else a=null,d=k}else a=null,d=k;else a=null,d=k}else a=null,d=k;a!==null&&(a=a[4]);a===null&&(d=i);j--;j===0&&a===null&&h("[18] GroupClause");return a}function x(){var a,b,B,c,g,f,i,k,n,o,u,m;j++;m=u=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(b=Da(),b!==null){B=[];for(c=l();c!==null;)B.push(c),c=
l();B!==null?a=[a,b,B]:(a=null,d=m)}else a=null,d=m;else a=null,d=m;a!==null&&(a=a[1]);a===null&&(d=u);if(a===null){m=u=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(b=bb(),b!==null){B=[];for(c=l();c!==null;)B.push(c),c=l();B!==null?a=[a,b,B]:(a=null,d=m)}else a=null,d=m;else a=null,d=m;a!==null&&(a=a[1]);a===null&&(d=u);if(a===null){m=u=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(e.charCodeAt(d)===40?(b="(",d++):(b=null,j===0&&h('"("')),b!==null){B=[];for(c=l();c!==null;)B.push(c),
c=l();if(B!==null)if(c=J(),c!==null){g=[];for(f=l();f!==null;)g.push(f),f=l();if(g!==null){n=d;e.substr(d,2)==="AS"?(f="AS",d+=2):(f=null,j===0&&h('"AS"'));f===null&&(e.substr(d,2)==="as"?(f="as",d+=2):(f=null,j===0&&h('"as"')));if(f!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(k=N(),k!==null?f=[f,i,k]:(f=null,d=n)):(f=null,d=n)}else f=null,d=n;f=f!==null?f:"";if(f!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();if(i!==null)if(e.charCodeAt(d)===41?(k=")",d++):(k=null,j===0&&h('")"')),
k!==null){n=[];for(o=l();o!==null;)n.push(o),o=l();n!==null?a=[a,b,B,c,g,f,i,k,n]:(a=null,d=m)}else a=null,d=m;else a=null,d=m}else a=null,d=m}else a=null,d=m}else a=null,d=m;else a=null,d=m}else a=null,d=m;else a=null,d=m;a!==null&&(a=a[5].length!=0?{token:"aliased_expression",expression:a[3],alias:a[5][2]}:a[3]);a===null&&(d=u);if(a===null){m=u=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(b=N(),b!==null){B=[];for(c=l();c!==null;)B.push(c),c=l();B!==null?a=[a,b,B]:(a=null,d=m)}else a=
null,d=m;else a=null,d=m;a!==null&&(a=a[1]);a===null&&(d=u)}}}j--;j===0&&a===null&&h("[19] GroupCondition");return a}function C(){var a,b,B,c;j++;c=d;e.substr(d,6)==="HAVING"?(a="HAVING",d+=6):(a=null,j===0&&h('"HAVING"'));if(a!==null){B=ta();if(B!==null)for(b=[];B!==null;)b.push(B),B=ta();else b=null;b!==null?a=[a,b]:(a=null,d=c)}else a=null,d=c;j--;j===0&&a===null&&h("[20] HavingClause");return a}function G(){var a,b,B,c,g,f,i,k,n;j++;n=k=d;e.substr(d,5)==="ORDER"?(a="ORDER",d+=5):(a=null,j===0&&
h('"ORDER"'));a===null&&(e.substr(d,5)==="order"?(a="order",d+=5):(a=null,j===0&&h('"order"')));if(a!==null){b=[];for(B=l();B!==null;)b.push(B),B=l();if(b!==null)if(e.substr(d,2)==="BY"?(B="BY",d+=2):(B=null,j===0&&h('"BY"')),B===null&&(e.substr(d,2)==="by"?(B="by",d+=2):(B=null,j===0&&h('"by"'))),B!==null){c=[];for(g=l();g!==null;)c.push(g),g=l();if(c!==null){f=E();if(f!==null)for(g=[];f!==null;)g.push(f),f=E();else g=null;if(g!==null){f=[];for(i=l();i!==null;)f.push(i),i=l();f!==null?a=[a,b,B,c,
g,f]:(a=null,d=n)}else a=null,d=n}else a=null,d=n}else a=null,d=n;else a=null,d=n}else a=null,d=n;a!==null&&(a=a[4]);a===null&&(d=k);j--;j===0&&a===null&&h("[22] OrderClause");return a}function E(){var a,b,B,c,g,f,i;j++;i=f=d;e.substr(d,3)==="ASC"?(a="ASC",d+=3):(a=null,j===0&&h('"ASC"'));a===null&&(e.substr(d,3)==="asc"?(a="asc",d+=3):(a=null,j===0&&h('"asc"')),a===null&&(e.substr(d,4)==="DESC"?(a="DESC",d+=4):(a=null,j===0&&h('"DESC"')),a===null&&(e.substr(d,4)==="desc"?(a="desc",d+=4):(a=null,
j===0&&h('"desc"')))));if(a!==null){b=[];for(B=l();B!==null;)b.push(B),B=l();if(b!==null)if(B=Ea(),B!==null){c=[];for(g=l();g!==null;)c.push(g),g=l();c!==null?a=[a,b,B,c]:(a=null,d=i)}else a=null,d=i;else a=null,d=i}else a=null,d=i;a!==null&&(a={direction:a[0].toUpperCase(),expression:a[2]});a===null&&(d=f);if(a===null){i=f=d;a=ta();a===null&&(a=N());if(a!==null){b=[];for(B=l();B!==null;)b.push(B),B=l();b!==null?a=[a,b]:(a=null,d=i)}else a=null,d=i;a!==null&&(a=function(a,q){q.token==="var"&&(q={token:"expression",
expressionType:"atomic",primaryexpression:"var",value:q});return{direction:"ASC",expression:q}}(f,a[0]));a===null&&(d=f)}j--;j===0&&a===null&&h("[23] OrderCondition");return a}function I(){var a,b,e,c;j++;c=e=d;a=K();a!==null?(b=L(),b=b!==null?b:"",b!==null?a=[a,b]:(a=null,d=c)):(a=null,d=c);a===null&&(c=d,a=L(),a!==null?(b=K(),b=b!==null?b:"",b!==null?a=[a,b]:(a=null,d=c)):(a=null,d=c));a!==null&&(a=function(a,q){for(var d={},b=0;b<q.length;b++){var e=q[b];if(e.limit!=null)d.limit=e.limit;else if(e.offset!=
null)d.offset=e.offset}return d}(e,a));a===null&&(d=e);j--;j===0&&a===null&&h("[24] LimitOffsetClauses");return a}function K(){var a,b,c,g,f,i,k;j++;k=i=d;e.substr(d,5)==="LIMIT"?(a="LIMIT",d+=5):(a=null,j===0&&h('"LIMIT"'));a===null&&(e.substr(d,5)==="limit"?(a="limit",d+=5):(a=null,j===0&&h('"limit"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(c=$(),c!==null){g=[];for(f=l();f!==null;)g.push(f),f=l();g!==null?a=[a,b,c,g]:(a=null,d=k)}else a=null,d=k;else a=null,d=k}else a=
null,d=k;a!==null&&(a={limit:parseInt(a[2].value)});a===null&&(d=i);j--;j===0&&a===null&&h("[25] LimitClause");return a}function L(){var a,b,c,g,f,i,k;j++;k=i=d;e.substr(d,6)==="OFFSET"?(a="OFFSET",d+=6):(a=null,j===0&&h('"OFFSET"'));a===null&&(e.substr(d,6)==="offset"?(a="offset",d+=6):(a=null,j===0&&h('"offset"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(c=$(),c!==null){g=[];for(f=l();f!==null;)g.push(f),f=l();g!==null?a=[a,b,c,g]:(a=null,d=k)}else a=null,d=k;else a=
null,d=k}else a=null,d=k;a!==null&&(a={offset:parseInt(a[2].value)});a===null&&(d=i);j--;j===0&&a===null&&h("[26] OffsetClause");return a}function M(){var a,b,c,g,f,i,l,k,n;j++;k=d;e.substr(d,8)==="BINDINGS"?(a="BINDINGS",d+=8):(a=null,j===0&&h('"BINDINGS"'));if(a!==null){b=[];for(c=N();c!==null;)b.push(c),c=N();if(b!==null)if(e.charCodeAt(d)===123?(c="{",d++):(c=null,j===0&&h('"{"')),c!==null){g=[];n=d;e.charCodeAt(d)===40?(f="(",d++):(f=null,j===0&&h('"("'));if(f!==null){l=P();if(l!==null)for(i=
[];l!==null;)i.push(l),l=P();else i=null;i!==null?(e.charCodeAt(d)===41?(l=")",d++):(l=null,j===0&&h('")"')),l!==null?f=[f,i,l]:(f=null,d=n)):(f=null,d=n)}else f=null,d=n;for(f===null&&(f=ga());f!==null;){g.push(f);n=d;e.charCodeAt(d)===40?(f="(",d++):(f=null,j===0&&h('"("'));if(f!==null){l=P();if(l!==null)for(i=[];l!==null;)i.push(l),l=P();else i=null;i!==null?(e.charCodeAt(d)===41?(l=")",d++):(l=null,j===0&&h('")"')),l!==null?f=[f,i,l]:(f=null,d=n)):(f=null,d=n)}else f=null,d=n;f===null&&(f=ga())}g!==
null?(e.charCodeAt(d)===125?(f="}",d++):(f=null,j===0&&h('"}"')),f!==null?a=[a,b,c,g,f]:(a=null,d=k)):(a=null,d=k)}else a=null,d=k;else a=null,d=k}else a=null,d=k;a=a!==null?a:"";j--;j===0&&a===null&&h("[27] BindingsClause");return a}function P(){var a;j++;a=O();a===null&&(a=Fa(),a===null&&(a=Ga(),a===null&&(a=Ha(),a===null&&(e.substr(d,5)==="UNDEF"?(a="UNDEF",d+=5):(a=null,j===0&&h('"UNDEF"'))))));j--;j===0&&a===null&&h("[28] BindingValue");return a}function R(){var a,b,c,f,D,i,k,n,o,u;j++;o=n=d;
a=g();if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(c=V(),c!==null){u=d;f=[];for(D=l();D!==null;)f.push(D),D=l();if(f!==null)if(e.charCodeAt(d)===59?(D=";",d++):(D=null,j===0&&h('";"')),D!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(k=R(),k=k!==null?k:"",k!==null?f=[f,D,i,k]:(f=null,d=u)):(f=null,d=u)}else f=null,d=u;else f=null,d=u;f=f!==null?f:"";f!==null?a=[a,b,c,f]:(a=null,d=o)}else a=null,d=o;else a=null,d=o}else a=null,d=o;a!==null&&(a=function(a,q,d,b){a=
{token:"query",kind:"update"};a.prologue=q;q=[d];b.length!=null&&b[3]!=null&&b[3].units!=null&&(q=q.concat(b[3].units));a.units=q;return a}(n,a[0],a[2],a[3]));a===null&&(d=n);j--;j===0&&a===null&&h("[30] Update");return a}function V(){var a;j++;a=W();a===null&&(a=Z(),a===null&&(a=da(),a===null&&(a=ia(),a===null&&(a=ja(),a===null&&(a=pa(),a===null&&(a=qa(),a===null&&(a=ra())))))));j--;j===0&&a===null&&h("[31] Update1");return a}function W(){var a,b,c,g,f,i,k,n,o,u;j++;o=n=d;e.substr(d,4)==="LOAD"?
(a="LOAD",d+=4):(a=null,j===0&&h('"LOAD"'));a===null&&(e.substr(d,4)==="load"?(a="load",d+=4):(a=null,j===0&&h('"load"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(c=O(),c!==null){g=[];for(f=l();f!==null;)g.push(f),f=l();if(g!==null){u=d;e.substr(d,4)==="INTO"?(f="INTO",d+=4):(f=null,j===0&&h('"INTO"'));f===null&&(e.substr(d,4)==="into"?(f="into",d+=4):(f=null,j===0&&h('"into"')));if(f!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(k=Aa(),k!==null?f=[f,i,k]:
(f=null,d=u)):(f=null,d=u)}else f=null,d=u;f=f!==null?f:"";f!==null?a=[a,b,c,g,f]:(a=null,d=o)}else a=null,d=o}else a=null,d=o;else a=null,d=o}else a=null,d=o;a!==null&&(a=function(a,q,d){a={kind:"load",token:"executableunit"};a.sourceGraph=q;a.destinyGraph=d[2];return a}(n,a[2],a[4]));a===null&&(d=n);j--;j===0&&a===null&&h("[32] Load");return a}function Z(){var a,b,c,f,g,i,k;j++;k=i=d;e.substr(d,5)==="CLEAR"?(a="CLEAR",d+=5):(a=null,j===0&&h('"CLEAR"'));a===null&&(e.substr(d,5)==="clear"?(a="clear",
d+=5):(a=null,j===0&&h('"clear"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.substr(d,6)==="SILENT"?(c="SILENT",d+=6):(c=null,j===0&&h('"SILENT"')),c===null&&(e.substr(d,6)==="silent"?(c="silent",d+=6):(c=null,j===0&&h('"silent"'))),c=c!==null?c:"",c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();f!==null?(g=Ya(),g!==null?a=[a,b,c,f,g]:(a=null,d=k)):(a=null,d=k)}else a=null,d=k;else a=null,d=k}else a=null,d=k;a!==null&&(a=function(a,q){var d={kind:"clear",token:"executableunit"};
d.destinyGraph=q;return d}(i,a[4]));a===null&&(d=i);j--;j===0&&a===null&&h("[33] Clear");return a}function da(){var a,b,c,f,g,i,k;j++;k=i=d;e.substr(d,4)==="DROP"?(a="DROP",d+=4):(a=null,j===0&&h('"DROP"'));a===null&&(e.substr(d,4)==="drop"?(a="drop",d+=4):(a=null,j===0&&h('"drop"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.substr(d,6)==="SILENT"?(c="SILENT",d+=6):(c=null,j===0&&h('"SILENT"')),c===null&&(e.substr(d,6)==="silent"?(c="silent",d+=6):(c=null,j===0&&h('"silent"'))),
c=c!==null?c:"",c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();f!==null?(g=Ya(),g!==null?a=[a,b,c,f,g]:(a=null,d=k)):(a=null,d=k)}else a=null,d=k;else a=null,d=k}else a=null,d=k;a!==null&&(a=function(a,q){var d={kind:"drop",token:"executableunit"};d.destinyGraph=q;return d}(i,a[4]));a===null&&(d=i);j--;j===0&&a===null&&h("[34] Drop");return a}function ia(){var a,b,c,f,g,i,k;j++;k=i=d;e.substr(d,6)==="CREATE"?(a="CREATE",d+=6):(a=null,j===0&&h('"CREATE"'));a===null&&(e.substr(d,6)==="create"?(a=
"create",d+=6):(a=null,j===0&&h('"create"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.substr(d,6)==="SILENT"?(c="SILENT",d+=6):(c=null,j===0&&h('"SILENT"')),c===null&&(e.substr(d,6)==="silent"?(c="silent",d+=6):(c=null,j===0&&h('"silent"'))),c=c!==null?c:"",c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();f!==null?(g=Aa(),g!==null?a=[a,b,c,f,g]:(a=null,d=k)):(a=null,d=k)}else a=null,d=k;else a=null,d=k}else a=null,d=k;a!==null&&(a=function(a,q){var d={kind:"create",
token:"executableunit"};d.destinyGraph=q;return d}(i,a[4]));a===null&&(d=i);j--;j===0&&a===null&&h("[35] Create");return a}function ja(){var a,b,c,f,g,i,k;j++;k=i=d;e.substr(d,6)==="INSERT"?(a="INSERT",d+=6):(a=null,j===0&&h('"INSERT"'));a===null&&(e.substr(d,6)==="insert"?(a="insert",d+=6):(a=null,j===0&&h('"insert"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.substr(d,4)==="DATA"?(c="DATA",d+=4):(c=null,j===0&&h('"DATA"')),c===null&&(e.substr(d,4)==="data"?(c="data",
d+=4):(c=null,j===0&&h('"data"'))),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();f!==null?(g=Va(),g!==null?a=[a,b,c,f,g]:(a=null,d=k)):(a=null,d=k)}else a=null,d=k;else a=null,d=k}else a=null,d=k;a!==null&&(a=function(a,q){var d={kind:"insertdata",token:"executableunit"};d.quads=q;return d}(i,a[4]));a===null&&(d=i);j--;j===0&&a===null&&h("[36] InsertData");return a}function pa(){var a,b,c,f,g,i;j++;i=g=d;e.substr(d,6)==="DELETE"?(a="DELETE",d+=6):(a=null,j===0&&h('"DELETE"'));a===null&&(e.substr(d,
6)==="delete"?(a="delete",d+=6):(a=null,j===0&&h('"delete"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();b!==null?(e.substr(d,4)==="DATA"?(c="DATA",d+=4):(c=null,j===0&&h('"DATA"')),c===null&&(e.substr(d,4)==="data"?(c="data",d+=4):(c=null,j===0&&h('"data"'))),c!==null?(f=Va(),f!==null?a=[a,b,c,f]:(a=null,d=i)):(a=null,d=i)):(a=null,d=i)}else a=null,d=i;a!==null&&(a=function(a,q){var d={kind:"deletedata",token:"executableunit"};d.quads=q;return d}(g,a[3]));a===null&&(d=g);j--;j===0&&a===
null&&h("[37] DeleteData");return a}function qa(){var a,b,c,f,g,i,k;j++;k=i=d;e.substr(d,6)==="DELETE"?(a="DELETE",d+=6):(a=null,j===0&&h('"DELETE"'));a===null&&(e.substr(d,6)==="delete"?(a="delete",d+=6):(a=null,j===0&&h('"delete"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.substr(d,5)==="WHERE"?(c="WHERE",d+=5):(c=null,j===0&&h('"WHERE"')),c===null&&(e.substr(d,5)==="where"?(c="where",d+=5):(c=null,j===0&&h('"where"'))),c!==null){f=[];for(g=l();g!==null;)f.push(g),
g=l();f!==null?(g=S(),g!==null?a=[a,b,c,f,g]:(a=null,d=k)):(a=null,d=k)}else a=null,d=k;else a=null,d=k}else a=null,d=k;a!==null&&(a=function(a,q){var d={kind:"modify"};d.pattern=q;d["with"]=null;d.using=null;for(var b=[],e=q.patterns[0],e=e.triplesContext==null&&e.patterns!=null?e.patterns[0].triplesContext:e.triplesContext,h=0;h<e.length;h++){var c={},B=e[h];c.subject=B.subject;c.predicate=B.predicate;c.object=B.object;c.graph=B.graph;b.push(c)}d["delete"]=b;return d}(i,a[4]));a===null&&(d=i);j--;
j===0&&a===null&&h("[38] DeleteWhere");return a}function ra(){var a,b,c,g,f,i,k,n,o,u,m,r,s;j++;i=s=r=d;e.substr(d,4)==="WITH"?(a="WITH",d+=4):(a=null,j===0&&h('"WITH"'));a===null&&(e.substr(d,4)==="with"?(a="with",d+=4):(a=null,j===0&&h('"with"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();b!==null?(c=O(),c!==null?a=[a,b,c]:(a=null,d=i)):(a=null,d=i)}else a=null,d=i;a=a!==null?a:"";if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null){i=d;c=za();if(c!==null){g=[];for(f=l();f!==
null;)g.push(f),f=l();g!==null?(f=Wa(),f=f!==null?f:"",f!==null?c=[c,g,f]:(c=null,d=i)):(c=null,d=i)}else c=null,d=i;c===null&&(c=Wa());if(c!==null){g=[];for(f=l();f!==null;)g.push(f),f=l();if(g!==null){f=[];for(i=Xa();i!==null;)f.push(i),i=Xa();if(f!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();if(i!==null)if(e.substr(d,5)==="WHERE"?(k="WHERE",d+=5):(k=null,j===0&&h('"WHERE"')),k===null&&(e.substr(d,5)==="where"?(k="where",d+=5):(k=null,j===0&&h('"where"'))),k!==null){n=[];for(o=l();o!==null;)n.push(o),
o=l();if(n!==null)if(o=S(),o!==null){u=[];for(m=l();m!==null;)u.push(m),m=l();u!==null?a=[a,b,c,g,f,i,k,n,o,u]:(a=null,d=s)}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=null,d=s}else a=null,d=s}else a=null,d=s}else a=null,d=s}else a=null,d=s;a!==null&&(a=function(a,q,b,d,e){a={kind:"modify"};a["with"]=q!=""?q[2]:null;b.length===3&&b[2]===""?(a["delete"]=b[0],a.insert=null):b.length===3&&b[0].length!=null&&b[1].length!=null&&b[2].length!=null?(a["delete"]=b[0],a.insert=b[2]):
(a.insert=b,a["delete"]=null);d!=""&&(a.using=d);a.pattern=e;return a}(r,a[0],a[2],a[4],a[8]));a===null&&(d=r);j--;j===0&&a===null&&h("[39] Modify");return a}function za(){var a,b,c,f;j++;f=c=d;e.substr(d,6)==="DELETE"?(a="DELETE",d+=6):(a=null,j===0&&h('"DELETE"'));a===null&&(e.substr(d,6)==="delete"?(a="delete",d+=6):(a=null,j===0&&h('"delete"')));a!==null?(b=Ua(),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f);a!==null&&(a=a[1]);a===null&&(d=c);j--;j===0&&a===null&&h("[40] DeleteClause");return a}
function Wa(){var a,b,c,f;j++;f=c=d;e.substr(d,6)==="INSERT"?(a="INSERT",d+=6):(a=null,j===0&&h('"INSERT"'));a===null&&(e.substr(d,6)==="insert"?(a="insert",d+=6):(a=null,j===0&&h('"insert"')));a!==null?(b=Ua(),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f);a!==null&&(a=a[1]);a===null&&(d=c);j--;j===0&&a===null&&h("[41] InsertClause");return a}function Xa(){var a,b,c,f,g,i,k,n,o;j++;n=k=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(e.substr(d,5)==="USING"?(b="USING",d+=5):(b=null,j===0&&
h('"USING"')),b===null&&(e.substr(d,5)==="using"?(b="using",d+=5):(b=null,j===0&&h('"using"'))),b!==null){c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null){f=O();if(f===null)if(o=d,e.substr(d,5)==="NAMED"?(f="NAMED",d+=5):(f=null,j===0&&h('"NAMED"')),f===null&&(e.substr(d,5)==="named"?(f="named",d+=5):(f=null,j===0&&h('"named"'))),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=O(),i!==null?f=[f,g,i]:(f=null,d=o)):(f=null,d=o)}else f=null,d=o;f!==null?a=[a,b,c,f]:(a=null,d=n)}else a=
null,d=n}else a=null,d=n;else a=null,d=n;a!==null&&(a=a[3].length!=null?{kind:"named",uri:a[3][2]}:{kind:"default",uri:a[3]});a===null&&(d=k);j--;j===0&&a===null&&h("[42] UsingClause");return a}function Aa(){var a,b,c,f,g;j++;g=f=d;e.substr(d,5)==="GRAPH"?(a="GRAPH",d+=5):(a=null,j===0&&h('"GRAPH"'));a===null&&(e.substr(d,5)==="graph"?(a="graph",d+=5):(a=null,j===0&&h('"graph"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();b!==null?(c=O(),c!==null?a=[a,b,c]:(a=null,d=g)):(a=null,d=g)}else a=
null,d=g;a!==null&&(a=a[2]);a===null&&(d=f);j--;j===0&&a===null&&h("[43] GraphRef");return a}function Ya(){var a,b;j++;b=d;a=Aa();a===null&&(d=b);a===null&&(b=d,e.substr(d,7)==="DEFAULT"?(a="DEFAULT",d+=7):(a=null,j===0&&h('"DEFAULT"')),a===null&&(e.substr(d,7)==="default"?(a="default",d+=7):(a=null,j===0&&h('"default"'))),a!==null&&(a="default"),a===null&&(d=b),a===null&&(b=d,e.substr(d,5)==="NAMED"?(a="NAMED",d+=5):(a=null,j===0&&h('"NAMED"')),a===null&&(e.substr(d,5)==="named"?(a="named",d+=5):
(a=null,j===0&&h('"named"'))),a!==null&&(a="named"),a===null&&(d=b),a===null&&(b=d,e.substr(d,3)==="ALL"?(a="ALL",d+=3):(a=null,j===0&&h('"ALL"')),a===null&&(e.substr(d,3)==="all"?(a="all",d+=3):(a=null,j===0&&h('"all"'))),a!==null&&(a="all"),a===null&&(d=b))));j--;j===0&&a===null&&h("[44] GraphRefAll");return a}function Ua(){var a,b,c,f,g,i,k,n,o,u;j++;u=o=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(e.charCodeAt(d)===123?(b="{",d++):(b=null,j===0&&h('"{"')),b!==null){c=[];for(f=l();f!==
null;)c.push(f),f=l();if(c!==null)if(f=Za(),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();if(g!==null)if(e.charCodeAt(d)===125?(i="}",d++):(i=null,j===0&&h('"}"')),i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();k!==null?a=[a,b,c,f,g,i,k]:(a=null,d=u)}else a=null,d=u;else a=null,d=u}else a=null,d=u;else a=null,d=u}else a=null,d=u;else a=null,d=u;a!==null&&(a=a[3].quadsContext);a===null&&(d=o);j--;j===0&&a===null&&h("[45] QuadPattern");return a}function Va(){var a,b,c,f,g,i,k,n,o,u;j++;u=o=
d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(e.charCodeAt(d)===123?(b="{",d++):(b=null,j===0&&h('"{"')),b!==null){c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(f=Za(),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();if(g!==null)if(e.charCodeAt(d)===125?(i="}",d++):(i=null,j===0&&h('"}"')),i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();k!==null?a=[a,b,c,f,g,i,k]:(a=null,d=u)}else a=null,d=u;else a=null,d=u}else a=null,d=u;else a=null,d=u}else a=null,d=u;else a=null,d=u;
a!==null&&(a=a[3].quadsContext);a===null&&(d=o);j--;j===0&&a===null&&h("[46] QuadData");return a}function Za(){var a,b,c,f,g,i,l,k;j++;l=i=d;a=ka();a=a!==null?a:"";if(a!==null){b=[];k=d;c=$a();c!==null?(e.charCodeAt(d)===46?(f=".",d++):(f=null,j===0&&h('"."')),f=f!==null?f:"",f!==null?(g=ka(),g=g!==null?g:"",g!==null?c=[c,f,g]:(c=null,d=k)):(c=null,d=k)):(c=null,d=k);for(;c!==null;)b.push(c),k=d,c=$a(),c!==null?(e.charCodeAt(d)===46?(f=".",d++):(f=null,j===0&&h('"."')),f=f!==null?f:"",f!==null?(g=
ka(),g=g!==null?g:"",g!==null?c=[c,f,g]:(c=null,d=k)):(c=null,d=k)):(c=null,d=k);b!==null?a=[a,b]:(a=null,d=l)}else a=null,d=l;a!==null&&(a=function(a,b,q){a=[];if(b.triplesContext!=null&&b.triplesContext!=null)for(var d=0;d<b.triplesContext.length;d++){var e=b.triplesContext[d];e.graph=null;a.push(e)}if(q&&q.length>0&&q[0].length>0&&(a=a.concat(q[0][0].quadsContext),q[0][2]!=null&&q[0][2].triplesContext!=null))for(d=0;d<q[0][2].triplesContext.length;d++)e=q[0][2].triplesContext[d],e.graph=null,a.push(e);
return{token:"quads",quadsContext:a}}(i,a[0],a[1]));a===null&&(d=i);j--;j===0&&a===null&&h("[47] Quads");return a}function $a(){var a,b,c,f,g,i,k,n,o,u,m,r,s,z;j++;z=s=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(e.substr(d,5)==="GRAPH"?(b="GRAPH",d+=5):(b=null,j===0&&h('"GRAPH"')),b===null&&(e.substr(d,5)==="graph"?(b="graph",d+=5):(b=null,j===0&&h('"graph"'))),b!==null){c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(f=fa(),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();
if(g!==null)if(e.charCodeAt(d)===123?(i="{",d++):(i=null,j===0&&h('"{"')),i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();if(k!==null)if(n=ka(),n=n!==null?n:"",n!==null){o=[];for(u=l();u!==null;)o.push(u),u=l();if(o!==null)if(e.charCodeAt(d)===125?(u="}",d++):(u=null,j===0&&h('"}"')),u!==null){m=[];for(r=l();r!==null;)m.push(r),r=l();m!==null?a=[a,b,c,f,g,i,k,n,o,u,m]:(a=null,d=z)}else a=null,d=z;else a=null,d=z}else a=null,d=z;else a=null,d=z}else a=null,d=z;else a=null,d=z}else a=null,d=z;else a=
null,d=z}else a=null,d=z;else a=null,d=z;a!==null&&(a=function(a,b,q){for(var a=[],d=0;d<q.triplesContext.length;d++){var e=q.triplesContext[d];e.graph=b;a.push(e)}return{token:"quadsnottriples",quadsContext:a}}(s,a[3],a[7]));a===null&&(d=s);j--;j===0&&a===null&&h("[48] QuadsNotTriples");return a}function ka(){var a,b,c,f,g,i,k,n;j++;k=i=d;a=cb();if(a!==null){n=d;b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===46?(c=".",d++):(c=null,j===0&&h('"."')),c!==null){f=[];for(g=
l();g!==null;)f.push(g),g=l();f!==null?(g=ka(),g=g!==null?g:"",g!==null?b=[b,c,f,g]:(b=null,d=n)):(b=null,d=n)}else b=null,d=n;else b=null,d=n;b=b!==null?b:"";b!==null?a=[a,b]:(a=null,d=k)}else a=null,d=k;a!==null&&(a=function(a,b,d){a=b.triplesContext;typeof d==="object"&&d.length!=null&&d[3].triplesContext!=null&&(a=a.concat(d[3].triplesContext));return{token:"triplestemplate",triplesContext:a}}(i,a[0],a[1]));a===null&&(d=i);j--;j===0&&a===null&&h("[49] TriplesTemplate");return a}function S(){var a,
b,c,f,g,i,k;j++;k=i=d;e.charCodeAt(d)===123?(a="{",d++):(a=null,j===0&&h('"{"'));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(c=m(),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();f!==null?(e.charCodeAt(d)===125?(g="}",d++):(g=null,j===0&&h('"}"')),g!==null?a=[a,b,c,f,g]:(a=null,d=k)):(a=null,d=k)}else a=null,d=k;else a=null,d=k}else a=null,d=k;a!==null&&(a=a[2]);a===null&&(d=i);if(a===null){k=i=d;e.charCodeAt(d)===123?(a="{",d++):(a=null,j===0&&h('"{"'));if(a!==null){b=
[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(c=ob(),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();f!==null?(e.charCodeAt(d)===125?(g="}",d++):(g=null,j===0&&h('"}"')),g!==null?a=[a,b,c,f,g]:(a=null,d=k)):(a=null,d=k)}else a=null,d=k;else a=null,d=k}else a=null,d=k;a!==null&&(a=a[2]);a===null&&(d=i)}j--;j===0&&a===null&&h("[50] GroupGraphPattern");return a}function ob(){var a,b,c,f,g,i,k,n,o,u,m;j++;u=o=d;a=ua();a=a!==null?a:"";if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==
null){c=[];m=d;f=db();if(f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();if(g!==null)if(e.charCodeAt(d)===46?(i=".",d++):(i=null,j===0&&h('"."')),i=i!==null?i:"",i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();k!==null?(n=ua(),n=n!==null?n:"",n!==null?f=[f,g,i,k,n]:(f=null,d=m)):(f=null,d=m)}else f=null,d=m;else f=null,d=m}else f=null,d=m;for(;f!==null;)if(c.push(f),m=d,f=db(),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();if(g!==null)if(e.charCodeAt(d)===46?(i=".",d++):(i=null,j===0&&h('"."')),
i=i!==null?i:"",i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();k!==null?(n=ua(),n=n!==null?n:"",n!==null?f=[f,g,i,k,n]:(f=null,d=m)):(f=null,d=m)}else f=null,d=m;else f=null,d=m}else f=null,d=m;c!==null?a=[a,b,c]:(a=null,d=u)}else a=null,d=u}else a=null,d=u;a!==null&&(a=function(a,b,d){a=[];b!=null&&b!=[]&&a.push(b);for(b=0;b<d.length;b++)for(var q=0;q<d[b].length;q++)d[b][q].token!=null&&a.push(d[b][q]);for(var d=[],e=[],h=[],b=0;b<a.length;b++)if(a[b].token!="triplespattern"&&a[b].token!="filter"){if(e.length!=
0||h.length!=0){for(var c=[],q=0;q<e.length;q++)c=c.concat(e[q].triplesContext);c.length>0&&d.push({token:"basicgraphpattern",triplesContext:c});e=[]}d.push(a[b])}else a[b].token==="triplespattern"?e.push(a[b]):h.push(a[b]);if(e.length!=0||h.length!=0){c=[];for(q=0;q<e.length;q++)c=c.concat(e[q].triplesContext);c.length>0&&d.push({token:"basicgraphpattern",triplesContext:c})}return{token:"groupgraphpattern",patterns:d,filters:h}}(o,a[0],a[2]));a===null&&(d=o);j--;j===0&&a===null&&h("[51] GroupGraphPatternSub");
return a}function ua(){var a,b,c,f,g,i,k;j++;i=g=d;a=pb();if(a!==null){k=d;b=[];for(c=l();c!==null;)b.push(c),c=l();b!==null?(e.charCodeAt(d)===46?(c=".",d++):(c=null,j===0&&h('"."')),c!==null?(f=ua(),f=f!==null?f:"",f!==null?b=[b,c,f]:(b=null,d=k)):(b=null,d=k)):(b=null,d=k);b=b!==null?b:"";b!==null?a=[a,b]:(a=null,d=i)}else a=null,d=i;a!==null&&(a=function(a,b,d){a=b.triplesContext;typeof d==="object"&&d.length!=null&&d[2].triplesContext!=null&&(a=a.concat(d[2].triplesContext));return{token:"triplespattern",
triplesContext:a}}(g,a[0],a[1]));a===null&&(d=g);j--;j===0&&a===null&&h("[54] TriplesBlock");return a}function db(){var a;j++;a=qb();a===null&&(a=rb(),a===null&&(a=sb(),a===null&&(a=tb(),a===null&&(a=ub(),a===null&&(a=vb())))));j--;j===0&&a===null&&h("[53] GraphPatternNotTriples");return a}function rb(){var a,b,c,f,g,i;j++;i=g=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(e.substr(d,8)==="OPTIONAL"?(b="OPTIONAL",d+=8):(b=null,j===0&&h('"OPTIONAL"')),b===null&&(e.substr(d,8)==="optional"?
(b="optional",d+=8):(b=null,j===0&&h('"optional"'))),b!==null){c=[];for(f=l();f!==null;)c.push(f),f=l();c!==null?(f=S(),f!==null?a=[a,b,c,f]:(a=null,d=i)):(a=null,d=i)}else a=null,d=i;else a=null,d=i;a!==null&&(a={token:"optionalgraphpattern",value:a[3]});a===null&&(d=g);j--;j===0&&a===null&&h("[54] OptionalGraphPattern");return a}function tb(){var a,b,c,f,g,i,k,n;j++;n=k=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(e.substr(d,5)==="GRAPH"?(b="GRAPH",d+=5):(b=null,j===0&&h('"GRAPH"')),
b===null&&(e.substr(d,5)==="graph"?(b="graph",d+=5):(b=null,j===0&&h('"graph"'))),b!==null){c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(f=fa(),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=S(),i!==null?a=[a,b,c,f,g,i]:(a=null,d=n)):(a=null,d=n)}else a=null,d=n;else a=null,d=n}else a=null,d=n;else a=null,d=n;a!==null&&(a=function(a,b,d){for(a=0;a<d.patterns.length;a++)for(var q=d.patterns[a],e=0;e<q.triplesContext.length;e++)q.triplesContext[e].graph=b;d.token="groupgraphpattern";
return d}(k,a[3],a[5]));a===null&&(d=k);j--;j===0&&a===null&&h("[55] GraphGraphPattern");return a}function ub(){var a,b,c,f,g;j++;g=f=d;e.substr(d,7)==="SERVICE"?(a="SERVICE",d+=7):(a=null,j===0&&h('"SERVICE"'));a!==null?(b=fa(),b!==null?(c=S(),c!==null?a=[a,b,c]:(a=null,d=g)):(a=null,d=g)):(a=null,d=g);a!==null&&(a={token:"servicegraphpattern",status:"todo",value:[a[1],a[2]]});a===null&&(d=f);j--;j===0&&a===null&&h("[56] ServiceGraphPattern");return a}function sb(){var a,b,c,f;j++;f=c=d;e.substr(d,
5)==="MINUS"?(a="MINUS",d+=5):(a=null,j===0&&h('"MINUS"'));a!==null?(b=S(),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f);a!==null&&(a={token:"minusgraphpattern",status:"todo",value:a[1]});a===null&&(d=c);j--;j===0&&a===null&&h("[57] MinusGraphPattern");return a}function qb(){var a,b,c,f,g,i,k,n,o;j++;n=k=d;a=S();if(a!==null){b=[];o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.substr(d,5)==="UNION"?(f="UNION",d+=5):(f=null,j===0&&h('"UNION"')),f===null&&(e.substr(d,5)==="union"?(f="union",
d+=5):(f=null,j===0&&h('"union"'))),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=S(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o;for(;c!==null;){b.push(c);o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.substr(d,5)==="UNION"?(f="UNION",d+=5):(f=null,j===0&&h('"UNION"')),f===null&&(e.substr(d,5)==="union"?(f="union",d+=5):(f=null,j===0&&h('"union"'))),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=S(),i!==null?c=[c,
f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o}b!==null?a=[a,b]:(a=null,d=n)}else a=null,d=n;a!==null&&(a=function(a,b,d){if(d.length===0)return b;else{a={token:"graphunionpattern",value:[b]};for(b=0;b<d.length;b++)b==d.length-1?a.value.push(d[b][3]):(a.value.push(d[b][3]),a={token:"graphunionpattern",value:[a]});return a}}(k,a[0],a[1]));a===null&&(d=k);j--;j===0&&a===null&&h("[58] GroupOrUnionGraphPattern");return a}function vb(){var a,b,c,f,g,i;j++;i=g=d;a=[];for(b=l();b!==null;)a.push(b),
b=l();if(a!==null)if(e.substr(d,6)==="FILTER"?(b="FILTER",d+=6):(b=null,j===0&&h('"FILTER"')),b===null&&(e.substr(d,6)==="filter"?(b="filter",d+=6):(b=null,j===0&&h('"filter"'))),b!==null){c=[];for(f=l();f!==null;)c.push(f),f=l();c!==null?(f=ta(),f!==null?a=[a,b,c,f]:(a=null,d=i)):(a=null,d=i)}else a=null,d=i;else a=null,d=i;a!==null&&(a={token:"filter",value:a[3]});a===null&&(d=g);j--;j===0&&a===null&&h("[59] Filter");return a}function ta(){var a;j++;a=Ea();a===null&&(a=Da(),a===null&&(a=bb()));
j--;j===0&&a===null&&h("[60] Constraint");return a}function bb(){var a,b,e,c;j++;c=e=d;a=O();a!==null?(b=eb(),b!==null?a=[a,b]:(a=null,d=c)):(a=null,d=c);a!==null&&(a=function(a,b,d){a={token:"expression",expressionType:"irireforfunction"};a.iriref=b;a.args=d.value;return a}(e,a[0],a[1]));a===null&&(d=e);j--;j===0&&a===null&&h("[61] FunctionCall");return a}function eb(){var a,b,c,f,g,i,k,l,n;j++;k=d;a=ga();a!==null&&(a={token:"args",value:[]});a===null&&(d=k);if(a===null){l=k=d;e.charCodeAt(d)===
40?(a="(",d++):(a=null,j===0&&h('"("'));if(a!==null)if(e.substr(d,8)==="DISTINCT"?(b="DISTINCT",d+=8):(b=null,j===0&&h('"DISTINCT"')),b===null&&(e.substr(d,8)==="distinct"?(b="distinct",d+=8):(b=null,j===0&&h('"distinct"'))),b=b!==null?b:"",b!==null)if(c=J(),c!==null){f=[];n=d;e.charCodeAt(d)===44?(g=",",d++):(g=null,j===0&&h('","'));g!==null?(i=J(),i!==null?g=[g,i]:(g=null,d=n)):(g=null,d=n);for(;g!==null;)f.push(g),n=d,e.charCodeAt(d)===44?(g=",",d++):(g=null,j===0&&h('","')),g!==null?(i=J(),i!==
null?g=[g,i]:(g=null,d=n)):(g=null,d=n);f!==null?(e.charCodeAt(d)===41?(g=")",d++):(g=null,j===0&&h('")"')),g!==null?a=[a,b,c,f,g]:(a=null,d=l)):(a=null,d=l)}else a=null,d=l;else a=null,d=l;else a=null,d=l;a!==null&&(a=function(a,b,d,e){for(var a=[],q=0;q<e.length;q++)a.push(e[q][1]);e={token:"args"};e.value=[d].concat(a);e.distinct=b!=null&&b.toUpperCase()==="DISTINCT"?!0:!1;return e}(k,a[1],a[2],a[3]));a===null&&(d=k)}j--;j===0&&a===null&&h("[62] ArgList");return a}function wb(){var a,b,c,f,g,i,
k,l;j++;i=d;a=ga();a!==null&&(a={token:"args",value:[]});a===null&&(d=i);if(a===null){k=i=d;e.charCodeAt(d)===40?(a="(",d++):(a=null,j===0&&h('"("'));if(a!==null)if(b=J(),b!==null){c=[];l=d;e.charCodeAt(d)===44?(f=",",d++):(f=null,j===0&&h('","'));f!==null?(g=J(),g!==null?f=[f,g]:(f=null,d=l)):(f=null,d=l);for(;f!==null;)c.push(f),l=d,e.charCodeAt(d)===44?(f=",",d++):(f=null,j===0&&h('","')),f!==null?(g=J(),g!==null?f=[f,g]:(f=null,d=l)):(f=null,d=l);c!==null?(e.charCodeAt(d)===41?(f=")",d++):(f=
null,j===0&&h('")"')),f!==null?a=[a,b,c,f]:(a=null,d=k)):(a=null,d=k)}else a=null,d=k;else a=null,d=k;a!==null&&(a=function(a,b,d){for(var a=[],e=0;e<d.length;e++)a.push(d[e][1]);d={token:"args"};d.value=[b].concat(a);return d}(i,a[1],a[2]));a===null&&(d=i)}j--;j===0&&a===null&&h("[63] ExpressionList");return a}function nb(){var a,b,c,f,g,i,k;j++;k=i=d;e.charCodeAt(d)===123?(a="{",d++):(a=null,j===0&&h('"{"'));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(c=fb(),c=c!==null?
c:"",c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();f!==null?(e.charCodeAt(d)===125?(g="}",d++):(g=null,j===0&&h('"}"')),g!==null?a=[a,b,c,f,g]:(a=null,d=k)):(a=null,d=k)}else a=null,d=k;else a=null,d=k}else a=null,d=k;a!==null&&(a=a[2]);a===null&&(d=i);j--;j===0&&a===null&&h("[64] ConstructTemplate");return a}function fb(){var a,b,c,f,g,i,k,n;j++;k=i=d;a=cb();if(a!==null){n=d;b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===46?(c=".",d++):(c=null,j===0&&h('"."')),c!==
null){f=[];for(g=l();g!==null;)f.push(g),g=l();f!==null?(g=fb(),g=g!==null?g:"",g!==null?b=[b,c,f,g]:(b=null,d=n)):(b=null,d=n)}else b=null,d=n;else b=null,d=n;b=b!==null?b:"";b!==null?a=[a,b]:(a=null,d=k)}else a=null,d=k;a!==null&&(a=function(a,b,d){a=b.triplesContext;typeof d==="object"&&d.length!=null&&d[3].triplesContext!=null&&(a=a.concat(d[3].triplesContext));return{token:"triplestemplate",triplesContext:a}}(i,a[0],a[1]));a===null&&(d=i);j--;j===0&&a===null&&h("[65] ConstructTriples");return a}
function cb(){var a,b,e,c,f,g;j++;g=f=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(b=Ia(),b!==null){e=[];for(c=l();c!==null;)e.push(c),c=l();e!==null?(c=va(),c!==null?a=[a,b,e,c]:(a=null,d=g)):(a=null,d=g)}else a=null,d=g;else a=null,d=g;a!==null&&(a=function(a,b,d){a=d.triplesContext;if(d.pairs)for(var e=0;e<d.pairs.length;e++){var q=d.pairs[e],c=null;q[1].length!=null&&(q[1]=q[1][0]);b.token&&b.token==="triplesnodecollection"?(c={subject:b.chainSubject[0],predicate:q[0],object:q[1]},
a.push(c),a=a.concat(b.triplesContext)):(c={subject:b,predicate:q[0],object:q[1]},a.push(c))}d={token:"triplessamesubject"};d.triplesContext=a;d.chainSubject=b;return d}(f,a[1],a[3]));a===null&&(d=f);if(a===null){g=f=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(b=Ja(),b!==null){e=[];for(c=l();c!==null;)e.push(c),c=l();e!==null?(c=xb(),c!==null?a=[a,b,e,c]:(a=null,d=g)):(a=null,d=g)}else a=null,d=g;else a=null,d=g;a!==null&&(a=function(a,b,d){var a=b.triplesContext,e=b.chainSubject;if(d.pairs)for(var q=
0;q<d.pairs.length;q++){var c=d.pairs[q];c[1].length!=null&&(c[1]=c[1][0]);if(b.token==="triplesnodecollection")for(var h=0;h<e.length;h++){var f=e[h];if(f.triplesContext!=null){var g={subject:f.chainSubject,predicate:c[0],object:c[1]};a.concat(f.triplesContext)}else g={subject:e[h],predicate:c[0],object:c[1]},a.push(g)}else g={subject:e,predicate:c[0],object:c[1]},a.push(g)}b={token:"triplessamesubject"};b.triplesContext=a;b.chainSubject=e;return b}(f,a[1],a[3]));a===null&&(d=f)}j--;j===0&&a===null&&
h("[66] TriplesSameSubject");return a}function va(){var a,b,c,f,g,i,k,n,o,u,m,r,s,z;j++;r=m=d;a=Ka();if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(c=ha(),c!==null){f=[];s=d;g=[];for(i=l();i!==null;)g.push(i),i=l();if(g!==null)if(e.charCodeAt(d)===59?(i=";",d++):(i=null,j===0&&h('";"')),i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();if(k!==null){z=d;n=Ka();if(n!==null){o=[];for(u=l();u!==null;)o.push(u),u=l();o!==null?(u=ha(),u!==null?n=[n,o,u]:(n=null,d=z)):(n=null,d=z)}else n=
null,d=z;n=n!==null?n:"";n!==null?g=[g,i,k,n]:(g=null,d=s)}else g=null,d=s}else g=null,d=s;else g=null,d=s;for(;g!==null;){f.push(g);s=d;g=[];for(i=l();i!==null;)g.push(i),i=l();if(g!==null)if(e.charCodeAt(d)===59?(i=";",d++):(i=null,j===0&&h('";"')),i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();if(k!==null){z=d;n=Ka();if(n!==null){o=[];for(u=l();u!==null;)o.push(u),u=l();o!==null?(u=ha(),u!==null?n=[n,o,u]:(n=null,d=z)):(n=null,d=z)}else n=null,d=z;n=n!==null?n:"";n!==null?g=[g,i,k,n]:(g=null,
d=s)}else g=null,d=s}else g=null,d=s;else g=null,d=s}f!==null?a=[a,b,c,f]:(a=null,d=r)}else a=null,d=r;else a=null,d=r}else a=null,d=r;a!==null&&(a=function(a,b,d,e){for(var a={token:"propertylist"},q=[],c=[],h=0;h<d.length;h++)d[h].triplesContext!=null?(q=q.concat(d[h].triplesContext),d[h].token==="triplesnodecollection"&&d[h].chainSubject.length!=null?c.push([b,d[h].chainSubject[0]]):c.push([b,d[h].chainSubject])):c.push([b,d[h]]);for(h=0;h<e.length;h++)for(var d=e[h][3],b=d[0],d=d[2]||[],f=0;f<
d.length;f++)d[f].triplesContext!=null?(q=q.concat(d[f].triplesContext),c.push([b,d[f].chainSubject])):c.push([b,d[f]]);a.pairs=c;a.triplesContext=q;return a}(m,a[0],a[2],a[3]));a===null&&(d=m);j--;j===0&&a===null&&h("[67] PropertyListNotEmpty");return a}function xb(){var a;j++;a=va();a=a!==null?a:"";j--;j===0&&a===null&&h("[68] PropertyList");return a}function ha(){var a,b,c,f,g,i,k,n,o;j++;n=k=d;a=la();if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null){c=[];o=d;e.charCodeAt(d)===
44?(f=",",d++):(f=null,j===0&&h('","'));if(f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=la(),i!==null?f=[f,g,i]:(f=null,d=o)):(f=null,d=o)}else f=null,d=o;for(;f!==null;)if(c.push(f),o=d,e.charCodeAt(d)===44?(f=",",d++):(f=null,j===0&&h('","')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=la(),i!==null?f=[f,g,i]:(f=null,d=o)):(f=null,d=o)}else f=null,d=o;c!==null?a=[a,b,c]:(a=null,d=n)}else a=null,d=n}else a=null,d=n;a!==null&&(a=function(a,b,d){a=[];a.push(b);
for(b=0;b<d.length;b++)for(var e=0;e<d[b].length;e++)typeof d[b][e]=="object"&&d[b][e].token!=null&&a.push(d[b][e]);return a}(k,a[0],a[2]));a===null&&(d=k);j--;j===0&&a===null&&h("[69] ObjectList");return a}function Ka(){var a,b;j++;a=fa();a===null&&(b=d,e.charCodeAt(d)===97?(a="a",d++):(a=null,j===0&&h('"a"')),a!==null&&(a={token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"}),a===null&&(d=b));j--;j===0&&a===null&&h("[71] Verb");return a}function pb(){var a,
b,e,c,f,g;j++;g=f=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(b=Ia(),b!==null){e=[];for(c=l();c!==null;)e.push(c),c=l();e!==null?(c=yb(),c!==null?a=[a,b,e,c]:(a=null,d=g)):(a=null,d=g)}else a=null,d=g;else a=null,d=g;a!==null&&(a=function(a,b,d){a=d.triplesContext;if(d.pairs)for(var e=0;e<d.pairs.length;e++){var q=d.pairs[e],c=null;q[1].length!=null&&(q[1]=q[1][0]);b.token&&b.token==="triplesnodecollection"?(c={subject:b.chainSubject[0],predicate:q[0],object:q[1]},a.push(c),a=a.concat(b.triplesContext)):
(c={subject:b,predicate:q[0],object:q[1]},a.push(c))}d={token:"triplessamesubject"};d.triplesContext=a;d.chainSubject=b;return d}(f,a[1],a[3]));a===null&&(d=f);if(a===null){g=f=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(b=Ja(),b!==null){e=[];for(c=l();c!==null;)e.push(c),c=l();e!==null?(c=zb(),c!==null?a=[a,b,e,c]:(a=null,d=g)):(a=null,d=g)}else a=null,d=g;else a=null,d=g;a!==null&&(a=function(a,b,d){var a=b.triplesContext,e=b.chainSubject;if(d.pairs)for(var q=0;q<d.pairs.length;q++){var c=
d.pairs[q];c[1].length!=null&&(c[1]=c[1][0]);if(b.token==="triplesnodecollection")for(var h=0;h<e.length;h++){var f=e[h];if(f.triplesContext!=null){var g={subject:f.chainSubject,predicate:c[0],object:c[1]};a.concat(f.triplesContext)}else g={subject:e[h],predicate:c[0],object:c[1]},a.push(g)}else g={subject:e,predicate:c[0],object:c[1]},a.push(g)}b={token:"triplessamesubject"};b.triplesContext=a;b.chainSubject=e;return b}(f,a[1],a[3]));a===null&&(d=f)}j--;j===0&&a===null&&h("[72] TriplesSameSubjectPath");
return a}function yb(){var a,b,c,f,g,i,k,n,o,u,m,r,s;j++;m=u=d;a=La();a===null&&(a=N());if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(c=ha(),c!==null){f=[];r=d;g=[];for(i=l();i!==null;)g.push(i),i=l();if(g!==null)if(e.charCodeAt(d)===59?(i=";",d++):(i=null,j===0&&h('";"')),i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();k!==null?(s=d,n=La(),n===null&&(n=N()),n!==null?(o=ha(),o!==null?n=[n,o]:(n=null,d=s)):(n=null,d=s),n=n!==null?n:"",n!==null?g=[g,i,k,n]:(g=null,d=r)):(g=
null,d=r)}else g=null,d=r;else g=null,d=r;for(;g!==null;){f.push(g);r=d;g=[];for(i=l();i!==null;)g.push(i),i=l();if(g!==null)if(e.charCodeAt(d)===59?(i=";",d++):(i=null,j===0&&h('";"')),i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();k!==null?(s=d,n=La(),n===null&&(n=N()),n!==null?(o=ha(),o!==null?n=[n,o]:(n=null,d=s)):(n=null,d=s),n=n!==null?n:"",n!==null?g=[g,i,k,n]:(g=null,d=r)):(g=null,d=r)}else g=null,d=r;else g=null,d=r}f!==null?a=[a,b,c,f]:(a=null,d=m)}else a=null,d=m;else a=null,d=m}else a=
null,d=m;a!==null&&(a=function(a,b,d,e){token={token:"propertylist"};for(var a=[],q=[],c=0;c<d.length;c++)d[c].triplesContext!=null?(a=a.concat(d[c].triplesContext),d[c].token==="triplesnodecollection"&&d[c].chainSubject.length!=null?q.push([b,d[c].chainSubject[0]]):q.push([b,d[c].chainSubject])):q.push([b,d[c]]);for(c=0;c<e.length;c++)for(var d=e[c][3],b=d[0],d=d[1]||[],h=0;h<d.length;h++)d[h].triplesContext!=null?(a=a.concat(d[h].triplesContext),q.push([b,d[h].chainSubject])):q.push([b,d[h]]);token.pairs=
q;token.triplesContext=a;return token}(u,a[0],a[2],a[3]));a===null&&(d=u);j--;j===0&&a===null&&h("[73] PropertyListNotEmptyPath");return a}function zb(){var a;j++;a=va();a=a!==null?a:"";j--;j===0&&a===null&&h("[74] PropertyListPath");return a}function La(){var a,b;j++;b=d;a=gb();a===null&&(d=b);j--;j===0&&a===null&&h("[75]");return a}function gb(){var a,b,c,f,g,i,k;j++;i=g=d;a=Ma();if(a!==null){b=[];k=d;e.charCodeAt(d)===124?(c="|",d++):(c=null,j===0&&h('"|"'));c!==null?(f=Ma(),f!==null?c=[c,f]:(c=
null,d=k)):(c=null,d=k);for(;c!==null;)b.push(c),k=d,e.charCodeAt(d)===124?(c="|",d++):(c=null,j===0&&h('"|"')),c!==null?(f=Ma(),f!==null?c=[c,f]:(c=null,d=k)):(c=null,d=k);b!==null?a=[a,b]:(a=null,d=i)}else a=null,d=i;a!==null&&(a=function(a,b,d){if(d==null||d.length===0)return b;else{a=[];for(b=0;b<d.length;b++)a.push(d[1]);d={token:"path",kind:"alternative"};d.value=a;return d}}(g,a[0],a[1]));a===null&&(d=g);j--;j===0&&a===null&&h("[78] PathAlternative");return a}function Ma(){var a,b,c,f,g,i,
k;j++;i=g=d;a=Na();if(a!==null){b=[];k=d;e.charCodeAt(d)===47?(c="/",d++):(c=null,j===0&&h('"/"'));c!==null?(f=Na(),f!==null?c=[c,f]:(c=null,d=k)):(c=null,d=k);for(;c!==null;)b.push(c),k=d,e.charCodeAt(d)===47?(c="/",d++):(c=null,j===0&&h('"/"')),c!==null?(f=Na(),f!==null?c=[c,f]:(c=null,d=k)):(c=null,d=k);b!==null?a=[a,b]:(a=null,d=i)}else a=null,d=i;a!==null&&(a=function(a,b,d){if(d==null||d.length===0)return b;else{a=[b];for(b=0;b<d.length;b++)a.push(d[b][1]);d={token:"path",kind:"sequence"};d.value=
a;return d}}(g,a[0],a[1]));a===null&&(d=g);j--;j===0&&a===null&&h("[79] PathSequence");return a}function hb(){var a,b,e,c;j++;c=e=d;a=Ab();a!==null?(b=Bb(),b=b!==null?b:"",b!==null?a=[a,b]:(a=null,d=c)):(a=null,d=c);a!==null&&(a=function(a,b,d){if(b.token&&b.token!="path"&&d=="")return b;else if(b.token&&b.token!=e&&d!=""){var e={token:"path",kind:"element"};e.value=b;e.modifier=d;return e}else return b.modifier=d,b}(e,a[0],a[1]));a===null&&(d=e);j--;j===0&&a===null&&h("[88] PathElt");return a}function Na(){var a,
b,c,f;j++;a=hb();a===null&&(f=c=d,e.charCodeAt(d)===94?(a="^",d++):(a=null,j===0&&h('"^"')),a!==null?(b=hb(),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f),a!==null&&(a=function(a,b){var d={token:"path",kind:"inversePath"};d.value=b;return d}(c,a[1])),a===null&&(d=c));j--;j===0&&a===null&&h("[81] PathEltOrInverse");return a}function Bb(){var a,b,c,f,g,i,k,n,l;j++;e.charCodeAt(d)===42?(a="*",d++):(a=null,j===0&&h('"*"'));a===null&&(e.charCodeAt(d)===63?(a="?",d++):(a=null,j===0&&h('"?"')),a===null&&(e.charCodeAt(d)===
43?(a="+",d++):(a=null,j===0&&h('"+"')),a===null&&(i=d,e.charCodeAt(d)===123?(a="{",d++):(a=null,j===0&&h('"{"')),a!==null?(k=d,b=$(),b!==null?(n=d,e.charCodeAt(d)===44?(c=",",d++):(c=null,j===0&&h('","')),c!==null?(e.charCodeAt(d)===125?(f="}",d++):(f=null,j===0&&h('"}"')),f===null&&(l=d,f=$(),f!==null?(e.charCodeAt(d)===125?(g="}",d++):(g=null,j===0&&h('"}"')),g!==null?f=[f,g]:(f=null,d=l)):(f=null,d=l)),f!==null?c=[c,f]:(c=null,d=n)):(c=null,d=n),c===null&&(e.charCodeAt(d)===125?(c="}",d++):(c=
null,j===0&&h('"}"'))),c!==null?b=[b,c]:(b=null,d=k)):(b=null,d=k),b===null&&(k=d,e.charCodeAt(d)===44?(b=",",d++):(b=null,j===0&&h('","')),b!==null?(c=$(),c!==null?(e.charCodeAt(d)===125?(f="}",d++):(f=null,j===0&&h('"}"')),f!==null?b=[b,c,f]:(b=null,d=k)):(b=null,d=k)):(b=null,d=k)),b!==null?a=[a,b]:(a=null,d=i)):(a=null,d=i))));j--;j===0&&a===null&&h("[82] PathMod");return a}function Ab(){var a,b,c,f,g;j++;a=O();a===null&&(f=d,e.charCodeAt(d)===97?(a="a",d++):(a=null,j===0&&h('"a"')),a!==null&&
(a={token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"}),a===null&&(d=f),a===null&&(f=d,e.charCodeAt(d)===33?(a="!",d++):(a=null,j===0&&h('"!"')),a!==null?(b=Cb(),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f),a===null&&(g=f=d,e.charCodeAt(d)===40?(a="(",d++):(a=null,j===0&&h('"("')),a!==null?(b=gb(),b!==null?(e.charCodeAt(d)===41?(c=")",d++):(c=null,j===0&&h('")"')),c!==null?a=[a,b,c]:(a=null,d=g)):(a=null,d=g)):(a=null,d=g),a!==null&&(a=a[1]),a===null&&(d=f))));
j--;j===0&&a===null&&h("[83] PathPrimary");return a}function Cb(){var a,b,c,f,g,i,k,n;a=wa();if(a===null)if(i=d,e.charCodeAt(d)===40?(a="(",d++):(a=null,j===0&&h('"("')),a!==null){k=d;b=wa();if(b!==null){c=[];n=d;e.charCodeAt(d)===124?(f="|",d++):(f=null,j===0&&h('"|"'));f!==null?(g=wa(),g!==null?f=[f,g]:(f=null,d=n)):(f=null,d=n);for(;f!==null;)c.push(f),n=d,e.charCodeAt(d)===124?(f="|",d++):(f=null,j===0&&h('"|"')),f!==null?(g=wa(),g!==null?f=[f,g]:(f=null,d=n)):(f=null,d=n);c!==null?b=[b,c]:(b=
null,d=k)}else b=null,d=k;b=b!==null?b:"";b!==null?(e.charCodeAt(d)===41?(c=")",d++):(c=null,j===0&&h('")"')),c!==null?a=[a,b,c]:(a=null,d=i)):(a=null,d=i)}else a=null,d=i;return a}function wa(){var a,b,c;j++;a=O();a===null&&(e.charCodeAt(d)===97?(a="a",d++):(a=null,j===0&&h('"a"')),a===null&&(c=d,e.charCodeAt(d)===94?(a="^",d++):(a=null,j===0&&h('"^"')),a!==null?(b=O(),b===null&&(e.charCodeAt(d)===97?(b="a",d++):(b=null,j===0&&h('"a"'))),b!==null?a=[a,b]:(a=null,d=c)):(a=null,d=c)));j--;j===0&&a===
null&&h("[85] PathOneInPropertySet");return a}function Ja(){var a,b;j++;b=d;a=Db();a!==null&&(a=function(a,b){for(var d=[],e=[],q=null,c=0;c<b.length;c++)aa++,q=null,b[c].chainSubject==null&&b[c].triplesContext==null?q=b[c]:(q=b[c].chainSubject,d=d.concat(nextSubject.triplesContext)),q={subject:{token:"blank",value:"_:"+aa},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#first"},object:q},c==0&&e.push(q.subject),d.push(q),q=c===b.length-1?{subject:{token:"blank",
value:"_:"+aa},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"},object:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"}}:{subject:{token:"blank",value:"_:"+aa},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"},object:{token:"blank",value:"_:"+(aa+1)}},d.push(q);return{token:"triplesnodecollection",triplesContext:d,chainSubject:e}}(b,a));a===null&&
(d=b);a===null&&(a=Eb());j--;j===0&&a===null&&h("[87] TriplesNode");return a}function Eb(){var a,b,c,f,g,i,k,n,o,u;j++;u=o=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(e.charCodeAt(d)===91?(b="[",d++):(b=null,j===0&&h('"["')),b!==null){c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(f=va(),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();if(g!==null)if(e.charCodeAt(d)===93?(i="]",d++):(i=null,j===0&&h('"]"')),i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();k!==null?a=[a,
b,c,f,g,i,k]:(a=null,d=u)}else a=null,d=u;else a=null,d=u}else a=null,d=u;else a=null,d=u}else a=null,d=u;else a=null,d=u;a!==null&&(a=function(a,b){aa++;for(var d={token:"blank",value:"_:"+aa},e=[],q=0;q<b.pairs.length;q++){var c=b.pairs[q],h={};h.subject=d;h.predicate=c[0];c[1].length!=null&&(c[1]=c[1][0]);h.object=c[1];e.push(h)}return{token:"triplesnode",kind:"blanknodepropertylist",triplesContext:b.triplesContext.concat(e),chainSubject:d}}(o,a[3]));a===null&&(d=o);j--;j===0&&a===null&&h("[88] BlankNodePropertyList");
return a}function Db(){var a,b,c,f,g,i,k,n,o,u;j++;u=o=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(e.charCodeAt(d)===40?(b="(",d++):(b=null,j===0&&h('"("')),b!==null){c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null){g=la();if(g!==null)for(f=[];g!==null;)f.push(g),g=la();else f=null;if(f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();if(g!==null)if(e.charCodeAt(d)===41?(i=")",d++):(i=null,j===0&&h('")"')),i!==null){k=[];for(n=l();n!==null;)k.push(n),n=l();k!==null?a=[a,b,c,f,g,
i,k]:(a=null,d=u)}else a=null,d=u;else a=null,d=u}else a=null,d=u}else a=null,d=u}else a=null,d=u;else a=null,d=u;a!==null&&(a=a[3]);a===null&&(d=o);j--;j===0&&a===null&&h("[89] Collection");return a}function la(){var a,b,e,c,f,g;j++;g=f=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(b=Ia(),b!==null){e=[];for(c=l();c!==null;)e.push(c),c=l();e!==null?a=[a,b,e]:(a=null,d=g)}else a=null,d=g;else a=null,d=g;if(a===null){g=d;a=[];for(b=l();b!==null;)a.push(b),b=l();if(a!==null)if(b=Ja(),b!==
null){e=[];for(c=l();c!==null;)e.push(c),c=l();e!==null?a=[a,b,e]:(a=null,d=g)}else a=null,d=g;else a=null,d=g}a!==null&&(a=a[1]);a===null&&(d=f);j--;j===0&&a===null&&h("[90] GraphNode");return a}function Ia(){var a;j++;a=N();a===null&&(a=Fb());j--;j===0&&a===null&&h("[91] VarOrTerm");return a}function fa(){var a;j++;a=N();a===null&&(a=O());j--;j===0&&a===null&&h("[92] VarOrIRIref");return a}function N(){var a,b;j++;b=d;a=Gb();a===null&&(a=Hb());a!==null&&(a=function(a,b){var d={token:"var"};d.value=
b;return d}(b,a));a===null&&(d=b);j--;j===0&&a===null&&h("[93] Var");return a}function Fb(){var a;j++;a=O();a===null&&(a=Fa(),a===null&&(a=Ga(),a===null&&(a=Ha(),a===null&&(a=Ib(),a===null&&(a=ga())))));j--;j===0&&a===null&&h("[94] GraphTerm");return a}function J(){var a,b,c,f,g,i,k,n,o;j++;n=k=d;a=Oa();if(a!==null){b=[];o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.substr(d,2)==="||"?(f="||",d+=2):(f=null,j===0&&h('"||"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?
(i=Oa(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o;for(;c!==null;){b.push(c);o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.substr(d,2)==="||"?(f="||",d+=2):(f=null,j===0&&h('"||"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Oa(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o}b!==null?a=[a,b]:(a=null,d=n)}else a=null,d=n;a!==null&&(a=function(a,b,d){if(d.length===0)return b;for(var a={token:"expression",
expressionType:"conditionalor"},b=[b],e=0;e<d.length;e++)b.push(d[e][3]);a.operands=b;return a}(k,a[0],a[1]));a===null&&(d=k);j--;j===0&&a===null&&h("[96] ConditionalOrExpression");return a}function Oa(){var a,b,c,f,g,i,k,n,o;j++;n=k=d;a=Pa();if(a!==null){b=[];o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.substr(d,2)==="&&"?(f="&&",d+=2):(f=null,j===0&&h('"&&"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Pa(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=
null,d=o;else c=null,d=o;for(;c!==null;){b.push(c);o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.substr(d,2)==="&&"?(f="&&",d+=2):(f=null,j===0&&h('"&&"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Pa(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o}b!==null?a=[a,b]:(a=null,d=n)}else a=null,d=n;a!==null&&(a=function(a,b,d){if(d.length===0)return b;for(var a={token:"expression",expressionType:"conditionaland"},b=[b],e=0;e<d.length;e++)b.push(d[e][3]);
a.operands=b;return a}(k,a[0],a[1]));a===null&&(d=k);j--;j===0&&a===null&&h("[97] ConditionalAndExpression");return a}function Pa(){var a,b,c,f,g,i,k,n,o;j++;n=k=d;a=Q();if(a!==null){b=[];o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===61?(f="=",d++):(f=null,j===0&&h('"="')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Q(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o;if(c===null){o=d;c=[];for(f=l();f!==null;)c.push(f),
f=l();if(c!==null)if(e.substr(d,2)==="!="?(f="!=",d+=2):(f=null,j===0&&h('"!="')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Q(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o;if(c===null){o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===60?(f="<",d++):(f=null,j===0&&h('"<"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Q(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,
d=o;if(c===null){o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===62?(f=">",d++):(f=null,j===0&&h('">"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Q(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o;if(c===null){o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.substr(d,2)==="<="?(f="<=",d+=2):(f=null,j===0&&h('"<="')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Q(),i!==null?c=[c,f,g,
i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o;if(c===null){o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.substr(d,2)===">="?(f=">=",d+=2):(f=null,j===0&&h('">="')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Q(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o}}}}}for(;c!==null;){b.push(c);o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===61?(f="=",d++):(f=null,j===0&&h('"="')),f!==null){g=
[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Q(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o;if(c===null){o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.substr(d,2)==="!="?(f="!=",d+=2):(f=null,j===0&&h('"!="')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Q(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o;if(c===null){o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===
60?(f="<",d++):(f=null,j===0&&h('"<"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Q(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o;if(c===null){o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===62?(f=">",d++):(f=null,j===0&&h('">"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Q(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o;if(c===null){o=d;c=[];for(f=l();f!==
null;)c.push(f),f=l();if(c!==null)if(e.substr(d,2)==="<="?(f="<=",d+=2):(f=null,j===0&&h('"<="')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Q(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o;if(c===null){o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.substr(d,2)===">="?(f=">=",d+=2):(f=null,j===0&&h('">="')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=Q(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=
null,d=o;else c=null,d=o}}}}}}b!==null?a=[a,b]:(a=null,d=n)}else a=null,d=n;a!==null&&(a=function(a,b,d){return d.length===0?b:(a={expressionType:"relationalexpression"},a.operator=d[0][1],a.op1=b,a.op2=d[0][3],a.token="expression",a)}(k,a[0],a[1]));a===null&&(d=k);j--;j===0&&a===null&&h("[99] RelationalExpression");return a}function Q(){var a,b,c,f,g,i,k,n,o,u,m;j++;o=n=d;a=ma();if(a!==null){b=[];u=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===43?(f="+",d++):(f=null,
j===0&&h('"+"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=ma(),i!==null?c=[c,f,g,i]:(c=null,d=u)):(c=null,d=u)}else c=null,d=u;else c=null,d=u;if(c===null){u=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===45?(f="-",d++):(f=null,j===0&&h('"-"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=ma(),i!==null?c=[c,f,g,i]:(c=null,d=u)):(c=null,d=u)}else c=null,d=u;else c=null,d=u;if(c===null)if(u=d,c=na(),c===null&&(c=na()),c!==null){m=
d;f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(e.charCodeAt(d)===42?(g="*",d++):(g=null,j===0&&h('"*"')),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(k=X(),k!==null?f=[f,g,i,k]:(f=null,d=m)):(f=null,d=m)}else f=null,d=m;else f=null,d=m;if(f===null){m=d;f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(e.charCodeAt(d)===47?(g="/",d++):(g=null,j===0&&h('"/"')),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(k=X(),k!==null?f=[f,g,i,k]:(f=null,d=m)):(f=null,
d=m)}else f=null,d=m;else f=null,d=m}f=f!==null?f:"";f!==null?c=[c,f]:(c=null,d=u)}else c=null,d=u}for(;c!==null;){b.push(c);u=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===43?(f="+",d++):(f=null,j===0&&h('"+"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=ma(),i!==null?c=[c,f,g,i]:(c=null,d=u)):(c=null,d=u)}else c=null,d=u;else c=null,d=u;if(c===null){u=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===45?(f="-",d++):(f=null,
j===0&&h('"-"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=ma(),i!==null?c=[c,f,g,i]:(c=null,d=u)):(c=null,d=u)}else c=null,d=u;else c=null,d=u;if(c===null)if(u=d,c=na(),c===null&&(c=na()),c!==null){m=d;f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(e.charCodeAt(d)===42?(g="*",d++):(g=null,j===0&&h('"*"')),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(k=X(),k!==null?f=[f,g,i,k]:(f=null,d=m)):(f=null,d=m)}else f=null,d=m;else f=null,d=m;if(f===null){m=d;
f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(e.charCodeAt(d)===47?(g="/",d++):(g=null,j===0&&h('"/"')),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(k=X(),k!==null?f=[f,g,i,k]:(f=null,d=m)):(f=null,d=m)}else f=null,d=m;else f=null,d=m}f=f!==null?f:"";f!==null?c=[c,f]:(c=null,d=u)}else c=null,d=u}}b!==null?a=[a,b]:(a=null,d=o)}else a=null,d=o;a!==null&&(a=function(a,b,d){if(d.length===0)return b;a={token:"expression",expressionType:"additiveexpression"};a.summand=b;a.summands=
[];for(b=0;b<d.length;b++){var e=d[b],c={};if(e.length==4&&typeof e[1]==="string")c.operator=e[1],c.expression=e[3];else{var e={},q=c[0],h=c[1][1],f=c[1][3],h=null;q.value<0?(c.operator="-",q.value=-q.value):c.operator="+";e.token="expression";e.expressionType="multiplicativeexpression";e.operator=q;e.factors=[{operator:h,expression:f}];c.expression=e}a.summands.push(c)}return a}(n,a[0],a[1]));a===null&&(d=n);j--;j===0&&a===null&&h("[101] AdditiveExpression");return a}function ma(){var a,b,c,f,g,
i,k,n,o;j++;n=k=d;a=X();if(a!==null){b=[];o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===42?(f="*",d++):(f=null,j===0&&h('"*"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=X(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o;if(c===null){o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===47?(f="/",d++):(f=null,j===0&&h('"/"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=
X(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o}for(;c!==null;){b.push(c);o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===42?(f="*",d++):(f=null,j===0&&h('"*"')),f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=X(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o;if(c===null){o=d;c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===47?(f="/",d++):(f=null,j===0&&h('"/"')),
f!==null){g=[];for(i=l();i!==null;)g.push(i),i=l();g!==null?(i=X(),i!==null?c=[c,f,g,i]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o}}b!==null?a=[a,b]:(a=null,d=n)}else a=null,d=n;a!==null&&(a=function(a,b,d){if(d.length===0)return b;a={token:"expression",expressionType:"multiplicativeexpression"};a.factor=b;a.factors=[];for(b=0;b<d.length;b++){var e=d[b],c={};c.operator=e[1];c.expression=e[3];a.factors.push(c)}return a}(k,a[0],a[1]));a===null&&(d=k);j--;j===0&&a===null&&h("[102] MultiplicativeExpression");
return a}function X(){var a,b,c,f,g;j++;g=f=d;e.charCodeAt(d)===33?(a="!",d++):(a=null,j===0&&h('"!"'));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();b!==null?(c=xa(),c!==null?a=[a,b,c]:(a=null,d=g)):(a=null,d=g)}else a=null,d=g;a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"unaryexpression",unaryexpression:"!"};d.expression=b;return d}(f,a[2]));a===null&&(d=f);if(a===null){g=f=d;e.charCodeAt(d)===43?(a="+",d++):(a=null,j===0&&h('"+"'));if(a!==null){b=[];for(c=l();c!==
null;)b.push(c),c=l();b!==null?(c=xa(),c!==null?a=[a,b,c]:(a=null,d=g)):(a=null,d=g)}else a=null,d=g;a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"unaryexpression",unaryexpression:"+"};d.expression=b;return d}(f,a[2]));a===null&&(d=f);if(a===null){g=f=d;e.charCodeAt(d)===45?(a="-",d++):(a=null,j===0&&h('"-"'));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();b!==null?(c=xa(),c!==null?a=[a,b,c]:(a=null,d=g)):(a=null,d=g)}else a=null,d=g;a!==null&&(a=function(a,b){var d=
{token:"expression",expressionType:"unaryexpression",unaryexpression:"-"};d.expression=b;return d}(f,a[2]));a===null&&(d=f);a===null&&(a=xa())}}j--;j===0&&a===null&&h("[103] UnaryExpression");return a}function xa(){var a,b;j++;a=Ea();a===null&&(a=Da(),a===null&&(a=Jb(),a===null&&(b=d,a=Fa(),a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"atomic",primaryexpression:"rdfliteral"};d.value=b;return d}(b,a)),a===null&&(d=b),a===null&&(b=d,a=Ga(),a!==null&&(a=function(a,b){var d={token:"expression",
expressionType:"atomic",primaryexpression:"numericliteral"};d.value=b;return d}(b,a)),a===null&&(d=b),a===null&&(b=d,a=Ha(),a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"atomic",primaryexpression:"booleanliteral"};d.value=b;return d}(b,a)),a===null&&(d=b),a===null&&(a=Kb(),a===null&&(b=d,a=N(),a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"atomic",primaryexpression:"var"};d.value=b;return d}(b,a)),a===null&&(d=b))))))));j--;j===0&&a===null&&h("[104] PrimaryExpression");
return a}function Ea(){var a,b,c,f,g,i,k;j++;k=i=d;e.charCodeAt(d)===40?(a="(",d++):(a=null,j===0&&h('"("'));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(c=J(),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();f!==null?(e.charCodeAt(d)===41?(g=")",d++):(g=null,j===0&&h('")"')),g!==null?a=[a,b,c,f,g]:(a=null,d=k)):(a=null,d=k)}else a=null,d=k;else a=null,d=k}else a=null,d=k;a!==null&&(a=a[2]);a===null&&(d=i);j--;j===0&&a===null&&h("[105] BrackettedExpression");return a}function Da(){var a,
b,c,f,g,i,k,n,o,u,m,r,s,z,H,t,w;j++;w=t=d;e.substr(d,3)==="STR"?(a="STR",d+=3):(a=null,j===0&&h('"STR"'));a===null&&(e.substr(d,3)==="str"?(a="str",d+=3):(a=null,j===0&&h('"str"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(g=J(),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(e.charCodeAt(d)===41?(k=")",d++):(k=null,j===0&&h('")"')),k!==
null?a=[a,b,c,f,g,i,k]:(a=null,d=w)):(a=null,d=w)}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"str"};d.args=[b];return d}(t,a[4]));a===null&&(d=t);if(a===null){w=t=d;e.substr(d,4)==="LANG"?(a="LANG",d+=4):(a=null,j===0&&h('"LANG"'));a===null&&(e.substr(d,4)==="lang"?(a="lang",d+=4):(a=null,j===0&&h('"lang"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==
null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(g=J(),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(e.charCodeAt(d)===41?(k=")",d++):(k=null,j===0&&h('")"')),k!==null?a=[a,b,c,f,g,i,k]:(a=null,d=w)):(a=null,d=w)}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"lang"};d.args=[b];
return d}(t,a[4]));a===null&&(d=t);if(a===null){w=t=d;e.substr(d,11)==="LANGMATCHES"?(a="LANGMATCHES",d+=11):(a=null,j===0&&h('"LANGMATCHES"'));a===null&&(e.substr(d,11)==="langmatches"?(a="langmatches",d+=11):(a=null,j===0&&h('"langmatches"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(g=J(),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();if(i!==
null)if(e.charCodeAt(d)===44?(k=",",d++):(k=null,j===0&&h('","')),k!==null){n=[];for(o=l();o!==null;)n.push(o),o=l();if(n!==null)if(o=J(),o!==null){u=[];for(m=l();m!==null;)u.push(m),m=l();u!==null?(e.charCodeAt(d)===41?(m=")",d++):(m=null,j===0&&h('")"')),m!==null?a=[a,b,c,f,g,i,k,n,o,u,m]:(a=null,d=w)):(a=null,d=w)}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;a!==null&&(a=function(a,b,d){a={token:"expression",
expressionType:"builtincall",builtincall:"langmatches"};a.args=[b,d];return a}(t,a[4],a[8]));a===null&&(d=t);if(a===null){w=t=d;e.substr(d,8)==="DATATYPE"?(a="DATATYPE",d+=8):(a=null,j===0&&h('"DATATYPE"'));a===null&&(e.substr(d,8)==="datatype"?(a="datatype",d+=8):(a=null,j===0&&h('"datatype"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(g=J(),g!==
null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(e.charCodeAt(d)===41?(k=")",d++):(k=null,j===0&&h('")"')),k!==null?a=[a,b,c,f,g,i,k]:(a=null,d=w)):(a=null,d=w)}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"datatype"};d.args=[b];return d}(t,a[4]));a===null&&(d=t);if(a===null){w=t=d;e.substr(d,5)==="BOUND"?(a="BOUND",d+=5):(a=null,j===0&&h('"BOUND"'));a===null&&(e.substr(d,
5)==="bound"?(a="bound",d+=5):(a=null,j===0&&h('"bound"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(g=N(),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(e.charCodeAt(d)===41?(k=")",d++):(k=null,j===0&&h('")"')),k!==null?a=[a,b,c,f,g,i,k]:(a=null,d=w)):(a=null,d=w)}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=
null,d=w;a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"bound"};d.args=[b];return d}(t,a[4]));a===null&&(d=t);if(a===null){w=t=d;e.substr(d,3)==="IRI"?(a="IRI",d+=3):(a=null,j===0&&h('"IRI"'));a===null&&(e.substr(d,3)==="iri"?(a="iri",d+=3):(a=null,j===0&&h('"iri"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==
null)if(g=J(),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(e.charCodeAt(d)===41?(k=")",d++):(k=null,j===0&&h('")"')),k!==null?a=[a,b,c,f,g,i,k]:(a=null,d=w)):(a=null,d=w)}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"iri"};d.args=[b];return d}(t,a[4]));a===null&&(d=t);if(a===null){w=t=d;e.substr(d,3)==="URI"?(a="URI",d+=3):(a=null,j===0&&h('"URI"'));a===
null&&(e.substr(d,3)==="uri"?(a="uri",d+=3):(a=null,j===0&&h('"uri"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(g=J(),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(e.charCodeAt(d)===41?(k=")",d++):(k=null,j===0&&h('")"')),k!==null?a=[a,b,c,f,g,i,k]:(a=null,d=w)):(a=null,d=w)}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,
d=w}else a=null,d=w;a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"uri"};d.args=[b];return d}(t,a[4]));a===null&&(d=t);if(a===null){w=t=d;e.substr(d,5)==="BNODE"?(a="BNODE",d+=5):(a=null,j===0&&h('"BNODE"'));a===null&&(e.substr(d,5)==="bnode"?(a="bnode",d+=5):(a=null,j===0&&h('"bnode"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null){o=d;e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("'));if(c!==null){f=[];for(g=l();g!==null;)f.push(g),
g=l();if(f!==null)if(g=J(),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(e.charCodeAt(d)===41?(k=")",d++):(k=null,j===0&&h('")"')),k!==null?c=[c,f,g,i,k]:(c=null,d=o)):(c=null,d=o)}else c=null,d=o;else c=null,d=o}else c=null,d=o;c===null&&(c=ga());c!==null?a=[a,b,c]:(a=null,d=w)}else a=null,d=w}else a=null,d=w;a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"bnode"};d.args=b.length===5?[b[2]]:null;return d}(t,a[2]));a===null&&(d=t);if(a===
null){w=t=d;e.substr(d,8)==="COALESCE"?(a="COALESCE",d+=8):(a=null,j===0&&h('"COALESCE"'));a===null&&(e.substr(d,8)==="coalesce"?(a="coalesce",d+=8):(a=null,j===0&&h('"coalesce"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();b!==null?(c=wb(),c!==null?a=[a,b,c]:(a=null,d=w)):(a=null,d=w)}else a=null,d=w;a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"coalesce"};d.args=b;return d}(t,a[2]));a===null&&(d=t);if(a===null){w=t=d;e.substr(d,2)==="IF"?
(a="IF",d+=2):(a=null,j===0&&h('"IF"'));a===null&&(e.substr(d,2)==="if"?(a="if",d+=2):(a=null,j===0&&h('"if"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(g=J(),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();if(i!==null)if(e.charCodeAt(d)===44?(k=",",d++):(k=null,j===0&&h('","')),k!==null){n=[];for(o=l();o!==null;)n.push(o),o=l();if(n!==null)if(o=
J(),o!==null){u=[];for(m=l();m!==null;)u.push(m),m=l();if(u!==null)if(e.charCodeAt(d)===44?(m=",",d++):(m=null,j===0&&h('","')),m!==null){r=[];for(s=l();s!==null;)r.push(s),s=l();if(r!==null)if(s=J(),s!==null){z=[];for(H=l();H!==null;)z.push(H),H=l();z!==null?(e.charCodeAt(d)===41?(H=")",d++):(H=null,j===0&&h('")"')),H!==null?a=[a,b,c,f,g,i,k,n,o,u,m,r,s,z,H]:(a=null,d=w)):(a=null,d=w)}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;
else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;a!==null&&(a=function(a,b,d,e){a={token:"expression",expressionType:"builtincall",builtincall:"if"};a.args=[b,d,e];return a}(t,a[4],a[8],a[12]));a===null&&(d=t);if(a===null){w=t=d;e.substr(d,9)==="ISLITERAL"?(a="ISLITERAL",d+=9):(a=null,j===0&&h('"ISLITERAL"'));a===null&&(e.substr(d,9)==="isliteral"?(a="isliteral",d+=9):(a=null,j===0&&h('"isliteral"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=
l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(g=J(),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(e.charCodeAt(d)===41?(k=")",d++):(k=null,j===0&&h('")"')),k!==null?a=[a,b,c,f,g,i,k]:(a=null,d=w)):(a=null,d=w)}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"isliteral"};
d.args=[b];return d}(t,a[4]));a===null&&(d=t);if(a===null){w=t=d;e.substr(d,7)==="ISBLANK"?(a="ISBLANK",d+=7):(a=null,j===0&&h('"ISBLANK"'));a===null&&(e.substr(d,7)==="isblank"?(a="isblank",d+=7):(a=null,j===0&&h('"isblank"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(g=J(),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(e.charCodeAt(d)===
41?(k=")",d++):(k=null,j===0&&h('")"')),k!==null?a=[a,b,c,f,g,i,k]:(a=null,d=w)):(a=null,d=w)}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"isblank"};d.args=[b];return d}(t,a[4]));a===null&&(d=t);if(a===null){w=t=d;e.substr(d,8)==="SAMETERM"?(a="SAMETERM",d+=8):(a=null,j===0&&h('"SAMETERM"'));a===null&&(e.substr(d,8)==="sameterm"?(a="sameterm",d+=8):(a=null,j===0&&h('"sameterm"')));
if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(g=J(),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();if(i!==null)if(e.charCodeAt(d)===44?(k=",",d++):(k=null,j===0&&h('","')),k!==null){n=[];for(o=l();o!==null;)n.push(o),o=l();if(n!==null)if(o=J(),o!==null){u=[];for(m=l();m!==null;)u.push(m),m=l();u!==null?(e.charCodeAt(d)===41?(m=")",d++):(m=null,j===
0&&h('")"')),m!==null?a=[a,b,c,f,g,i,k,n,o,u,m]:(a=null,d=w)):(a=null,d=w)}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;a!==null&&(a=function(a,b,d){a={token:"expression",expressionType:"builtincall",builtincall:"sameterm"};a.args=[b,d];return a}(t,a[4],a[8]));a===null&&(d=t);if(a===null){w=t=d;e.substr(d,5)==="ISURI"?(a="ISURI",d+=5):(a=null,j===0&&h('"ISURI"'));a===null&&(e.substr(d,5)==="isuri"?(a=
"isuri",d+=5):(a=null,j===0&&h('"isuri"')),a===null&&(e.substr(d,5)==="ISIRI"?(a="ISIRI",d+=5):(a=null,j===0&&h('"ISIRI"')),a===null&&(e.substr(d,5)==="isiri"?(a="isiri",d+=5):(a=null,j===0&&h('"isiri"')))));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(g=J(),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(e.charCodeAt(d)===41?(k=")",d++):
(k=null,j===0&&h('")"')),k!==null?a=[a,b,c,f,g,i,k]:(a=null,d=w)):(a=null,d=w)}else a=null,d=w;else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w;a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"isuri"};d.args=[b];return d}(t,a[4]));a===null&&(d=t);if(a===null){w=t=d;e.substr(d,7)==="custom:"?(a="custom:",d+=7):(a=null,j===0&&h('"custom:"'));a===null&&(e.substr(d,7)==="CUSTOM:"?(a="CUSTOM:",d+=7):(a=null,j===0&&h('"CUSTOM:"')));if(a!==null){/^[a-zA-Z0-9_]/.test(e.charAt(d))?
(c=e.charAt(d),d++):(c=null,j===0&&h("[a-zA-Z0-9_]"));if(c!==null)for(b=[];c!==null;)b.push(c),/^[a-zA-Z0-9_]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[a-zA-Z0-9_]"));else b=null;if(b!==null){c=[];for(f=l();f!==null;)c.push(f),f=l();if(c!==null)if(e.charCodeAt(d)===40?(f="(",d++):(f=null,j===0&&h('"("')),f!==null){g=[];o=d;i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(k=J(),k!==null?(e.charCodeAt(d)===44?(n=",",d++):(n=null,j===0&&h('","')),n!==null?i=[i,k,n]:(i=null,d=o)):(i=
null,d=o)):(i=null,d=o);for(;i!==null;){g.push(i);o=d;i=[];for(k=l();k!==null;)i.push(k),k=l();i!==null?(k=J(),k!==null?(e.charCodeAt(d)===44?(n=",",d++):(n=null,j===0&&h('","')),n!==null?i=[i,k,n]:(i=null,d=o)):(i=null,d=o)):(i=null,d=o)}if(g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();if(i!==null)if(k=J(),k!==null){n=[];for(o=l();o!==null;)n.push(o),o=l();n!==null?(e.charCodeAt(d)===41?(o=")",d++):(o=null,j===0&&h('")"')),o!==null?a=[a,b,c,f,g,i,k,n,o]:(a=null,d=w)):(a=null,d=w)}else a=null,
d=w;else a=null,d=w}else a=null,d=w}else a=null,d=w;else a=null,d=w}else a=null,d=w}else a=null,d=w;a!==null&&(a=function(a,b,d,e){a={token:"expression",expressionType:"custom"};a.name=b.join("");for(var b=[],c=0;c<d.length;c++)b.push(d[c][1]);b.push(e);a.args=b;return a}(t,a[1],a[4],a[6]));a===null&&(d=t);a===null&&(a=Lb(),a===null&&(a=Mb(),a===null&&(a=Nb())))}}}}}}}}}}}}}}j--;j===0&&a===null&&h("[106] BuiltInCall");return a}function Lb(){var a,b,c,f,g,i,k,n,o,u,m,r,s,z,t,H;j++;t=z=d;e.substr(d,
5)==="REGEX"?(a="REGEX",d+=5):(a=null,j===0&&h('"REGEX"'));a===null&&(e.substr(d,5)==="regex"?(a="regex",d+=5):(a=null,j===0&&h('"regex"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(g=J(),g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();if(i!==null)if(e.charCodeAt(d)===44?(k=",",d++):(k=null,j===0&&h('","')),k!==null){n=[];for(o=l();o!==null;)n.push(o),
o=l();if(n!==null)if(o=J(),o!==null){u=[];for(m=l();m!==null;)u.push(m),m=l();if(u!==null){H=d;e.charCodeAt(d)===44?(m=",",d++):(m=null,j===0&&h('","'));if(m!==null){r=[];for(s=l();s!==null;)r.push(s),s=l();r!==null?(s=J(),s!==null?m=[m,r,s]:(m=null,d=H)):(m=null,d=H)}else m=null,d=H;m=m!==null?m:"";if(m!==null){r=[];for(s=l();s!==null;)r.push(s),s=l();r!==null?(e.charCodeAt(d)===41?(s=")",d++):(s=null,j===0&&h('")"')),s!==null?a=[a,b,c,f,g,i,k,n,o,u,m,r,s]:(a=null,d=t)):(a=null,d=t)}else a=null,
d=t}else a=null,d=t}else a=null,d=t;else a=null,d=t}else a=null,d=t;else a=null,d=t}else a=null,d=t;else a=null,d=t}else a=null,d=t;else a=null,d=t}else a=null,d=t;a!==null&&(a=function(a,b,d,e){a={token:"expression",expressionType:"regex"};a.text=b;a.pattern=d;a.flags=e[2];return a}(z,a[4],a[8],a[10]));a===null&&(d=z);j--;j===0&&a===null&&h("[107] RegexExpression");return a}function Mb(){var a,b,c,f,g;j++;g=f=d;e.substr(d,6)==="EXISTS"?(a="EXISTS",d+=6):(a=null,j===0&&h('"EXISTS"'));a===null&&(e.substr(d,
6)==="exists"?(a="exists",d+=6):(a=null,j===0&&h('"exists"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();b!==null?(c=S(),c!==null?a=[a,b,c]:(a=null,d=g)):(a=null,d=g)}else a=null,d=g;a!==null&&(a=function(a,b){var d={token:"expression",expressionType:"builtincall",builtincall:"exists"};d.args=[b];return d}(f,a[2]));a===null&&(d=f);j--;j===0&&a===null&&h("[108] ExistsFunc");return a}function Nb(){var a,b,c,f,g,i,k;j++;k=i=d;e.substr(d,3)==="NOT"?(a="NOT",d+=3):(a=null,j===0&&h('"NOT"'));
a===null&&(e.substr(d,3)==="not"?(a="not",d+=3):(a=null,j===0&&h('"not"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.substr(d,6)==="EXISTS"?(c="EXISTS",d+=6):(c=null,j===0&&h('"EXISTS"')),c===null&&(e.substr(d,6)==="exists"?(c="exists",d+=6):(c=null,j===0&&h('"exists"'))),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();f!==null?(g=S(),g!==null?a=[a,b,c,f,g]:(a=null,d=k)):(a=null,d=k)}else a=null,d=k;else a=null,d=k}else a=null,d=k;a!==null&&(a=function(a,b){var d=
{token:"expression",expressionType:"builtincall",builtincall:"notexists"};d.args=[b];return d}(i,a[4]));a===null&&(d=i);j--;j===0&&a===null&&h("[109] NotExistsFunc");return a}function Kb(){var a,b,c,f,g,i,k,n,o,u,m,r,s;j++;s=r=d;e.substr(d,5)==="COUNT"?(a="COUNT",d+=5):(a=null,j===0&&h('"COUNT"'));a===null&&(e.substr(d,5)==="count"?(a="count",d+=5):(a=null,j===0&&h('"count"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),
c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(e.substr(d,8)==="DISTINCT"?(g="DISTINCT",d+=8):(g=null,j===0&&h('"DISTINCT"')),g===null&&(e.substr(d,8)==="distinct"?(g="distinct",d+=8):(g=null,j===0&&h('"distinct"'))),g=g!==null?g:"",g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();if(i!==null)if(e.charCodeAt(d)===42?(k="*",d++):(k=null,j===0&&h('"*"')),k===null&&(k=J()),k!==null){n=[];for(o=l();o!==null;)n.push(o),o=l();if(n!==null)if(e.charCodeAt(d)===41?(o=")",d++):(o=null,
j===0&&h('")"')),o!==null){u=[];for(m=l();m!==null;)u.push(m),m=l();u!==null?a=[a,b,c,f,g,i,k,n,o,u]:(a=null,d=s)}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=null,d=s;a!==null&&(a=function(a,b,d){a={token:"expression",expressionType:"aggregate",aggregateType:"count"};a.distinct=b!=""?"DISTINCT":b;a.expression=d;return a}(r,a[4],a[6]));a===null&&(d=r);if(a===null){s=r=d;e.substr(d,3)==="SUM"?(a="SUM",d+=3):(a=
null,j===0&&h('"SUM"'));a===null&&(e.substr(d,3)==="sum"?(a="sum",d+=3):(a=null,j===0&&h('"sum"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(e.substr(d,8)==="DISTINCT"?(g="DISTINCT",d+=8):(g=null,j===0&&h('"DISTINCT"')),g===null&&(e.substr(d,8)==="distinct"?(g="distinct",d+=8):(g=null,j===0&&h('"distinct"'))),g=g!==null?g:"",g!==null){i=[];for(k=l();k!==
null;)i.push(k),k=l();if(i!==null)if(k=J(),k!==null){n=[];for(o=l();o!==null;)n.push(o),o=l();if(n!==null)if(e.charCodeAt(d)===41?(o=")",d++):(o=null,j===0&&h('")"')),o!==null){u=[];for(m=l();m!==null;)u.push(m),m=l();u!==null?a=[a,b,c,f,g,i,k,n,o,u]:(a=null,d=s)}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=null,d=s;a!==null&&(a=function(a,b,d){a={token:"expression",expressionType:"aggregate",aggregateType:"sum"};
a.distinct=b!=""?"DISTINCT":b;a.expression=d;return a}(r,a[4],a[6]));a===null&&(d=r);if(a===null){s=r=d;e.substr(d,3)==="MIN"?(a="MIN",d+=3):(a=null,j===0&&h('"MIN"'));a===null&&(e.substr(d,3)==="min"?(a="min",d+=3):(a=null,j===0&&h('"min"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(e.substr(d,8)==="DISTINCT"?(g="DISTINCT",d+=8):(g=null,j===0&&h('"DISTINCT"')),
g===null&&(e.substr(d,8)==="distinct"?(g="distinct",d+=8):(g=null,j===0&&h('"distinct"'))),g=g!==null?g:"",g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();if(i!==null)if(k=J(),k!==null){n=[];for(o=l();o!==null;)n.push(o),o=l();if(n!==null)if(e.charCodeAt(d)===41?(o=")",d++):(o=null,j===0&&h('")"')),o!==null){u=[];for(m=l();m!==null;)u.push(m),m=l();u!==null?a=[a,b,c,f,g,i,k,n,o,u]:(a=null,d=s)}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=
null,d=s;else a=null,d=s}else a=null,d=s;a!==null&&(a=function(a,b,d){a={token:"expression",expressionType:"aggregate",aggregateType:"min"};a.distinct=b!=""?"DISTINCT":b;a.expression=d;return a}(r,a[4],a[6]));a===null&&(d=r);if(a===null){s=r=d;e.substr(d,3)==="MAX"?(a="MAX",d+=3):(a=null,j===0&&h('"MAX"'));a===null&&(e.substr(d,3)==="max"?(a="max",d+=3):(a=null,j===0&&h('"max"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&
h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(e.substr(d,8)==="DISTINCT"?(g="DISTINCT",d+=8):(g=null,j===0&&h('"DISTINCT"')),g===null&&(e.substr(d,8)==="distinct"?(g="distinct",d+=8):(g=null,j===0&&h('"distinct"'))),g=g!==null?g:"",g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();if(i!==null)if(k=J(),k!==null){n=[];for(o=l();o!==null;)n.push(o),o=l();if(n!==null)if(e.charCodeAt(d)===41?(o=")",d++):(o=null,j===0&&h('")"')),o!==null){u=[];for(m=l();m!==null;)u.push(m),
m=l();u!==null?a=[a,b,c,f,g,i,k,n,o,u]:(a=null,d=s)}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=null,d=s;a!==null&&(a=function(a,b,d){a={token:"expression",expressionType:"aggregate",aggregateType:"max"};a.distinct=b!=""?"DISTINCT":b;a.expression=d;return a}(r,a[4],a[6]));a===null&&(d=r);if(a===null){s=r=d;e.substr(d,3)==="AVG"?(a="AVG",d+=3):(a=null,j===0&&h('"AVG"'));a===null&&(e.substr(d,3)==="avg"?(a="avg",
d+=3):(a=null,j===0&&h('"avg"')));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();if(b!==null)if(e.charCodeAt(d)===40?(c="(",d++):(c=null,j===0&&h('"("')),c!==null){f=[];for(g=l();g!==null;)f.push(g),g=l();if(f!==null)if(e.substr(d,8)==="DISTINCT"?(g="DISTINCT",d+=8):(g=null,j===0&&h('"DISTINCT"')),g===null&&(e.substr(d,8)==="distinct"?(g="distinct",d+=8):(g=null,j===0&&h('"distinct"'))),g=g!==null?g:"",g!==null){i=[];for(k=l();k!==null;)i.push(k),k=l();if(i!==null)if(k=J(),k!==null){n=[];for(o=
l();o!==null;)n.push(o),o=l();if(n!==null)if(e.charCodeAt(d)===41?(o=")",d++):(o=null,j===0&&h('")"')),o!==null){u=[];for(m=l();m!==null;)u.push(m),m=l();u!==null?a=[a,b,c,f,g,i,k,n,o,u]:(a=null,d=s)}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=null,d=s;else a=null,d=s}else a=null,d=s;a!==null&&(a=function(a,b,d){a={token:"expression",expressionType:"aggregate",aggregateType:"avg"};a.distinct=b!=""?"DISTINCT":b;a.expression=d;return a}(r,a[4],
a[6]));a===null&&(d=r)}}}}j--;j===0&&a===null&&h("[110] Aggregate");return a}function Jb(){var a,b,e,c;j++;c=e=d;a=O();a!==null?(b=eb(),b=b!==null?b:"",b!==null?a=[a,b]:(a=null,d=c)):(a=null,d=c);a!==null&&(a=function(a,b,d){a={token:"expression",expressionType:"irireforfunction"};a.iriref=b;a.args=d.value;return a}(e,a[0],a[1]));a===null&&(d=e);j--;j===0&&a===null&&h("[117] IRIrefOrFunction");return a}function Fa(){var a,b,c,f,g,i;j++;g=f=d;a=Ob();a!==null?(b=Pb(),b===null&&(i=d,e.substr(d,2)===
"^^"?(b="^^",d+=2):(b=null,j===0&&h('"^^"')),b!==null?(c=O(),c!==null?b=[b,c]:(b=null,d=i)):(b=null,d=i)),b=b!==null?b:"",b!==null?a=[a,b]:(a=null,d=g)):(a=null,d=g);a!==null&&(a=function(a,b,d){return typeof d==="string"&&d.length>0?{token:"literal",value:b.value,lang:d.slice(1),type:null}:typeof d==="object"?(d.shift(),{token:"literal",value:b.value,lang:null,type:d[0]}):{token:"literal",value:b.value,lang:null,type:null}}(f,a[0],a[1]));a===null&&(d=f);j--;j===0&&a===null&&h("[112] RDFLiteral");
return a}function Ga(){var a;j++;a=Qb();a===null&&(a=Rb(),a===null&&(a=na()));j--;j===0&&a===null&&h("[113] NumericLiteral");return a}function Qb(){var a;j++;a=Qa();a===null&&(a=Ra(),a===null&&(a=$()));j--;j===0&&a===null&&h("[114] NumericLiteralUnsigned");return a}function Rb(){var a;j++;a=Sb();a===null&&(a=Tb(),a===null&&(a=Ub()));j--;j===0&&a===null&&h("[115] NumericLiteralPositive");return a}function na(){var a;j++;a=Vb();a===null&&(a=Wb(),a===null&&(a=Xb()));j--;j===0&&a===null&&h("[116] NumericLiteralNegative");
return a}function Ha(){var a,b;j++;b=d;e.substr(d,4)==="TRUE"?(a="TRUE",d+=4):(a=null,j===0&&h('"TRUE"'));a===null&&(e.substr(d,4)==="true"?(a="true",d+=4):(a=null,j===0&&h('"true"')));a!==null&&(a={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#boolean",value:!0});a===null&&(d=b);a===null&&(b=d,e.substr(d,5)==="FALSE"?(a="FALSE",d+=5):(a=null,j===0&&h('"FALSE"')),a===null&&(e.substr(d,5)==="false"?(a="false",d+=5):(a=null,j===0&&h('"false"'))),a!==null&&(a={token:"literal",lang:null,
type:"http://www.w3.org/2001/XMLSchema#boolean",value:!1}),a===null&&(d=b));j--;j===0&&a===null&&h("[117] BooleanLiteral");return a}function Ob(){var a,b;j++;b=d;a=Yb();a!==null&&(a={token:"string",value:a});a===null&&(d=b);a===null&&(b=d,a=Zb(),a!==null&&(a={token:"string",value:a}),a===null&&(d=b),a===null&&(b=d,a=$b(),a!==null&&(a={token:"string",value:a}),a===null&&(d=b),a===null&&(b=d,a=ac(),a!==null&&(a={token:"string",value:a}),a===null&&(d=b))));j--;j===0&&a===null&&h("[118] String");return a}
function O(){var a,b;j++;b=d;a=Ba();a!==null&&(a={token:"uri",prefix:null,suffix:null,value:a});a===null&&(d=b);a===null&&(b=d,a=bc(),a===null&&(d=b));j--;j===0&&a===null&&h("[119] IRIref");return a}function bc(){var a,b;j++;b=d;a=cc();a!==null&&(a={token:"uri",prefix:a[0],suffix:a[1],value:null});a===null&&(d=b);a===null&&(b=d,a=Ca(),a!==null&&(a={token:"uri",prefix:a,suffix:"",value:null}),a===null&&(d=b));j--;j===0&&a===null&&h("[120] PrefixedName");return a}function Ib(){var a,b;j++;b=d;a=dc();
a!==null&&(a={token:"blank",value:a});a===null&&(d=b);a===null&&(b=d,a=ec(),a!==null&&(aa++,a={token:"blank",value:"_:"+aa}),a===null&&(d=b));j--;j===0&&a===null&&h("[121] BlankNode");return a}function Ba(){var a,b,c,f,g;j++;g=f=d;e.charCodeAt(d)===60?(a="<",d++):(a=null,j===0&&h('"<"'));if(a!==null){b=[];/^[^<>"{}|^`\\]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h('[^<>"{}|^`\\\\]'));for(;c!==null;)b.push(c),/^[^<>"{}|^`\\]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h('[^<>"{}|^`\\\\]'));
b!==null?(e.charCodeAt(d)===62?(c=">",d++):(c=null,j===0&&h('">"')),c!==null?a=[a,b,c]:(a=null,d=g)):(a=null,d=g)}else a=null,d=g;a!==null&&(a=a[1].join(""));a===null&&(d=f);j--;j===0&&a===null&&h("[122] IRI_REF");return a}function Ca(){var a,b,c,f;j++;f=c=d;a=fc();a=a!==null?a:"";a!==null?(e.charCodeAt(d)===58?(b=":",d++):(b=null,j===0&&h('":"')),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f);a!==null&&(a=a[0]);a===null&&(d=c);j--;j===0&&a===null&&h("[123] PNAME_NS");return a}function cc(){var a,b,
c,e;j++;e=c=d;a=Ca();a!==null?(b=ib(),b!==null?a=[a,b]:(a=null,d=e)):(a=null,d=e);a!==null&&(a=[a[0],a[1]]);a===null&&(d=c);j--;j===0&&a===null&&h("[124] PNAME_LN");return a}function dc(){var a,b,c,f;j++;f=c=d;e.substr(d,2)==="_:"?(a="_:",d+=2):(a=null,j===0&&h('"_:"'));a!==null?(b=ib(),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f);a!==null&&(a=a[1]);a===null&&(d=c);j--;j===0&&a===null&&h("[125] BLANK_NODE_LABEL");return a}function Gb(){var a,b,c,f;j++;f=c=d;e.charCodeAt(d)===63?(a="?",d++):(a=null,
j===0&&h('"?"'));a!==null?(b=jb(),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f);a!==null&&(a=a[1]);a===null&&(d=c);j--;j===0&&a===null&&h("[126] VAR1");return a}function Hb(){var a,b,c,f;j++;f=c=d;e.charCodeAt(d)===36?(a="$",d++):(a=null,j===0&&h('"$"'));a!==null?(b=jb(),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f);a!==null&&(a=a[1]);a===null&&(d=c);j--;j===0&&a===null&&h("[127] VAR2");return a}function Pb(){var a,b,c,f,g,i,k,n,o;j++;n=k=d;e.charCodeAt(d)===64?(a="@",d++):(a=null,j===0&&h('"@"'));if(a!==
null){/^[a-zA-Z]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[a-zA-Z]"));if(c!==null)for(b=[];c!==null;)b.push(c),/^[a-zA-Z]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[a-zA-Z]"));else b=null;if(b!==null){c=[];o=d;e.charCodeAt(d)===45?(f="-",d++):(f=null,j===0&&h('"-"'));if(f!==null){/^[a-zA-Z0-9]/.test(e.charAt(d))?(i=e.charAt(d),d++):(i=null,j===0&&h("[a-zA-Z0-9]"));if(i!==null)for(g=[];i!==null;)g.push(i),/^[a-zA-Z0-9]/.test(e.charAt(d))?(i=e.charAt(d),d++):(i=null,j===
0&&h("[a-zA-Z0-9]"));else g=null;g!==null?f=[f,g]:(f=null,d=o)}else f=null,d=o;for(;f!==null;)if(c.push(f),o=d,e.charCodeAt(d)===45?(f="-",d++):(f=null,j===0&&h('"-"')),f!==null){/^[a-zA-Z0-9]/.test(e.charAt(d))?(i=e.charAt(d),d++):(i=null,j===0&&h("[a-zA-Z0-9]"));if(i!==null)for(g=[];i!==null;)g.push(i),/^[a-zA-Z0-9]/.test(e.charAt(d))?(i=e.charAt(d),d++):(i=null,j===0&&h("[a-zA-Z0-9]"));else g=null;g!==null?f=[f,g]:(f=null,d=o)}else f=null,d=o;c!==null?a=[a,b,c]:(a=null,d=n)}else a=null,d=n}else a=
null,d=n;a!==null&&(a=a[2].length===0?("@"+a[1].join("")).toLowerCase():("@"+a[1].join("")+"-"+a[2][0][1].join("")).toLowerCase());a===null&&(d=k);j--;j===0&&a===null&&h("[128] LANGTAG");return a}function $(){var a,b,c;j++;c=d;/^[0-9]/.test(e.charAt(d))?(b=e.charAt(d),d++):(b=null,j===0&&h("[0-9]"));if(b!==null)for(a=[];b!==null;)a.push(b),/^[0-9]/.test(e.charAt(d))?(b=e.charAt(d),d++):(b=null,j===0&&h("[0-9]"));else a=null;a!==null&&(a=function(a,b){var d={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#integer"};
d.value=U(b);return d}(c,a));a===null&&(d=c);j--;j===0&&a===null&&h("[129] INTEGER");return a}function Ra(){var a,b,c,f,g,i;j++;i=g=d;/^[0-9]/.test(e.charAt(d))?(b=e.charAt(d),d++):(b=null,j===0&&h("[0-9]"));if(b!==null)for(a=[];b!==null;)a.push(b),/^[0-9]/.test(e.charAt(d))?(b=e.charAt(d),d++):(b=null,j===0&&h("[0-9]"));else a=null;if(a!==null)if(e.charCodeAt(d)===46?(b=".",d++):(b=null,j===0&&h('"."')),b!==null){c=[];/^[0-9]/.test(e.charAt(d))?(f=e.charAt(d),d++):(f=null,j===0&&h("[0-9]"));for(;f!==
null;)c.push(f),/^[0-9]/.test(e.charAt(d))?(f=e.charAt(d),d++):(f=null,j===0&&h("[0-9]"));c!==null?a=[a,b,c]:(a=null,d=i)}else a=null,d=i;else a=null,d=i;a!==null&&(a=function(a,b,d,c){a={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#decimal"};a.value=U([b,d,c]);return a}(g,a[0],a[1],a[2]));a===null&&(d=g);if(a===null){i=g=d;e.charCodeAt(d)===46?(a=".",d++):(a=null,j===0&&h('"."'));if(a!==null){/^[0-9]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[0-9]"));if(c!==null)for(b=
[];c!==null;)b.push(c),/^[0-9]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[0-9]"));else b=null;b!==null?a=[a,b]:(a=null,d=i)}else a=null,d=i;a!==null&&(a=function(a,b,d){a={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#decimal"};a.value=U([b,d]);return a}(g,a[0],a[1]));a===null&&(d=g)}j--;j===0&&a===null&&h("[130] DECIMAL");return a}function Qa(){var a,b,c,f,g,i;j++;i=g=d;/^[0-9]/.test(e.charAt(d))?(b=e.charAt(d),d++):(b=null,j===0&&h("[0-9]"));if(b!==null)for(a=[];b!==
null;)a.push(b),/^[0-9]/.test(e.charAt(d))?(b=e.charAt(d),d++):(b=null,j===0&&h("[0-9]"));else a=null;if(a!==null)if(e.charCodeAt(d)===46?(b=".",d++):(b=null,j===0&&h('"."')),b!==null){c=[];/^[0-9]/.test(e.charAt(d))?(f=e.charAt(d),d++):(f=null,j===0&&h("[0-9]"));for(;f!==null;)c.push(f),/^[0-9]/.test(e.charAt(d))?(f=e.charAt(d),d++):(f=null,j===0&&h("[0-9]"));c!==null?(f=Sa(),f!==null?a=[a,b,c,f]:(a=null,d=i)):(a=null,d=i)}else a=null,d=i;else a=null,d=i;a!==null&&(a=function(a,b,d,c,e){a={token:"literal",
lang:null,type:"http://www.w3.org/2001/XMLSchema#double"};a.value=U([b,d,c,e]);return a}(g,a[0],a[1],a[2],a[3]));a===null&&(d=g);if(a===null){i=g=d;e.charCodeAt(d)===46?(a=".",d++):(a=null,j===0&&h('"."'));if(a!==null){/^[0-9]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[0-9]"));if(c!==null)for(b=[];c!==null;)b.push(c),/^[0-9]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[0-9]"));else b=null;b!==null?(c=Sa(),c!==null?a=[a,b,c]:(a=null,d=i)):(a=null,d=i)}else a=null,d=i;a!==
null&&(a=function(a,b,d,c){a={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#double"};a.value=U([b,d,c]);return a}(g,a[0],a[1],a[2]));a===null&&(d=g);if(a===null){i=g=d;/^[0-9]/.test(e.charAt(d))?(b=e.charAt(d),d++):(b=null,j===0&&h("[0-9]"));if(b!==null)for(a=[];b!==null;)a.push(b),/^[0-9]/.test(e.charAt(d))?(b=e.charAt(d),d++):(b=null,j===0&&h("[0-9]"));else a=null;a!==null?(b=Sa(),b!==null?a=[a,b]:(a=null,d=i)):(a=null,d=i);a!==null&&(a=function(a,b,d){a={token:"literal",lang:null,
type:"http://www.w3.org/2001/XMLSchema#double"};a.value=U([b,d]);return a}(g,a[0],a[1]));a===null&&(d=g)}}j--;j===0&&a===null&&h("[131] DOUBLE");return a}function Ub(){var a,b,c,f;j++;f=c=d;e.charCodeAt(d)===43?(a="+",d++):(a=null,j===0&&h('"+"'));a!==null?(b=$(),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f);a!==null&&(a=function(a,b){b.value="+"+b.value;return b}(c,a[1]));a===null&&(d=c);j--;j===0&&a===null&&h("[132] INTEGER_POSITIVE");return a}function Tb(){var a,b,c,f;j++;f=c=d;e.charCodeAt(d)===
43?(a="+",d++):(a=null,j===0&&h('"+"'));a!==null?(b=Ra(),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f);a!==null&&(a=function(a,b){b.value="+"+b.value;return b}(c,a[1]));a===null&&(d=c);j--;j===0&&a===null&&h("[133] DECIMAL_POSITIVE");return a}function Sb(){var a,b,c,f;j++;f=c=d;e.charCodeAt(d)===43?(a="+",d++):(a=null,j===0&&h('"+"'));a!==null?(b=Qa(),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f);a!==null&&(a=function(a,b){b.value="+"+b.value;return b}(c,a[1]));a===null&&(d=c);j--;j===0&&a===null&&h("[134] DOUBLE_POSITIVE");
return a}function Xb(){var a,b,c,f;j++;f=c=d;e.charCodeAt(d)===45?(a="-",d++):(a=null,j===0&&h('"-"'));a!==null?(b=$(),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f);a!==null&&(a=function(a,b){b.value="-"+b.value;return b}(c,a[1]));a===null&&(d=c);j--;j===0&&a===null&&h("[135] INTEGER_NEGATIVE");return a}function Wb(){var a,b,c,f;j++;f=c=d;e.charCodeAt(d)===45?(a="-",d++):(a=null,j===0&&h('"-"'));a!==null?(b=Ra(),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f);a!==null&&(a=function(a,b){b.value="-"+b.value;
return b}(c,a[1]));a===null&&(d=c);j--;j===0&&a===null&&h("[136] DECIMAL_NEGATIVE");return a}function Vb(){var a,b,c,f;j++;f=c=d;e.charCodeAt(d)===45?(a="-",d++):(a=null,j===0&&h('"-"'));a!==null?(b=Qa(),b!==null?a=[a,b]:(a=null,d=f)):(a=null,d=f);a!==null&&(a=function(a,b){b.value="-"+b.value;return b}(c,a[1]));a===null&&(d=c);j--;j===0&&a===null&&h("[137] DOUBLE_NEGATIVE");return a}function Sa(){var a,b,c,f,g,i;j++;i=g=d;/^[eE]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[eE]"));if(a!==
null)if(/^[+\-]/.test(e.charAt(d))?(b=e.charAt(d),d++):(b=null,j===0&&h("[+\\-]")),b=b!==null?b:"",b!==null){/^[0-9]/.test(e.charAt(d))?(f=e.charAt(d),d++):(f=null,j===0&&h("[0-9]"));if(f!==null)for(c=[];f!==null;)c.push(f),/^[0-9]/.test(e.charAt(d))?(f=e.charAt(d),d++):(f=null,j===0&&h("[0-9]"));else c=null;c!==null?a=[a,b,c]:(a=null,d=i)}else a=null,d=i;else a=null,d=i;a!==null&&(a=U([a[0],a[1],a[2]]));a===null&&(d=g);j--;j===0&&a===null&&h("[138] EXPONENT");return a}function $b(){var a,b,c,f,g;
j++;g=f=d;e.charCodeAt(d)===39?(a="'",d++):(a=null,j===0&&h('"\'"'));if(a!==null){b=[];/^[^'\\\n\r]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[^'\\\\\\n\\r]"));for(c===null&&(c=ba());c!==null;)b.push(c),/^[^'\\\n\r]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[^'\\\\\\n\\r]")),c===null&&(c=ba());b!==null?(e.charCodeAt(d)===39?(c="'",d++):(c=null,j===0&&h('"\'"')),c!==null?a=[a,b,c]:(a=null,d=g)):(a=null,d=g)}else a=null,d=g;a!==null&&(a=U(a[1]));a===null&&(d=f);j--;j===
0&&a===null&&h("[139] STRING_LITERAL1");return a}function ac(){var a,b,c,f,g;j++;g=f=d;e.charCodeAt(d)===34?(a='"',d++):(a=null,j===0&&h('"\\""'));if(a!==null){b=[];/^[^"\\\n\r]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h('[^"\\\\\\n\\r]'));for(c===null&&(c=ba());c!==null;)b.push(c),/^[^"\\\n\r]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h('[^"\\\\\\n\\r]')),c===null&&(c=ba());b!==null?(e.charCodeAt(d)===34?(c='"',d++):(c=null,j===0&&h('"\\""')),c!==null?a=[a,b,c]:(a=null,d=
g)):(a=null,d=g)}else a=null,d=g;a!==null&&(a=U(a[1]));a===null&&(d=f);j--;j===0&&a===null&&h("[140] STRING_LITERAL2");return a}function Yb(){var a,b,c,f,g;j++;g=f=d;e.substr(d,3)==="'''"?(a="'''",d+=3):(a=null,j===0&&h("\"'''\""));if(a!==null){b=[];/^[^'\\]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[^'\\\\]"));for(c===null&&(c=ba());c!==null;)b.push(c),/^[^'\\]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[^'\\\\]")),c===null&&(c=ba());b!==null?(e.substr(d,3)==="'''"?(c=
"'''",d+=3):(c=null,j===0&&h("\"'''\"")),c!==null?a=[a,b,c]:(a=null,d=g)):(a=null,d=g)}else a=null,d=g;a!==null&&(a=U(a[1]));a===null&&(d=f);j--;j===0&&a===null&&h("[141] STRING_LITERAL_LONG1");return a}function Zb(){var a,b,c,f,g;j++;g=f=d;e.substr(d,3)==='"""'?(a='"""',d+=3):(a=null,j===0&&h('"\\"\\"\\""'));if(a!==null){b=[];/^[^"\\]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h('[^"\\\\]'));for(c===null&&(c=ba());c!==null;)b.push(c),/^[^"\\]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=
null,j===0&&h('[^"\\\\]')),c===null&&(c=ba());b!==null?(e.substr(d,3)==='"""'?(c='"""',d+=3):(c=null,j===0&&h('"\\"\\"\\""')),c!==null?a=[a,b,c]:(a=null,d=g)):(a=null,d=g)}else a=null,d=g;a!==null&&(a=U(a[1]));a===null&&(d=f);j--;j===0&&a===null&&h("[142] STRING_LITERAL_LONG2");return a}function ba(){var a,b,c;j++;c=d;e.charCodeAt(d)===92?(a="\\",d++):(a=null,j===0&&h('"\\\\"'));a!==null?(/^[tbnrf"']/.test(e.charAt(d))?(b=e.charAt(d),d++):(b=null,j===0&&h("[tbnrf\"']")),b!==null?a=[a,b]:(a=null,d=
c)):(a=null,d=c);j--;j===0&&a===null&&h("[143] ECHAR");return a}function ga(){var a,b,c,f,g;j++;g=f=d;e.charCodeAt(d)===40?(a="(",d++):(a=null,j===0&&h('"("'));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();b!==null?(e.charCodeAt(d)===41?(c=")",d++):(c=null,j===0&&h('")"')),c!==null?a=[a,b,c]:(a=null,d=g)):(a=null,d=g)}else a=null,d=g;a!==null&&(a={token:"triplesnodecollection",triplesContext:[],chainSubject:[{token:"uri",value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"}]});a===null&&
(d=f);j--;j===0&&a===null&&h("[144] NIL");return a}function l(){var a;j++;/^[ ]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[ ]"));a===null&&(/^[\t]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\t]")),a===null&&(/^[\r]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\r]")),a===null&&(/^[\n]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\n]")),a===null&&(a=gc()))));j--;j===0&&a===null&&h("[145] WS");return a}function gc(){var a,b,c,f;j++;f=d;e.charCodeAt(d)===
35?(a="#",d++):(a=null,j===0&&h('"#"'));if(a!==null){b=[];/^[^\n\r]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[^\\n\\r]"));for(;c!==null;)b.push(c),/^[^\n\r]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[^\\n\\r]"));b!==null?a=[a,b]:(a=null,d=f)}else a=null,d=f;j--;j===0&&a===null&&h(" COMMENT");return a}function ec(){var a,b,c,f;j++;f=d;e.charCodeAt(d)===91?(a="[",d++):(a=null,j===0&&h('"["'));if(a!==null){b=[];for(c=l();c!==null;)b.push(c),c=l();b!==null?(e.charCodeAt(d)===
93?(c="]",d++):(c=null,j===0&&h('"]"')),c!==null?a=[a,b,c]:(a=null,d=f)):(a=null,d=f)}else a=null,d=f;j--;j===0&&a===null&&h("[146] ANON");return a}function kb(){var a;j++;/^[A-Z]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[A-Z]"));a===null&&(/^[a-z]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[a-z]")),a===null&&(/^[\xC0-\xD6]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\xC0-\\xD6]")),a===null&&(/^[\xD8-\xF6]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,
j===0&&h("[\\xD8-\\xF6]")),a===null&&(/^[\xF8-\u02FF]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\xF8-\\u02FF]")),a===null&&(/^[\u0370-\u037D]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\u0370-\\u037D]")),a===null&&(/^[\u037F-\u1FFF]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\u037F-\\u1FFF]")),a===null&&(/^[\u200C-\u200D]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\u200C-\\u200D]")),a===null&&(/^[\u2070-\u218F]/.test(e.charAt(d))?(a=
e.charAt(d),d++):(a=null,j===0&&h("[\\u2070-\\u218F]")),a===null&&(/^[\u2C00-\u2FEF]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\u2C00-\\u2FEF]")),a===null&&(/^[\u3001-\uD7FF]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\u3001-\\uD7FF]")),a===null&&(/^[\uF900-\uFDCF]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\uF900-\\uFDCF]")),a===null&&(/^[\uFDF0-\uFFFD]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\uFDF0-\\uFFFD]")),a===null&&(/^[\u1000-\uEFFF]/.test(e.charAt(d))?
(a=e.charAt(d),d++):(a=null,j===0&&h("[\\u1000-\\uEFFF]")))))))))))))));j--;j===0&&a===null&&h("[147] PN_CHARS_BASE");return a}function oa(){var a;j++;a=kb();a===null&&(e.charCodeAt(d)===95?(a="_",d++):(a=null,j===0&&h('"_"')));j--;j===0&&a===null&&h("[148] PN_CHARS_U");return a}function jb(){var a,b,c,f,g;j++;g=f=d;a=oa();a===null&&(/^[0-9]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[0-9]")));if(a!==null){b=[];c=oa();c===null&&(/^[0-9]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,
j===0&&h("[0-9]")),c===null&&(/^[\xB7]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[\\xB7]")),c===null&&(/^[\u0300-\u036F]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[\\u0300-\\u036F]")),c===null&&(/^[\u203F-\u2040]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[\\u203F-\\u2040]"))))));for(;c!==null;)b.push(c),c=oa(),c===null&&(/^[0-9]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[0-9]")),c===null&&(/^[\xB7]/.test(e.charAt(d))?(c=e.charAt(d),d++):
(c=null,j===0&&h("[\\xB7]")),c===null&&(/^[\u0300-\u036F]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[\\u0300-\\u036F]")),c===null&&(/^[\u203F-\u2040]/.test(e.charAt(d))?(c=e.charAt(d),d++):(c=null,j===0&&h("[\\u203F-\\u2040]"))))));b!==null?a=[a,b]:(a=null,d=g)}else a=null,d=g;a!==null&&(a=a[0]+a[1].join(""));a===null&&(d=f);j--;j===0&&a===null&&h("[149] VARNAME");return a}function ya(){var a;j++;a=oa();a===null&&(e.charCodeAt(d)===45?(a="-",d++):(a=null,j===0&&h('"-"')),a===null&&
(/^[0-9]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[0-9]")),a===null&&(/^[\xB7]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\xB7]")),a===null&&(/^[\u0300-\u036F]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\u0300-\\u036F]")),a===null&&(/^[\u203F-\u2040]/.test(e.charAt(d))?(a=e.charAt(d),d++):(a=null,j===0&&h("[\\u203F-\\u2040]")))))));j--;j===0&&a===null&&h("[150] PN_CHARS");return a}function fc(){var a,b,c,f,g;j++;g=f=d;a=kb();if(a!==null){b=[];c=ya();
c===null&&(e.charCodeAt(d)===46?(c=".",d++):(c=null,j===0&&h('"."')));for(;c!==null;)b.push(c),c=ya(),c===null&&(e.charCodeAt(d)===46?(c=".",d++):(c=null,j===0&&h('"."')));b!==null?a=[a,b]:(a=null,d=g)}else a=null,d=g;a!==null&&(a=function(a,b,d){if(d[d.length-1]==".")throw Error("Wrong PN_PREFIX, cannot finish with '.'");else return b+d.join("")}(f,a[0],a[1]));a===null&&(d=f);j--;j===0&&a===null&&h("[151] PN_PREFIX");return a}function ib(){var a,b,c,f,g;j++;g=f=d;a=oa();a===null&&(/^[0-9]/.test(e.charAt(d))?
(a=e.charAt(d),d++):(a=null,j===0&&h("[0-9]")));if(a!==null){b=[];for(c=ya();c!==null;)b.push(c),c=ya();b!==null?a=[a,b]:(a=null,d=g)}else a=null,d=g;a!==null&&(a=a[0]+a[1].join(""));a===null&&(d=f);j--;j===0&&a===null&&h("[152] PN_LOCAL");return a}function lb(a){a.sort();for(var b=null,d=[],c=0;c<a.length;c++)a[c]!==b&&(d.push(a[c]),b=a[c]);return d}function ic(){for(var a=1,b=1,c=!1,f=0;f<Math.max(d,sa);f++){var g=e.charAt(f);g==="\n"?(c||a++,b=1,c=!1):g==="\r"||g==="\u2028"||g==="\u2029"?(a++,
b=1,c=!0):(b++,c=!1)}return{line:a,column:b}}var ca={SPARQL:function(){var a;a=f();a===null&&(a=R());return a},Query:f,Prologue:g,BaseDecl:i,PrefixDecl:r,SelectQuery:s,SubSelect:m,SelectClause:t,ConstructQuery:v,DescribeQuery:y,AskQuery:A,DatasetClause:k,DefaultGraphClause:o,NamedGraphClause:z,WhereClause:u,SolutionModifier:H,GroupClause:T,GroupCondition:x,HavingClause:C,OrderClause:G,OrderCondition:E,LimitOffsetClauses:I,LimitClause:K,OffsetClause:L,BindingsClause:M,BindingValue:P,Update:R,Update1:V,
Load:W,Clear:Z,Drop:da,Create:ia,InsertData:ja,DeleteData:pa,DeleteWhere:qa,Modify:ra,DeleteClause:za,InsertClause:Wa,UsingClause:Xa,GraphRef:Aa,GraphRefAll:Ya,QuadPattern:Ua,QuadData:Va,Quads:Za,QuadsNotTriples:$a,TriplesTemplate:ka,GroupGraphPattern:S,GroupGraphPatternSub:ob,TriplesBlock:ua,GraphPatternNotTriples:db,OptionalGraphPattern:rb,GraphGraphPattern:tb,ServiceGraphPattern:ub,MinusGraphPattern:sb,GroupOrUnionGraphPattern:qb,Filter:vb,Constraint:ta,FunctionCall:bb,ArgList:eb,ExpressionList:wb,
ConstructTemplate:nb,ConstructTriples:fb,TriplesSameSubject:cb,PropertyListNotEmpty:va,PropertyList:xb,ObjectList:ha,Verb:Ka,TriplesSameSubjectPath:pb,PropertyListNotEmptyPath:yb,PropertyListPath:zb,VerbPath:La,PathAlternative:gb,PathSequence:Ma,PathElt:hb,PathEltOrInverse:Na,PathMod:Bb,PathPrimary:Ab,PathNegatedPropertySet:Cb,PathOneInPropertySet:wa,TriplesNode:Ja,BlankNodePropertyList:Eb,Collection:Db,GraphNode:la,VarOrTerm:Ia,VarOrIRIref:fa,Var:N,GraphTerm:Fb,ConditionalOrExpression:J,ConditionalAndExpression:Oa,
RelationalExpression:Pa,AdditiveExpression:Q,MultiplicativeExpression:ma,UnaryExpression:X,PrimaryExpression:xa,BrackettedExpression:Ea,BuiltInCall:Da,RegexExpression:Lb,ExistsFunc:Mb,NotExistsFunc:Nb,Aggregate:Kb,IRIrefOrFunction:Jb,RDFLiteral:Fa,NumericLiteral:Ga,NumericLiteralUnsigned:Qb,NumericLiteralPositive:Rb,NumericLiteralNegative:na,BooleanLiteral:Ha,String:Ob,IRIref:O,PrefixedName:bc,BlankNode:Ib,IRI_REF:Ba,PNAME_NS:Ca,PNAME_LN:cc,BLANK_NODE_LABEL:dc,VAR1:Gb,VAR2:Hb,LANGTAG:Pb,INTEGER:$,
DECIMAL:Ra,DOUBLE:Qa,INTEGER_POSITIVE:Ub,DECIMAL_POSITIVE:Tb,DOUBLE_POSITIVE:Sb,INTEGER_NEGATIVE:Xb,DECIMAL_NEGATIVE:Wb,DOUBLE_NEGATIVE:Vb,EXPONENT:Sa,STRING_LITERAL1:$b,STRING_LITERAL2:ac,STRING_LITERAL_LONG1:Yb,STRING_LITERAL_LONG2:Zb,ECHAR:ba,NIL:ga,WS:l,COMMENT:gc,ANON:ec,PN_CHARS_BASE:kb,PN_CHARS_U:oa,VARNAME:jb,PN_CHARS:ya,PN_PREFIX:fc,PN_LOCAL:ib};if(b!==void 0){if(ca[b]===void 0)throw Error("Invalid rule name: "+a(b)+".");}else b="SPARQL";var d=0,j=0,sa=0,ab=[],U=function(a){for(var b="",
d=0;d<a.length;d++)b+=typeof a[d]==="string"?a[d]:a[d].join("");return b},aa=0,mb=function(a){for(var b="",d=0;d<a.length;d++)b+=a[d];return b.toUpperCase()},ca=ca[b]();if(ca===null||d!==e.length){var ca=Math.max(d,sa),jc=ca<e.length?e.charAt(ca):null,hc=ic();throw new this.SyntaxError(lb(ab),jc,ca,hc.line,hc.column);}return ca},toSource:function(){return this._source},SyntaxError:function(b,c,h,f,g){this.name="SyntaxError";this.expected=b;this.found=c;this.message=function(b,c){var e,f;switch(b.length){case 0:e=
"end of input";break;case 1:e=b[0];break;default:e=b.slice(0,b.length-1).join(", ")+" or "+b[b.length-1]}f=c?a(c):"end of input";return"Expected "+e+" but "+f+" found."}(b,c);this.offset=h;this.line=f;this.column=g}};b.SyntaxError.prototype=Error.prototype;return b}();var za=function(){var a={RDFSink_uniqueURI:function(){return"https://github.com/antoniogarrote/rdfstore-js/vocabulary/unique#"},graph:null,Util:{ArrayIndexOf:function(a,e,c){c||(c=0);var h=a.length;for(c<0&&(c=h+c);c<h;c++)if(a[c]===
e)return c;return-1}}};if(typeof a.Util.uri=="undefined")a.Util.uri={};a.Util.uri.join=function(a,e){var a=a||"",c=e.indexOf("#");c>0&&(e=e.slice(0,c));if(a.length==0)return e;if(a.indexOf("#")==0)return e+a;if(a.indexOf(":")>=0)return a;var h=e.indexOf(":");if(e=="")return a;if(h<0)return alert("Invalid base: "+e+" in join with "+a),a;c=e.slice(0,h+1);if(a.indexOf("//")==0)return c+a;if(e.indexOf("//",h)==h+1){var f=e.indexOf("/",h+3);if(f<0)return e.length-h-3>0?e+"/"+a:c+a}else if(f=e.indexOf("/",
h+1),f<0)return e.length-h-1>0?e+"/"+a:c+a;if(a.indexOf("/")==0)return e.slice(0,f)+a;var h=e.slice(f),g=h.lastIndexOf("/");if(g<0)return c+a;g>=0&&g<h.length-1&&(h=h.slice(0,g+1));for(h+=a;h.match(/[^\/]*\/\.\.\//);)h=h.replace(/[^\/]*\/\.\.\//,"");h=h.replace(/\.\//g,"");h=h.replace(/\/\.$/,"/");return e.slice(0,f)+h};a.Empty=function(){return this};a.Empty.prototype.termType="empty";a.Empty.prototype.toString=function(){return"()"};a.Empty.prototype.toQuads=function(){return{uri:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"}};
a.Symbol=function(a){this.value=this.uri=a;return this};a.Symbol.prototype.termType="symbol";a.Symbol.prototype.toString=function(){return"<"+this.uri+">"};a.Symbol.prototype.toQuads=function(){return{token:"uri",prefix:null,suffix:null,value:this.uri}};a.Symbol.prototype.XSDboolean=new a.Symbol("http://www.w3.org/2001/XMLSchema#boolean");a.Symbol.prototype.XSDdecimal=new a.Symbol("http://www.w3.org/2001/XMLSchema#decimal");a.Symbol.prototype.XSDfloat=new a.Symbol("http://www.w3.org/2001/XMLSchema#float");
a.Symbol.prototype.XSDinteger=new a.Symbol("http://www.w3.org/2001/XMLSchema#integer");a.Symbol.prototype.XSDdateTime=new a.Symbol("http://www.w3.org/2001/XMLSchema#dateTime");a.Symbol.prototype.integer=new a.Symbol("http://www.w3.org/2001/XMLSchema#integer");typeof a.NextId!="undefined"?a.log.error("Attempt to re-zero existing blank node id counter at "+a.NextId):a.NextId=0;a.NTAnonymousNodePrefix="_:";a.BlankNode=function(b){this.id=a.NextId++;this.value=b?b:this.id.toString();return this};a.BlankNode.prototype.termType=
"bnode";a.BlankNode.prototype.toString=function(){return a.NTAnonymousNodePrefix+this.id};a.BlankNode.prototype.toString=a.BlankNode.prototype.toNT;a.BlankNode.prototype.toQuads=function(){return{blank:a.NTAnonymousNodePrefix+this.id}};a.Literal=function(a,e,c){this.value=a;this.lang=e==""||e==null?void 0:e;this.datatype=c==null?void 0:c;return this};a.Literal.prototype.termType="literal";a.Literal.prototype.toNT=function(){var a=this.value;if(typeof a!="string"){if(typeof a=="number")return""+a;
throw Error("Value of RDF literal is not string: "+a);}a=a.replace(/\\/g,"\\\\");a=a.replace(/\"/g,'\\"');a=a.replace(/\n/g,"\\n");a='"'+a+'"';this.datatype&&(a=a+"^^"+this.datatype.toNT());this.lang&&(a=a+"@"+this.lang);return a};a.Literal.prototype.toQuads=function(){var a=this.value;if(typeof a!="string"){if(typeof a=="number")return""+a;throw Error("Value of RDF literal is not string: "+a);}a=a.replace(/\\/g,"\\\\");a=a.replace(/\"/g,'\\"');a=a.replace(/\n/g,"\\n");a='"'+a+'"';this.datatype&&
(a=a+"^^<"+this.datatype.value+">");this.lang&&(a=a+"@"+this.lang);return{literal:a}};a.Collection=function(){this.id=a.NextId++;this.elements=[];this.closed=!1};a.Collection.idCounter=0;a.Collection.prototype.termType="collection";a.Collection.prototype.toNT=function(){return a.NTAnonymousNodePrefix+this.id};a.Collection.prototype.toQuads=function(){var b=[],e="_:list"+a.Collection.idCounter;a.Collection.idCounter++;for(var c={uri:"http://www.w3.org/1999/02/22-rdf-syntax-ns#first"},h={uri:"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"},
f={uri:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"},g,i={blank:e+"p"+r},r=0;r<this.elements.length;r++)g=i,i=r<this.elements.length-1?{blank:e+"p"+(r+1)}:f,b.push({subject:g,predicate:c,object:this.elements[r].toQuads(),graph:a.graph}),b.push({subject:g,predicate:h,object:i,graph:a.graph});return b};a.Collection.prototype.append=function(a){this.elements.push(a)};a.Collection.prototype.unshift=function(a){this.elements.unshift(a)};a.Collection.prototype.shift=function(){return this.elements.shift()};
a.Collection.prototype.close=function(){this.closed=!0};a.term=function(b){if(typeof b=="object")if(b instanceof Date){var e=function(a){return(""+(100+a)).slice(1,3)};return new a.Literal(""+b.getUTCFullYear()+"-"+e(b.getUTCMonth()+1)+"-"+e(b.getUTCDate())+"T"+e(b.getUTCHours())+":"+e(b.getUTCMinutes())+":"+e(b.getUTCSeconds())+"Z",void 0,a.Symbol.prototype.XSDdateTime)}else if(b instanceof Array){for(var e=new a.Collection,c=0;c<b.length;c++)e.append(a.term(b[c]));return e}else return b;if(typeof b==
"string")return new a.Literal(b);if(typeof b=="number")return e=(""+b).indexOf("e")>=0?a.Symbol.prototype.XSDfloat:(""+b).indexOf(".")>=0?a.Symbol.prototype.XSDdecimal:a.Symbol.prototype.XSDinteger,new a.Literal(b,void 0,e);if(typeof b=="boolean")return new a.Literal(b?"1":"0",void 0,a.Symbol.prototype.XSDboolean);if(typeof b!="undefined")throw"Can't make term from "+b+" of type "+typeof b;};a.Statement=function(b,e,c,h){this.subject=a.term(b);this.predicate=a.term(e);this.object=a.term(c);if(typeof h!=
"undefined")this.why=h;return this};a.st=function(b,e,c,h){return new a.Statement(b,e,c,h)};a.Statement.prototype.toNT=function(){return this.subject.toNT()+" "+this.predicate.toNT()+" "+this.object.toNT()+" ."};a.Statement.prototype.toQuads=function(){var b=this.object.toQuads();if(b.constructor===Array){var e=b[0].subject;b.push({subject:this.subject.toQuads(),predicate:this.predicate.toQuads(),object:e,graph:a.graph});return b}else return{subject:this.subject.toQuads(),predicate:this.predicate.toQuads(),
object:this.object.toQuads(),graph:a.graph}};a.Formula=function(){this.statements=[];return this};a.Formula.prototype.termType="formula";a.Formula.prototype.toNT=function(){return"{"+this.statements.join("\n")+"}"};a.Formula.prototype.toQuads=function(){for(var a=[],e=0;e<this.statements.length;e++){var c=this.statements[e].toQuads();c.constructor===Array?a=a.concat(c):a.push(c)}return a};a.Formula.prototype.add=function(b,e,c,h){this.statements.push(new a.Statement(b,e,c,h))};a.Formula.prototype.sym=
function(b){return new a.Symbol(b)};a.sym=function(b){return new a.Symbol(b)};a.Formula.prototype.literal=function(b,e,c){if(c!=null&&c.value!=null&&c.value.indexOf("http://")===-1)for(var h in this.namespaces)if(c.value.indexOf(h)===0){c.value=this.namespaces[h]+c.value.split(h+":")[1];break}return new a.Literal(""+b,e,c)};a.lit=a.Formula.prototype.literal;a.Formula.prototype.bnode=function(b){return new a.BlankNode(b)};a.Formula.prototype.formula=function(){return new a.Formula};a.Formula.prototype.collection=
function(){return new a.Collection};a.Formula.prototype.list=function(b){li=new a.Collection;if(b)for(var e=0;e<b.length;e++)li.append(b[e]);return li};a.Graph=function(){return new a.IndexedFormula};a.N3Parser=function(){function b(b,c,e,h,i,n,r,s){typeof c=="undefined"&&(c=null);typeof e=="undefined"&&(e="");typeof h=="undefined"&&(h=null);typeof i=="undefined"&&(i="");typeof r=="undefined"&&(r="");typeof s=="undefined"&&(s=null);this._bindings=new g([]);this._flags=r;e&&e!=""&&(m(e.indexOf(":")>=
0,"Document URI not absolute: "+e),this._bindings[""]=e+"#");this._store=b;i&&b.setGenPrefix(i);this._thisDoc=e;this.source=b.sym(e);this.previousLine=this.startOfLine=this.statementCount=this.lines=0;this._genPrefix=i;this.keywords=new f(["a","this","bind","has","is","of","true","false"]);this.keywordsSet=0;this._anonymousNodes=new g([]);this._variables=new g([]);this._parentVariables=new g([]);this._reason=s;this._reason2=null;if(t)this._reason2=why_BecauseOfData(b.sym(e),this._reason);this._baseURI=
h?h:e?e:null;m(!this._baseURI||this._baseURI.indexOf(":")>=0);if(!this._genPrefix)this._genPrefix=this._thisDoc?this._thisDoc+"#_g":a.RDFSink_uniqueURI();this._context=this._formula=c==null?this._thisDoc?b.formula(e+"#_formula"):b.formula():c;this._parentContext=null}function e(a,b,c,e,f){return"Line "+(b+1)+" of <"+a+">: Bad syntax: "+f+'\nat: "'+i(c,e,e+30)+'"'}var c={encode:function(a){for(var a=a.replace(/\r\n/g,"\n"),b="",c=0;c<a.length;c++){var e=a.charCodeAt(c);e<128?b+=String.fromCharCode(e):
(e>127&&e<2048?b+=String.fromCharCode(e>>6|192):(b+=String.fromCharCode(e>>12|224),b+=String.fromCharCode(e>>6&63|128)),b+=String.fromCharCode(e&63|128))}return b},decode:function(a){for(var b="",c=0;c<a.length;){var e=a.charCodeAt(c);e<128?(b+=String.fromCharCode(e),c++):e>191&&e<224?(b+=String.fromCharCode((e&31)<<6|a.charCodeAt(c+1)&63),c+=2):(b+=String.fromCharCode((e&15)<<12|(a.charCodeAt(c+1)&63)<<6|a.charCodeAt(c+2)&63),c+=3)}return b}},h=function(a){return a},f=function(a){return a},g=function(a){if(a.length>
0)throw"missing.js: oops nnonempty dict not imp";return[]},i=function(a,b,c){if(typeof a.slice=="undefined")throw"@@ mising.js: No .slice function for "+a+" of type "+typeof a;return typeof c=="undefined"||c==null?a.slice(b):a.slice(b,c)},r=Error("dummy error stop iteration"),s=function(a){this.last=0;this.li=a;this.next=function(){if(this.last==this.li.length)throw r;return this.li[this.last++]};return this},m=function(a,b){if(!a){if(b)throw"python Assertion failed: "+b;throw"(python) Assertion failed.";
}};String.prototype.encode=function(a){if(a!="utf-8")throw"UTF8_converter: can only do utf-8";return c.encode(this)};String.prototype.decode=function(a){if(a!="utf-8")throw"UTF8_converter: can only do utf-8";return this};var t=0,v=RegExp("^([-+]?[0-9]+)(\\.[0-9]+)?(e[-+]?[0-9]+)?","g"),y=RegExp('[\\\\\\r\\n\\"]',"g"),A=RegExp("^[a-zA-Z0-9]+(-[a-zA-Z0-9]+)?","g");b.prototype.here=function(a){return this._genPrefix+"_L"+this.lines+"C"+(a-this.startOfLine+1)};b.prototype.formula=function(){return this._formula};
b.prototype.loadStream=function(a){return this.loadBuf(a.read())};b.prototype.loadBuf=function(a){this.startDoc();this.feed(a);return this.endDoc()};b.prototype.feed=function(a){var b=a.decode("utf-8"),a=[],c=b.length,e=0;numChunks=c/524288;for(var f=0;f<numChunks+1;f++)e+524288<c?a.push(b.substring(e,e+524288)):a.push(b.substring(e,c)),e+=524288;for(f=b=0;f>=0;)if(c=this.skipSpace(a[b],f),c<0)if(b==a.length-1)break;else b++,f=0;else{f=c;try{f=this.directiveOrStatement(a[b],c)}catch(g){if(b==a.length-
1)throw g;c=f;f=-1}f<0&&(f=a[b].substring(c,a[b].length),b++,a[b]=f+a[b],f=0)}};b.prototype.directiveOrStatement=function(a,b){var c=this.skipSpace(a,b);if(c<0)return c;var e=this.directive(a,c);if(e>=0)return this.checkDot(a,e);e=this.statement(a,c);return e>=0?this.checkDot(a,e):e};b.prototype.tok=function(b,c,e){if(i(c,e,e+1)=="@")e+=1;else if(a.Util.ArrayIndexOf(this.keywords,b)<0)return-1;var f=e+b.length;return i(c,e,f)==b&&"\t\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~".indexOf(c.charAt(f))>=0?f:
-1};b.prototype.directive=function(b,c){var g=this.skipSpace(b,c);if(g<0)return g;var h=new f([]),g=this.tok("bind",b,c);if(g>0)throw e(this._thisDoc,this.lines,b,c,"keyword bind is obsolete: use @prefix");g=this.tok("keywords",b,c);if(g>0){c=this.commaSeparatedList(b,g,h,!1);if(c<0)throw e(this._thisDoc,this.lines,b,c,"'@keywords' needs comma separated list of words");this.setKeywords(i(h,null,null));return c}g=this.tok("forAll",b,c);if(g>0){c=this.commaSeparatedList(b,g,h,!0);if(c<0)throw e(this._thisDoc,
this.lines,b,c,"Bad variable list after @forAll");g=new s(h);try{for(;;){var t=g.next();if(a.Util.ArrayIndexOf(this._variables,t)<0||a.Util.ArrayIndexOf(this._parentVariables,t)>=0)this._variables[t]=this._context.newUniversal(t)}}catch(v){if(v!=r)throw v;}return c}g=this.tok("forSome",b,c);if(g>0){c=this.commaSeparatedList(b,g,h,this.uri_ref2);if(c<0)throw e(this._thisDoc,this.lines,b,c,"Bad variable list after @forSome");g=new s(h);try{for(;;)t=g.next(),this._context.declareExistential(t)}catch(x){if(x!=
r)throw x;}return c}g=this.tok("prefix",b,c);if(g>=0){t=new f([]);c=this.qname(b,g,t);if(c<0)throw e(this._thisDoc,this.lines,b,g,"expected qname after @prefix");g=this.uri_ref2(b,c,t);if(g<0)throw e(this._thisDoc,this.lines,b,c,"expected <uriref> after @prefix _qname_");h=t[1].uri;this._baseURI?h=a.Util.uri.join(h,this._baseURI):m(h.indexOf(":")>=0,"With no base URI, cannot handle relative URI for NS");m(h.indexOf(":")>=0);this._bindings[t[0][0]]=h;this.bind(t[0][0],encodeURI(h));return g}g=this.tok("base",
b,c);if(g>=0){t=new f([]);c=this.uri_ref2(b,g,t);if(c<0)throw e(this._thisDoc,this.lines,b,g,"expected <uri> after @base ");h=t[0].uri;if(this._baseURI)h=a.Util.uri.join(h,this._baseURI);else throw e(this._thisDoc,this.lines,b,g,"With no previous base URI, cannot use relative URI in @base  <"+h+">");m(h.indexOf(":")>=0);this._baseURI=h;return c}return-1};b.prototype.bind=function(a,b){this._store.setPrefixForURI(a,b);a!=""&&this._store.setPrefixForURI(a,b)};b.prototype.setKeywords=function(a){a==
null?this.keywordsSet=0:(this.keywords=a,this.keywordsSet=1)};b.prototype.startDoc=function(){};b.prototype.endDoc=function(){return this._formula};b.prototype.makeStatement=function(a){a[0].add(a[2],a[1],a[3],this.source);this.statementCount+=1};b.prototype.statement=function(a,b){var c=new f([]),b=this.object(a,b,c);if(b<0)return b;c=this.property_list(a,b,c[0]);if(c<0)throw e(this._thisDoc,this.lines,a,b,"expected propertylist");return c};b.prototype.subject=function(a,b,c){return this.item(a,
b,c)};b.prototype.verb=function(a,b,c){var g=this.skipSpace(a,b);if(g<0)return g;var m=new f([]),g=this.tok("has",a,b);if(g>=0){b=this.prop(a,g,m);if(b<0)throw e(this._thisDoc,this.lines,a,g,"expected property after 'has'");c.push(new h(["->",m[0]]));return b}g=this.tok("is",a,b);if(g>=0){b=this.prop(a,g,m);if(b<0)throw e(this._thisDoc,this.lines,a,g,"expected <property> after 'is'");g=this.skipSpace(a,b);if(g<0)throw e(this._thisDoc,this.lines,a,b,"End of file found, expected property after 'is'");
b=g;g=this.tok("of",a,b);if(g<0)throw e(this._thisDoc,this.lines,a,b,"expected 'of' after 'is' <prop>");c.push(new h(["<-",m[0]]));return g}g=this.tok("a",a,b);if(g>=0)return c.push(new h(["->",this._store.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type")])),g;if(i(a,b,b+2)=="<=")return c.push(new h(["<-",this._store.sym("http://www.w3.org/2000/10/swap/log#implies")])),b+2;if(i(a,b,b+1)=="="){if(i(a,b+1,b+2)==">")return c.push(new h(["->",this._store.sym("http://www.w3.org/2000/10/swap/log#implies")])),
b+2;c.push(new h(["->",this._store.sym("http://www.w3.org/2002/07/owl#sameAs")]));return b+1}if(i(a,b,b+2)==":=")return c.push(new h(["->","http://www.w3.org/2000/10/swap/log#becomes"])),b+2;g=this.prop(a,b,m);if(g>=0)return c.push(new h(["->",m[0]])),g;if(i(a,b,b+2)==">-"||i(a,b,b+2)=="<-")throw e(this._thisDoc,this.lines,a,g,">- ... -> syntax is obsolete.");return-1};b.prototype.prop=function(a,b,c){return this.item(a,b,c)};b.prototype.item=function(a,b,c){return this.path(a,b,c)};b.prototype.blankNode=
function(a){return this._context.bnode(a,this._reason2)};b.prototype.path=function(a,b,c){b=this.nodeOrLiteral(a,b,c);if(b<0)return b;for(;"!^.".indexOf(i(a,b,b+1))>=0;){var f=i(a,b,b+1);if(f=="."){var g=i(a,b+1,b+2);if(!g||"\t\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~:".indexOf(g)>=0&&":?<[{(".indexOf(g)<0)break}var g=c.pop(),m=this.blankNode(this.here(b)),b=this.node(a,b+1,c);if(b<0)throw e(this._thisDoc,this.lines,a,b,"EOF found in middle of path syntax");var r=c.pop();f=="^"?this.makeStatement(new h([this._context,
r,m,g])):this.makeStatement(new h([this._context,r,g,m]));c.push(m)}return b};b.prototype.anonymousNode=function(a){var b=this._anonymousNodes[a];if(b)return b;b=this._store.bnode(this._context,this._reason2);return this._anonymousNodes[a]=b};b.prototype.node=function(a,b,c,m){typeof m=="undefined"&&(m=null);var t=m,m=this.skipSpace(a,b);if(m<0)return m;b=m;m=i(a,b,b+1);if(m=="["){var v=this.here(b),m=this.skipSpace(a,b+1);if(m<0)throw e(this._thisDoc,this.lines,a,b,"EOF after '['");if(i(a,m,m+1)==
"="){var b=m+1,x=new f([]),m=this.objectList(a,b,x);if(m>=0){t=x[0];if(x.length>1){x=new s(x);try{for(;;){var F=x.next();this.makeStatement(new h([this._context,this._store.sym("http://www.w3.org/2002/07/owl#sameAs"),t,F]))}}catch(y){if(y!=r)throw y;}}m=this.skipSpace(a,m);if(m<0)throw e(this._thisDoc,this.lines,a,b,"EOF when objectList expected after [ = ");i(a,m,m+1)==";"&&(m+=1)}else throw e(this._thisDoc,this.lines,a,b,"objectList expected after [= ");}t==null&&(t=this.blankNode(v));b=this.property_list(a,
m,t);if(b<0)throw e(this._thisDoc,this.lines,a,m,"property_list expected");m=this.skipSpace(a,b);if(m<0)throw e(this._thisDoc,this.lines,a,b,"EOF when ']' expected after [ <propertyList>");if(i(a,m,m+1)!="]")throw e(this._thisDoc,this.lines,a,m,"']' expected");c.push(t);return m+1}if(m=="{"){m=i(a,b+1,b+2);if(m=="$"){b+=1;m=b+1;t=new f([]);for(v=!0;;){b=this.skipSpace(a,m);if(b<0)throw e(this._thisDoc,this.lines,a,b,"needed '$}', found end.");if(i(a,b,b+2)=="$}"){m=b+2;break}if(v)v=!1;else if(i(a,
b,b+1)==",")b+=1;else throw e(this._thisDoc,this.lines,a,b,"expected: ','");F=new f([]);m=this.item(a,b,F);if(m<0)throw e(this._thisDoc,this.lines,a,b,"expected item in set or '$}'");t.push(F[0])}c.push(this._store.newSet(t,this._context))}else{m=b+1;F=this._parentContext;this._parentContext=this._context;v=this._anonymousNodes;x=this._parentVariables;this._parentVariables=this._variables;this._anonymousNodes=new g([]);this._variables=this._variables.slice();var Y=this._reason2;this._reason2=null;
t==null&&(t=this._store.formula());for(this._context=t;;){b=this.skipSpace(a,m);if(b<0)throw e(this._thisDoc,this.lines,a,b,"needed '}', found end.");if(i(a,b,b+1)=="}"){m=b+1;break}m=this.directiveOrStatement(a,b);if(m<0)throw e(this._thisDoc,this.lines,a,b,"expected statement or '}'");}this._anonymousNodes=v;this._variables=this._parentVariables;this._parentVariables=x;this._context=this._parentContext;this._reason2=Y;this._parentContext=F;c.push(t.close())}return m}if(m=="("){v=this._store.list;
m=i(a,b+1,b+2);if(m=="$")v=this._store.newSet,b+=1;m=b+1;for(t=new f([]);;){b=this.skipSpace(a,m);if(b<0)throw e(this._thisDoc,this.lines,a,b,"needed ')', found end.");if(i(a,b,b+1)==")"){m=b+1;break}F=new f([]);m=this.item(a,b,F);if(m<0)throw e(this._thisDoc,this.lines,a,b,"expected item in list or ')'");t.push(F[0])}c.push(v(t,this._context));return m}m=this.tok("this",a,b);if(m>=0)throw e(this._thisDoc,this.lines,a,b,"Keyword 'this' was ancient N3. Now use @forSome and @forAll keywords.");m=this.tok("true",
a,b);if(m>=0)return c.push(!0),m;m=this.tok("false",a,b);return m>=0?(c.push(!1),m):t==null&&(m=this.uri_ref2(a,b,c),m>=0)?m:-1};b.prototype.property_list=function(a,b,c){for(;;){var g=this.skipSpace(a,b);if(g<0)throw e(this._thisDoc,this.lines,a,b,"EOF found when expected verb in property list");if(i(a,g,g+2)==":-"){var b=g+2,m=new f([]),g=this.node(a,b,m,c);if(g<0)throw e(this._thisDoc,this.lines,a,b,"bad {} or () or [] node after :- ");b=g}else{b=g;m=new f([]);g=this.verb(a,b,m);if(g<=0)return b;
var t=new f([]),b=this.objectList(a,g,t);if(b<0)throw e(this._thisDoc,this.lines,a,g,"objectList expected");g=new s(t);try{for(;;){var v=g.next(),F=m[0],y=F[1];F[0]=="->"?this.makeStatement(new h([this._context,y,c,v])):this.makeStatement(new h([this._context,y,v,c]))}}catch(Y){if(Y!=r)throw Y;}g=this.skipSpace(a,b);if(g<0)throw e(this._thisDoc,this.lines,a,g,"EOF found in list of objects");if(i(a,b,b+1)!=";")return b;b+=1}}};b.prototype.commaSeparatedList=function(a,b,c,f){var g=this.skipSpace(a,
b);if(g<0)throw e(this._thisDoc,this.lines,a,g,"EOF found expecting comma sep list");if(a.charAt(g)==".")return b;g=f?this.uri_ref2(a,g,c):this.bareWord(a,g,c);if(g<0)return-1;for(;;){b=this.skipSpace(a,g);if(b<0)return b;g=i(a,b,b+1);if(g!=",")return g!="."?-1:b;g=f?this.uri_ref2(a,b+1,c):this.bareWord(a,b+1,c);if(g<0)throw e(this._thisDoc,this.lines,a,g,"bad list content");}};b.prototype.objectList=function(a,b,c){b=this.object(a,b,c);if(b<0)return-1;for(;;){b=this.skipSpace(a,b);if(b<0)throw e(this._thisDoc,
this.lines,a,b,"EOF found after object");if(i(a,b,b+1)!=",")return b;b=this.object(a,b+1,c);if(b<0)return b}};b.prototype.checkDot=function(a,b){var c=this.skipSpace(a,b);if(c<0)return c;if(i(a,c,c+1)==".")return c+1;if(i(a,c,c+1)=="}")return c;if(i(a,c,c+1)=="]")return c;throw e(this._thisDoc,this.lines,a,c,"expected '.' or '}' or ']' at end of statement");};b.prototype.uri_ref2=function(b,c,g){var h=new f([]),r=this.qname(b,c,h);if(r>=0){var s=h[0],h=s[0],s=s[1];if(h==null){m(0,"not used?");var t=
this._baseURI+"#"}else if(t=this._bindings[h],!t){if(h=="_")return g.push(this.anonymousNode(s)),r;throw e(this._thisDoc,this.lines,b,c,"Prefix "+h+" not bound.");}b=this._store.sym(t+s);a.Util.ArrayIndexOf(this._variables,b)>=0?g.push(this._variables[b]):g.push(b);return r}c=this.skipSpace(b,c);if(c<0)return-1;if(b.charAt(c)=="?")return h=new f([]),r=this.variable(b,c,h),r>0?(g.push(h[0]),r):-1;else if(b.charAt(c)=="<"){c+=1;for(h=c;c<b.length;){if(b.charAt(c)==">")return r=i(b,h,c),this._baseURI?
r=a.Util.uri.join(r,this._baseURI):m(r.indexOf(":")>=0,"With no base URI, cannot deal with relative URIs"),i(b,c-1,c)=="#"&&i(r,-1,null)!="#"&&(r+="#"),b=this._store.sym(r),a.Util.ArrayIndexOf(this._variables,b)>=0?g.push(this._variables[b]):g.push(b),c+1;c+=1}throw e(this._thisDoc,this.lines,b,r,"unterminated URI reference");}else if(this.keywordsSet){h=new f([]);r=this.bareWord(b,c,h);if(r<0)return-1;if(a.Util.ArrayIndexOf(this.keywords,h[0])>=0)throw e(this._thisDoc,this.lines,b,c,'Keyword "'+
h[0]+'" not allowed here.');g.push(this._store.sym(this._bindings[""]+h[0]));return r}else return-1};b.prototype.skipSpace=function(a,b){for(var c=a,e=b?b:0;e<a.length;e++)if(" \n\r\t\u000c\u000b\u00a0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000".indexOf(a.charAt(e))===-1)if(a.charAt(e)==="#")a=a.slice(b).replace(/^[^\n]*\n/,""),b=0,e=-1;else break;val=c.length-a.length+e;return val===c.length?-1:val};b.prototype.variable=function(a,b,c){var f=this.skipSpace(a,
b);if(f<0)return-1;if(i(a,f,f+1)!="?")return-1;f+=1;b=f;if("0123456789-".indexOf(a.charAt(f))>=0)throw e(this._thisDoc,this.lines,a,f,"Varible name can't start with '"+a.charAt(f)+"s'");for(;b<a.length&&"\t\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~:".indexOf(a.charAt(b))<0;)b+=1;if(this._parentContext==null)throw e(this._thisDoc,this.lines,a,f,"Can't use ?xxx syntax for variable in outermost level: "+i(a,f-1,b));c.push(this._store.variable(i(a,f,b)));return b};b.prototype.bareWord=function(a,b,c){var e=
this.skipSpace(a,b);if(e<0)return-1;b=a.charAt(e);if("0123456789-".indexOf(b)>=0)return-1;if("\t\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~:".indexOf(b)>=0)return-1;for(b=e;b<a.length&&"\t\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~:".indexOf(a.charAt(b))<0;)b+=1;c.push(i(a,e,b));return b};b.prototype.qname=function(b,c,e){c=this.skipSpace(b,c);if(c<0)return-1;var f=b.charAt(c);if("0123456789-+".indexOf(f)>=0)return-1;if("\t\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~:".indexOf(f)<0){var g=f;for(c+=1;c<b.length;)if(f=b.charAt(c),
"\t\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~:".indexOf(f)<0)g+=f,c+=1;else break}else g="";if(c<b.length&&b.charAt(c)==":"){var i=g;c+=1;for(g="";c<b.length;)if(f=b.charAt(c),"\t\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~:".indexOf(f)<0)g+=f,c+=1;else break;e.push(new h([i,g]));return c}else return g&&this.keywordsSet&&a.Util.ArrayIndexOf(this.keywords,g)<0?(e.push(new h(["",g])),c):-1};b.prototype.object=function(a,b,c){var e=this.subject(a,b,c);if(e>=0)return e;else{e=this.skipSpace(a,b);if(e<0)return-1;else b=
e;return a.charAt(b)=='"'?(e=i(a,b,b+3)=='"""'?'"""':'"',b+=e.length,a=this.strconst(a,b,e),e=a[0],c.push(this._store.literal(a[1])),e):-1}};b.prototype.nodeOrLiteral=function(a,b,c){var g=this.node(a,b,c);if(g>=0)return g;else{g=this.skipSpace(a,b);if(g<0)return-1;else b=g;if("-+0987654321".indexOf(a.charAt(b))>=0){v.lastIndex=0;var h=v.exec(a.slice(b));if(h==null)throw e(this._thisDoc,this.lines,a,b,"Bad number syntax");var g=b+v.lastIndex,m=i(a,b,g);m.indexOf("e")>=0?c.push(this._store.literal(parseFloat(m),
void 0,this._store.sym("http://www.w3.org/2001/XMLSchema#double"))):i(a,b,g).indexOf(".")>=0?c.push(this._store.literal(parseFloat(m),void 0,this._store.sym("http://www.w3.org/2001/XMLSchema#decimal"))):c.push(this._store.literal(parseInt(m),void 0,this._store.sym("http://www.w3.org/2001/XMLSchema#integer")));return g}if(a.charAt(b)=='"'){g=i(a,b,b+3)=='"""'?'"""':'"';b+=g.length;var m=null,r=this.strconst(a,b,g),g=r[0],r=r[1],h=null;if(i(a,g,g+1)=="@"){A.lastIndex=0;h=A.exec(a.slice(g+1));if(h==
null)throw e(this._thisDoc,startline,a,b,"Bad language code syntax on string literal, after @");b=A.lastIndex+g+1;h=i(a,g+1,b);g=b}i(a,g,g+2)=="^^"&&(b=new f([]),g=this.uri_ref2(a,g+2,b),m=b[0]);c.push(this._store.literal(r,h,m));return g}else return-1}};b.prototype.strconst=function(a,b,c){for(var f=b,g="",m=this.lines;f<a.length;){b=f+c.length;if(i(a,f,b)==c)return new h([b,g]);if(a.charAt(f)=='"')g+='"',f+=1;else{y.lastIndex=0;if(!y.exec(a.slice(f)))throw e(this._thisDoc,m,a,f,"Closing quote missing in string at ^ in "+
i(a,f-20,f)+"^"+i(a,f,f+20));b=f+y.lastIndex-1;g+=i(a,f,b);var r=a.charAt(b);if(r=='"')f=b;else if(r=="\r")f=b+1;else if(r=="\n"){if(c=='"')throw e(this._thisDoc,m,a,b,"newline found in string literal");this.lines+=1;g+=r;f=b+1;this.previousLine=this.startOfLine;this.startOfLine=f}else if(r=="\\"){f=b+1;r=i(a,f,f+1);if(!r)throw e(this._thisDoc,m,a,b,"unterminated string literal (2)");var s='abfrtvn\\"'.indexOf(r);if(s>=0)r='a\u0008\u000c\r\t\u000b\n\\"'.charAt(s),g+=r,f+=1;else if(r=="u")r=this.uEscape(a,
f+1,m),f=r[0],r=r[1],g+=r;else if(r=="U")r=this.UEscape(a,f+1,m),f=r[0],r=r[1],g+=r;else throw e(this._thisDoc,this.lines,a,b,"bad escape");}}}throw e(this._thisDoc,this.lines,a,b,"unterminated string literal");};b.prototype.uEscape=function(a,b,c){for(var f=b,g=0,m=0;g<4;){var r=i(a,f,f+1).toLowerCase();f+=1;if(r=="")throw e(this._thisDoc,c,a,b,"unterminated string literal(3)");r="0123456789abcdef".indexOf(r);if(r<0)throw e(this._thisDoc,c,a,b,"bad string literal hex escape");m=m*16+r;g+=1}a=String.fromCharCode(m);
return new h([f,a])};b.prototype.UEscape=function(a,b,c){for(var f=b,g=0,m="\\U";g<8;){var r=i(a,f,f+1).toLowerCase();f+=1;if(r=="")throw e(this._thisDoc,c,a,b,"unterminated string literal(3)");if("0123456789abcdef".indexOf(r)<0)throw e(this._thisDoc,c,a,b,"bad string literal hex escape");m+=r;g+=1}a="0x"+i(m,2,10)-0;a=String.fromCharCode(a);return new h([f,a])};return function(a,c,e,f,g,h,i,n){return new b(a,c,e,f,g,h,i,n)}}();a.IndexedFormula=function(){function b(b,c){if(typeof c!="object"){if(typeof c==
"string")return new a.Literal(c);if(typeof c=="number")return new a.Literal(c);if(typeof c=="boolean")return new a.Literal(c?"1":"0",void 0,a.Symbol.prototype.XSDboolean);else if(typeof c=="number")return new a.Literal(""+c);else if(typeof c=="undefined")return;else throw"Can't make Term from "+c+" of type "+typeof c;}return c}a.IndexedFormula=function(){this.statements=[];this.propertyActions=[];this.classActions=[];this.redirections=[];this.aliases=[];this.HTTPRedirects=[];this.subjectIndex=[];
this.predicateIndex=[];this.objectIndex=[];this.whyIndex=[];this.index=[this.subjectIndex,this.predicateIndex,this.objectIndex,this.whyIndex];this.namespaces={}};a.IndexedFormula.prototype=new a.Formula;a.IndexedFormula.prototype.constructor=a.IndexedFormula;a.IndexedFormula.SuperClass=a.Formula;a.IndexedFormula.prototype.setPrefixForURI=function(a,b){a=="tab"&&this.namespaces.tab||(this.namespaces[a]=b)};a.IndexedFormula.prototype.register=function(a,b){this.namespaces[a]=b};a.IndexedFormula.prototype.canon=
function(a){return a};a.IndexedFormula.prototype.add=function(e,c,h,f){f==void 0&&(f=this.fetcher?this.fetcher.appNode:this.sym("chrome:theSession"));e=b(this,e);c=b(this,c);h=b(this,h);f=b(this,f);e=new a.Statement(e,c,h,f);this.statements.push(e);return e};a.IndexedFormula.prototype.formula=function(b){return new a.IndexedFormula(b)};return a.IndexedFormula}();a.parse=function(b,e,c,h){try{if(h=="text/n3"||h=="text/turtle"){a.graph=c;a.N3Parser(e,e,null,null,null,null,"",null).loadBuf(b);return}}catch(f){throw"Error trying to parse N3 data:"+
f;}throw"Don't know how to parse "+h+" yet";};return a}(),ja={parser:{}};ja.parser.parse=function(a,b){var e=new za.Graph;try{za.parse(a,e,b,"text/n3")}catch(c){throw c;}return e.toQuads()};var t={defaultContext:{rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",xsd:"http://www.w3.org/2001/XMLSchema#",dcterms:"http://purl.org/dc/terms/",foaf:"http://xmlns.com/foaf/0.1/",cal:"http://www.w3.org/2002/12/cal/ical#",vcard:"http://www.w3.org/2006/vcard/ns# ",
geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",cc:"http://creativecommons.org/ns#",sioc:"http://rdfs.org/sioc/ns#",doap:"http://usefulinc.com/ns/doap#",com:"http://purl.org/commerce#",ps:"http://purl.org/payswarm#",gr:"http://purl.org/goodrelations/v1#",sig:"http://purl.org/signature#",ccard:"http://purl.org/commerce/creditcard#"},UrisMap:function(){this.defaultNs="";this.interfaceProperties=["get","remove","set","setDefault","addAll","resolve","shrink"]}};t.UrisMap.prototype.values=function(){var a=
{},b;for(b in this)!v.include(this.interfaceProperties,b)&&typeof this[b]!=="function"&&b!=="defaultNs"&&b!=="interfaceProperties"&&(a[b]=this[b]);return a};t.UrisMap.prototype.get=function(a){if(a.indexOf(" ")!=-1)throw"Prefix must not contain any whitespaces";return this[a]};t.UrisMap.prototype.remove=function(a){if(a.indexOf(" ")!=-1)throw"Prefix must not contain any whitespaces";delete this[a];return null};t.UrisMap.prototype.set=function(a,b){if(a.indexOf(" ")!=-1)throw"Prefix must not contain any whitespaces";
this[a]=b};t.UrisMap.prototype.setDefault=function(a){this.defaultNs=a};t.UrisMap.prototype.addAll=function(a,b){for(var e in a)v.include(this.interfaceProperties,e)||(this[e]!=null?b===!0&&(this[e]=a[e]):this[e]=a[e]);return this};t.UrisMap.prototype.resolve=function(a){var b=a.split(":"),a=b[0],b=b[1];return a===""?this.defaultNs==null?null:this.defaultNs+b:this[a]!=null?this[a]+b:null};t.UrisMap.prototype.shrink=function(a){for(var b in this){var e=this[b];if(a.indexOf(e)===0&&e!==""&&b!="defaultNs")return a=
a.split(e)[1],b+":"+a}return a};t.Profile=function(){this.prefixes=new t.UrisMap;this.terms=new t.UrisMap};t.Profile.prototype.importProfile=function(a,b){this.prefixes.addAll(a.prefixes,b);this.terms.addAll(a.terms,b)};t.Profile.prototype.resolve=function(a){return a.indexOf(":")!=-1?this.prefixes.resolve(a):this.terms[a]!=null?this.terms.resolve(a):null};t.Profile.prototype.setDefaultPrefix=function(a){this.prefixes.setDefault(a)};t.Profile.prototype.setDefaultVocabulary=function(a){this.terms.setDefault(a)};
t.Profile.prototype.setPrefix=function(a,b){this.prefixes.set(a,b)};t.Profile.prototype.setTerm=function(a,b){this.terms.set(a,b)};t.RDFEnvironment=function(){this.blankNodeCounter=0;var a=this;this.filters={s:function(a){return function(b){return b.subject.equals(a)}},p:function(a){return function(b){return b.predicate.equals(a)}},o:function(a){return function(b){return b.object.equals(a)}},sp:function(a,b){return function(h){return h.subject.equals(a)&&h.predicate.equals(b)}},so:function(a,b){return function(h){return h.subject.equals(a)&&
h.object.equals(b)}},po:function(a,b){return function(h){return h.predicate.equals(a)&&h.object.equals(b)}},spo:function(a,b,h){return function(f){return f.subject.equals(a)&&f.predicate.equals(b)&&f.object.equals(h)}},describes:function(a){return function(b){return b.subject.equals(a)||b.object.equals(a)}},type:function(b){var c=a.resolve("rdf:type");return function(a){return a.predicate.equals(c)&&a.object.equals(b)}}};for(var b in t.defaultContext)this.prefixes.set(b,t.defaultContext[b])};v["extends"](t.Profile,
t.RDFEnvironment);t.RDFEnvironment.prototype.createBlankNode=function(){var a=new t.BlankNode(this.blankNodeCounter);this.blankNodeCounter++;return a};t.RDFEnvironment.prototype.createNamedNode=function(a){var b=this.resolve(a);return b!=null?new t.NamedNode(b):new t.NamedNode(a)};t.RDFEnvironment.prototype.createLiteral=function(a,b,e){return e!=null?new t.Literal(a,b,e.toString()):new t.Literal(a,b,e)};t.RDFEnvironment.prototype.createTriple=function(a,b,e){return new t.Triple(a,b,e)};t.RDFEnvironment.prototype.createGraph=
function(a){var b=new t.Graph;if(a!=null)for(var e=0;e<a.length;e++)b.add(a[e]);return b};t.RDFEnvironment.prototype.createAction=function(a,b){return function(e){return a(e)?b(e):e}};t.RDFEnvironment.prototype.createProfile=function(a){return a===!0?new t.RDFEnvironment.Profile:(a=new t.RDFEnvironment.Profile,a.importProfile(this),a)};t.RDFEnvironment.prototype.createTermMap=function(a){if(a===!0)return new t.UrisMap;else{var a=this.terms.values(),b=new t.UrisMap,e;for(e in a)b[e]=a[e];return b}};
t.RDFEnvironment.prototype.createPrefixMap=function(a){if(a===!0)return new t.UrisMap;else{var a=this.prefixes.values(),b=new t.UrisMap,e;for(e in a)b[e]=a[e];return b}};t.RDFNode=function(a){this.interfaceName=a;this.attributes=["interfaceName","nominalValue"]};t.RDFNode.prototype.equals=function(a){if(a.interfaceName==null)return this.valueOf()==a;else{for(var b in this.attributes){var e=this.attributes[b];if(this[e]!=a[e])return!1}return!0}};t.BlankNode=function(a){t.RDFNode.call(this,"BlankNode");
this.nominalValue="_:"+a;this.bnodeId=a};v["extends"](t.RDFNode,t.BlankNode);t.BlankNode.prototype.toString=function(){return this.nominalValue};t.BlankNode.prototype.toNT=function(){return this.nominalValue};t.BlankNode.prototype.valueOf=function(){return this.nominalValue};t.Literal=function(a,b,e){t.RDFNode.call(this,"Literal");this.nominalValue=a;if(b!=null)this.language=b;else if(e!=null)this.datatype=e};v["extends"](t.RDFNode,t.Literal);t.Literal.prototype.toString=function(){var a='"'+this.nominalValue+
'"';if(this.language!=null)a=a+"@"+this.language;else if(this.datatype!=null||this.type)a=a+"^^<"+(this.datatype||this.type)+">";return a};t.Literal.prototype.toNT=function(){return this.toString()};t.Literal.prototype.valueOf=function(){return i.effectiveTypeValue({token:"literal",type:this.type||this.datatype,value:this.nominalValue,language:this.language})};t.NamedNode=function(a){t.RDFNode.call(this,"NamedNode");this.nominalValue=a.value!=null?a.value:a};v["extends"](t.RDFNode,t.NamedNode);t.NamedNode.prototype.toString=
function(){return this.nominalValue};t.NamedNode.prototype.toNT=function(){return"<"+this.toString()+">"};t.NamedNode.prototype.valueOf=function(){return this.nominalValue};t.Triple=function(a,b,e){this.subject=a;this.predicate=b;this.object=e};t.Triple.prototype.equals=function(a){return this.subject.equals(a.subject)&&this.predicate.equals(a.predicate)&&this.object.equals(a.object)};t.Triple.prototype.toString=function(){return this.subject.toNT()+" "+this.predicate.toNT()+" "+this.object.toNT()+
" . \r\n"};t.Graph=function(){this.triples=[];this.duplicates={};this.actions=[];this.length=0};t.Graph.prototype.add=function(a){for(var b=0;b<this.actions.length;b++)a=this.actions[b](a);b=a.subject.toString()+a.predicate.toString()+a.object.toString();this.duplicates[b]||(this.duplicates[b]=!0,this.triples.push(a));this.length=this.triples.length;return this};t.Graph.prototype.addAction=function(a,b){this.actions.push(a);if(b==!0)for(var e=0;e<this.triples.length;e++)this.triples[e]=a(this.triples[e]);
return this};t.Graph.prototype.addAll=function(a){for(var a=a.toArray(),b=0;b<a.length;b++)this.add(a[b]);this.length=this.triples.length;return this};t.Graph.prototype.remove=function(a){for(var b=null,e=0;e<this.triples.length;e++)if(this.triples[e].equals(a)){delete this.duplicates[a.subject.toString()+a.predicate.toString()+a.object.toString()];b=e;break}b!=null&&this.triples.splice(b,1);this.length=this.triples.length;return this};t.Graph.prototype.toArray=function(){return this.triples};t.Graph.prototype.some=
function(a){for(var b=0;b<this.triples.length;b++)if(a(this.triples[b],this)===!0)return!0;return!1};t.Graph.prototype.every=function(a){for(var b=0;b<this.triples.length;b++)if(a(this.triples[b],this)===!1)return!1;return!0};t.Graph.prototype.filter=function(a){for(var b=new t.Graph,e=0;e<this.triples.length;e++)a(this.triples[e],this)===!0&&b.add(this.triples[e]);return b};t.Graph.prototype.forEach=function(a){for(var b=0;b<this.triples.length;b++)a(this.triples[b],this)};t.Graph.prototype.merge=
function(){for(var a=new t.Graph,b=0;b<this.triples.length;b++)a.add(this.triples[b]);return a};t.Graph.prototype.match=function(a,b,e,c){for(var h=new t.Graph,f=0,g=0;g<this.triples.length;g++){var i=this.triples[g];if(a==null||i.subject.equals(a))if(b==null||i.predicate.equals(b))if(e==null||i.object.equals(e))if(c==null||f<c)f++,h.add(i);else break}return h};t.Graph.prototype.removeMatches=function(a,b,e){for(var c=[],h=0;h<this.triples.length;h++){var f=this.triples[h];if(a==null||f.subject.equals(a))if(b==
null||f.predicate.equals(b))(e==null||f.object.equals(e))&&c.push(f)}for(h=0;h<c.length;h++)this.remove(c[h]);return this};t.Graph.prototype.toNT=function(){var a="";this.forEach(function(b){a+=b.toString()});return a};t.buildRDFResource=function(a,b,e,c){return a.token==="blank"?t.buildBlankNode(a,b,e,c):a.token==="literal"?t.buildLiteral(a,b,e,c):a.token==="uri"?t.buildNamedNode(a,b,e,c):a.token==="var"?(a=b[a.value],a!=null?t.buildRDFResource(a,b,e,c):null):null};t.buildBlankNode=function(a){if(a.valuetmp!=
null)a.value=a.valuetmp;if(a.value.indexOf("_:")===0)a.value=a.value.split("_:")[1];return new t.BlankNode(a.value)};t.buildLiteral=function(a){return new t.Literal(a.value,a.lang,a.type)};t.buildNamedNode=function(a,b,e,c){if(a.value==null&&a.prefix!=null)b=e.resolveNsInEnvironment(a.prefix,c),a.value=b+a.suffix;return new t.NamedNode(a)};t.rdf=new t.RDFEnvironment;var i={checkFilters:function(a,b,e,c,h,f){var g=a.filter,n=[];if(g==null||a.length!=null)return b;for(a=0;a<g.length;a++){for(var b=
i.run(g[a].value,b,e,c,h,f),r=[],s=0;s<b.length;s++)b[s].__nullify__!=null?n.push(b[s]):r.push(b[s]);b=r}return b.concat(n)}};i.boundVars=function(a){if(a.expressionType!=null){var b=a.expressionType;if(b=="relationalexpression")return b=a.op2,i.boundVars(a.op1)+i.boundVars(b);else if(b=="conditionalor"||b=="conditionaland"){for(var e=[],b=0;b<a.operands;b++)e=e.concat(i.boundVars(a.operands[b]));return e}else if(b=="builtincall")if(a.args==null)return[];else{e=[];for(b=0;b<a.args.length;b++)e=e.concat(i.boundVars(a.args[b]));
return e}else if(b=="multiplicativeexpression"){e=i.boundVars(a.factor);for(b=0;b<a.factors.length;b++)e=e.concat(i.boundVars(a.factors[b].expression));return e}else if(b=="additiveexpression"){e=i.boundVars(a.summand);for(b=0;b<a.summands.length;b++)e=e.concat(i.boundVars(a.summands[b].expression));return e}else if(b=="regex")return e=i.boundVars(a.expression1),e.concat(i.boundVars(a.expression2));else if(b=="unaryexpression")return i.boundVars(a.expression);else if(b=="atomic")return a.primaryexpression==
"var"?[a.value]:[]}else throw console.log("ERROR"),console.log(a),"Cannot find bound expressions in a no expression token";};i.run=function(a,b,e,c,h,f){for(var g=f.copyDenormalizedBindings(b,h.outCache),n=[],r=0;r<b.length;r++){var s=i.runFilter(a,g[r],f,c,h),s=i.ebv(s);i.isEbvError(s)?e&&(s={__nullify__:!0,bindings:b[r]},n.push(s)):s===!0?n.push(b[r]):e&&(s={__nullify__:!0,bindings:b[r]},n.push(s))}return n};i.collect=function(a,b,e,c,h){for(var f=h.copyDenormalizedBindings(b,c.outCache),g=[],n=
0;n<f.length;n++){var r=i.runFilter(a,f[n],h,e,c);g.push({binding:b[n],value:r})}return g};i.runDistinct=function(){};i.runAggregator=function(a,b,e,c,h){if(b==null||b.length===0)return i.ebvError();else if(a.token==="variable"&&a.kind=="var")return b[0][a.value.value];else if(a.token==="variable"&&a.kind==="aliased")if(a.expression.expressionType==="atomic"&&a.expression.primaryexpression==="var")return b[0][a.expression.value.value];else if(a.expression.expressionType==="aggregate")if(a.expression.aggregateType===
"max"){for(var f=null,g=0;g<b.length;g++){var n=b[g],n=i.runFilter(a.expression.expression,n,e,c,h);i.isEbvError(n)||(f===null?f=n:i.runLtFunction(f,n).value===!0&&(f=n))}return f===null?i.ebvError():f}else if(a.expression.aggregateType==="min"){f=null;for(g=0;g<b.length;g++)n=b[g],n=i.runFilter(a.expression.expression,n,e,c,h),i.isEbvError(n)||(f===null?f=n:i.runGtFunction(f,n).value===!0&&(f=n));return f===null?i.ebvError():f}else if(a.expression.aggregateType==="count"){var f={},r=0;if(a.expression.expression===
"*")if(a.expression.distinct!=null&&a.expression.distinct!="")for(g=0;g<b.length;g++){var n=b[g],s=v.hashTerm(n);f[s]==null&&(f[s]=!0,r++)}else r=b.length;else for(g=0;g<b.length;g++)n=b[g],n=i.runFilter(a.expression.expression,n,e,c,h),i.isEbvError(n)||(a.expression.distinct!=null&&a.expression.distinct!=""?(s=v.hashTerm(n),f[s]==null&&(f[s]=!0,r++)):r++);return{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:""+r}}else if(a.expression.aggregateType==="avg"){for(var f={},m=
{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:"0"},g=r=0;g<b.length;g++)n=b[g],n=i.runFilter(a.expression.expression,n,e,c,h),i.isEbvError(n)||(a.expression.distinct!=null&&a.expression.distinct!=""?(s=v.hashTerm(n),f[s]==null&&(f[s]=!0,i.isNumeric(n)&&(m=i.runSumFunction(m,n),r++))):i.isNumeric(n)&&(m=i.runSumFunction(m,n),r++));a=i.runDivFunction(m,{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:""+r});a.value=""+a.value;return a}else if(a.expression.aggregateType===
"sum"){f={};m={token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:"0"};for(g=0;g<b.length;g++)n=b[g],n=i.runFilter(a.expression.expression,n,e,c,h),i.isEbvError(n)||(a.expression.distinct!=null&&a.expression.distinct!=""?(s=v.hashTerm(n),f[s]==null&&(f[s]=!0,i.isNumeric(n)&&(m=i.runSumFunction(m,n)))):i.isNumeric(n)&&(m=i.runSumFunction(m,n)));m.value=""+m.value;return m}else return n=i.runFilter(aggregate.expression,b[0],c,{blanks:{},outCache:{}})};i.runFilter=function(a,b,e,c,
h){if(a.expressionType!=null){var f=a.expressionType;if(f=="relationalexpression"){var f=i.runFilter(a.op1,b,e,c,h),g=i.runFilter(a.op2,b,e,c,h);return i.runRelationalFilter(a,f,g,b,e,c,h)}else if(f=="conditionalor")return i.runOrFunction(a,b,e,c,h);else if(f=="conditionaland")return i.runAndFunction(a,b,e,c,h);else if(f=="additiveexpression")return i.runAddition(a.summand,a.summands,b,e,c,h);else if(f=="builtincall")return i.runBuiltInCall(a.builtincall,a.args,b,e,c,h);else if(f=="multiplicativeexpression")return i.runMultiplication(a.factor,
a.factors,b,e,c,h);else if(f=="unaryexpression")return i.runUnaryExpression(a.unaryexpression,a.expression,b,e,c,h);else if(f=="irireforfunction")return i.runIriRefOrFunction(a.iriref,a.args,b,e,c,h);else if(f=="regex")return i.runRegex(a.text,a.pattern,a.flags,b,e,c,h);else if(f=="custom")return i.runBuiltInCall(a.name,a.args,b,e,c,h);else if(f=="atomic")if(a.primaryexpression=="var")return b[a.value.value];else{if(typeof a.value=="object"&&!(a.value.type==null||typeof a.value.type!="object"))a.value.type=
v.lexicalFormBaseUri(a.value.type,h);return a.value}else throw"Unknown filter expression type";}else throw"Cannot find bound expressions in a no expression token";};i.isRDFTerm=function(a){return a==null?!1:a.token&&a.token=="literal"||a.token&&a.token=="uri"||a.token&&a.token=="blank"?!0:!1};i.RDFTermEquality=function(a,b,e,c){return a.token==="literal"&&b.token==="literal"?a.lang==b.lang&&a.type==b.type&&a.value==b.value?!0:a.type!=null&&b.type!=null?i.ebvError():i.isSimpleLiteral(a)&&b.type!=null?
i.ebvError():i.isSimpleLiteral(b)&&a.type!=null?i.ebvError():!1:a.token==="uri"&&b.token==="uri"?v.lexicalFormBaseUri(a,c)==v.lexicalFormBaseUri(b,c):a.token==="blank"&&b.token==="blank"?a.value==b.value:!1};i.isInteger=function(a){return a==null?!1:a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#integer"||a.type=="http://www.w3.org/2001/XMLSchema#decimal"||a.type=="http://www.w3.org/2001/XMLSchema#double"||a.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||a.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||
a.type=="http://www.w3.org/2001/XMLSchema#long"||a.type=="http://www.w3.org/2001/XMLSchema#int"||a.type=="http://www.w3.org/2001/XMLSchema#short"||a.type=="http://www.w3.org/2001/XMLSchema#byte"||a.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedShort"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||a.type=="http://www.w3.org/2001/XMLSchema#positiveInteger"?
!0:!1:!1};i.isFloat=function(a){return a==null?!1:a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#float"?!0:!1:!1};i.isDecimal=function(a){return a==null?!1:a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#decimal"?!0:!1:!1};i.isDouble=function(a){return a==null?!1:a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#double"?!0:!1:!1};i.isNumeric=function(a){return a==null?!1:a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#integer"||a.type=="http://www.w3.org/2001/XMLSchema#decimal"||
a.type=="http://www.w3.org/2001/XMLSchema#float"||a.type=="http://www.w3.org/2001/XMLSchema#double"||a.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||a.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#long"||a.type=="http://www.w3.org/2001/XMLSchema#int"||a.type=="http://www.w3.org/2001/XMLSchema#short"||a.type=="http://www.w3.org/2001/XMLSchema#byte"||a.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||
a.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedShort"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||a.type=="http://www.w3.org/2001/XMLSchema#positiveInteger"?!0:!1:!1};i.isSimpleLiteral=function(a){return a&&a.token=="literal"?a.type==null&&a.lang==null?!0:!1:!1};i.isXsdType=function(a,b){return b&&b.token=="literal"?b.type=="http://www.w3.org/2001/XMLSchema#"+a:!1};i.ebv=function(a){if(a==null||i.isEbvError(a))return i.ebvError();
else if(a.token&&a.token==="literal")if(a.type=="http://www.w3.org/2001/XMLSchema#integer"||a.type=="http://www.w3.org/2001/XMLSchema#decimal"||a.type=="http://www.w3.org/2001/XMLSchema#double"||a.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||a.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#long"||a.type=="http://www.w3.org/2001/XMLSchema#int"||a.type=="http://www.w3.org/2001/XMLSchema#short"||a.type=="http://www.w3.org/2001/XMLSchema#byte"||
a.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedShort"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||a.type=="http://www.w3.org/2001/XMLSchema#positiveInteger"){var b=parseFloat(a.value);return isNaN(b)?!1:parseFloat(a.value)!=0}else return a.type==="http://www.w3.org/2001/XMLSchema#boolean"?a.value==="true"||
a.value===!0||a.value==="True":a.type==="http://www.w3.org/2001/XMLSchema#string"?a.value!="":a.type==="http://www.w3.org/2001/XMLSchema#dateTime"?new Date(a.value)!=null:i.isEbvError(a)?a:a.type==null?a.value!=""?!0:!1:i.ebvError();else return a.value===!0};i.effectiveBooleanValue=i.ebv;i.ebvTrue=function(){return{token:"literal",type:"http://www.w3.org/2001/XMLSchema#boolean",value:!0}};i.ebvFalse=function(){return{token:"literal",type:"http://www.w3.org/2001/XMLSchema#boolean",value:!1}};i.ebvError=
function(){return{token:"literal",type:"https://github.com/antoniogarrote/js-tools/types#error",value:null}};i.isEbvError=function(a){return typeof a=="object"&&a!=null?a.type==="https://github.com/antoniogarrote/js-tools/types#error":!1};i.ebvBoolean=function(a){return i.isEbvError(a)?a:a===!0?i.ebvTrue():i.ebvFalse()};i.runRelationalFilter=function(a,b,e,c,h,f,g){a=a.operator;if(a==="=")return i.runEqualityFunction(b,e,c,h,f,g);else if(a==="!="){b=i.runEqualityFunction(b,e,c,h,f,g);if(!i.isEbvError(b))b.value=
!b.value;return b}else if(a==="<")return i.runLtFunction(b,e,c);else if(a===">")return i.runGtFunction(b,e,c);else if(a==="<=")return i.runLtEqFunction(b,e,c);else if(a===">=")return i.runGtEqFunction(b,e,c);else throw"Error applying relational filter, unknown operator";};i.effectiveTypeValue=function(a){if(a.token=="literal")if(a.type=="http://www.w3.org/2001/XMLSchema#integer")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#decimal")return a=parseFloat(a.value);else if(a.type==
"http://www.w3.org/2001/XMLSchema#float")return a=parseFloat(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#double")return a=parseFloat(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger")return a=parseFloat(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#negativeInteger")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#long")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#int")return a=parseInt(a.value);
else if(a.type=="http://www.w3.org/2001/XMLSchema#short")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#byte")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#unsignedLong")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#unsignedInt")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#unsignedShort")return a=
parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#unsignedByte")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#positiveInteger")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#date"||a.type=="http://www.w3.org/2001/XMLSchema#dateTime")try{return v.parseISO8601(a.value)}catch(b){return null}else return a.type=="http://www.w3.org/2001/XMLSchema#boolean"?a.value===!0||a.value==="true"||a.value==="1"||a.value===1||a.value===
!0?!0:a.value===!1||a.value==="false"||a.value==="0"||a.value===0||a.value===!1?!1:void 0:a.type=="http://www.w3.org/2001/XMLSchema#string"?a.value===null||a.value===void 0?void 0:""+a.value:a.value;else throw console.log("not implemented yet"),"value not supported in operations yet";};i.runOrFunction=function(a,b,e,c,h){for(var f=null,g=0;g<a.operands.length;g++){var n=i.runFilter(a.operands[g],b,e,c,h);i.isEbvError(n)==!1&&(n=i.ebv(n));f==null?f=n:i.isEbvError(n)?f=i.isEbvError(f)?i.ebvError():
f===!0?!0:i.ebvError():n===!0?f=!0:i.isEbvError(f)&&(f=i.ebvError())}return i.ebvBoolean(f)};i.runAndFunction=function(a,b,e,c,h){for(var f=null,g=0;g<a.operands.length;g++){var n=i.runFilter(a.operands[g],b,e,c,h);i.isEbvError(n)==!1&&(n=i.ebv(n));f==null?f=n:i.isEbvError(n)?f=i.isEbvError(f)?i.ebvError():f===!0?i.ebvError():!1:n===!0?i.isEbvError(f)&&(f=i.ebvError()):f=!1}return i.ebvBoolean(f)};i.runEqualityFunction=function(a,b,e,c,h,f){if(i.isEbvError(a)||i.isEbvError(b))return i.ebvError();
if(i.isNumeric(a)&&i.isNumeric(b))return e=i.effectiveTypeValue(a),h=i.effectiveTypeValue(b),isNaN(e)||isNaN(h)?i.ebvBoolean(i.RDFTermEquality(a,b,c,f)):i.ebvBoolean(e==h);else if((i.isSimpleLiteral(a)||i.isXsdType("string",a))&&(i.isSimpleLiteral(b)||i.isXsdType("string",b)))return i.ebvBoolean(i.effectiveTypeValue(a)==i.effectiveTypeValue(b));else if(i.isXsdType("boolean",a)&&i.isXsdType("boolean",b))return i.ebvBoolean(i.effectiveTypeValue(a)==i.effectiveTypeValue(b));else if((i.isXsdType("dateTime",
a)||i.isXsdType("date",a))&&(i.isXsdType("dateTime",b)||i.isXsdType("date",b))){if(i.isXsdType("dateTime",a)&&i.isXsdType("date",b))return i.ebvFalse();if(i.isXsdType("date",a)&&i.isXsdType("dateTime",b))return i.ebvFalse();a=v.compareDateComponents(a.value,b.value);return a!=null?a==0?i.ebvTrue():i.ebvFalse():i.ebvError()}else return i.isRDFTerm(a)&&i.isRDFTerm(b)?i.ebvBoolean(i.RDFTermEquality(a,b,c,f)):i.ebvFalse()};i.runGtFunction=function(a,b){if(i.isEbvError(a)||i.isEbvError(b))return i.ebvError();
if(i.isNumeric(a)&&i.isNumeric(b))return i.ebvBoolean(i.effectiveTypeValue(a)>i.effectiveTypeValue(b));else if(i.isSimpleLiteral(a)&&i.isSimpleLiteral(b))return i.ebvBoolean(i.effectiveTypeValue(a)>i.effectiveTypeValue(b));else if(i.isXsdType("string",a)&&i.isXsdType("string",b))return i.ebvBoolean(i.effectiveTypeValue(a)>i.effectiveTypeValue(b));else if(i.isXsdType("boolean",a)&&i.isXsdType("boolean",b))return i.ebvBoolean(i.effectiveTypeValue(a)>i.effectiveTypeValue(b));else if((i.isXsdType("dateTime",
a)||i.isXsdType("date",a))&&(i.isXsdType("dateTime",b)||i.isXsdType("date",b))){if(i.isXsdType("dateTime",a)&&i.isXsdType("date",b))return i.ebvFalse();if(i.isXsdType("date",a)&&i.isXsdType("dateTime",b))return i.ebvFalse();var e=v.compareDateComponents(a.value,b.value);return e!=null?e==1?i.ebvTrue():i.ebvFalse():i.ebvError()}else return i.ebvFalse()};i.runTotalGtFunction=function(a,b){return i.isEbvError(a)||i.isEbvError(b)?i.ebvError():i.isNumeric(a)&&i.isNumeric(b)||i.isSimpleLiteral(a)&&i.isSimpleLiteral(b)||
i.isXsdType("string",a)&&i.isSimpleLiteral("string",b)||i.isXsdType("boolean",a)&&i.isSimpleLiteral("boolean",b)||i.isXsdType("dateTime",a)&&i.isSimpleLiteral("dateTime",b)?i.runGtFunction(a,b,[]):a.token&&a.token==="uri"&&b.token&&b.token==="uri"?i.ebvBoolean(a.value>b.value):a.token&&a.token==="literal"&&b.token&&b.token==="literal"?i.ebvBoolean(""+a.value+a.type+a.lang>""+b.value+b.type+b.lang):a.token&&a.token==="blank"&&b.token&&b.token==="blank"?i.ebvBoolean(a.value>b.value):a.value&&b.value?
i.ebvBoolean(a.value>b.value):i.ebvTrue()};i.runLtFunction=function(a,b){if(i.isEbvError(a)||i.isEbvError(b))return i.ebvError();if(i.isNumeric(a)&&i.isNumeric(b))return i.ebvBoolean(i.effectiveTypeValue(a)<i.effectiveTypeValue(b));else if(i.isSimpleLiteral(a)&&i.isSimpleLiteral(b))return i.ebvBoolean(i.effectiveTypeValue(a)<i.effectiveTypeValue(b));else if(i.isXsdType("string",a)&&i.isXsdType("string",b))return i.ebvBoolean(i.effectiveTypeValue(a)<i.effectiveTypeValue(b));else if(i.isXsdType("boolean",
a)&&i.isXsdType("boolean",b))return i.ebvBoolean(i.effectiveTypeValue(a)<i.effectiveTypeValue(b));else if((i.isXsdType("dateTime",a)||i.isXsdType("date",a))&&(i.isXsdType("dateTime",b)||i.isXsdType("date",b))){if(i.isXsdType("dateTime",a)&&i.isXsdType("date",b))return i.ebvFalse();if(i.isXsdType("date",a)&&i.isXsdType("dateTime",b))return i.ebvFalse();var e=v.compareDateComponents(a.value,b.value);return e!=null?e==-1?i.ebvTrue():i.ebvFalse():i.ebvError()}else return i.ebvFalse()};i.runGtEqFunction=
function(a,b){if(i.isEbvError(a)||i.isEbvError(b))return i.ebvError();if(i.isNumeric(a)&&i.isNumeric(b))return i.ebvBoolean(i.effectiveTypeValue(a)>=i.effectiveTypeValue(b));else if(i.isSimpleLiteral(a)&&i.isSimpleLiteral(b))return i.ebvBoolean(i.effectiveTypeValue(a)>=i.effectiveTypeValue(b));else if(i.isXsdType("string",a)&&i.isXsdType("string",b))return i.ebvBoolean(i.effectiveTypeValue(a)>=i.effectiveTypeValue(b));else if(i.isXsdType("boolean",a)&&i.isXsdType("boolean",b))return i.ebvBoolean(i.effectiveTypeValue(a)>=
i.effectiveTypeValue(b));else if((i.isXsdType("dateTime",a)||i.isXsdType("date",a))&&(i.isXsdType("dateTime",b)||i.isXsdType("date",b))){if(i.isXsdType("dateTime",a)&&i.isXsdType("date",b))return i.ebvFalse();if(i.isXsdType("date",a)&&i.isXsdType("dateTime",b))return i.ebvFalse();var e=v.compareDateComponents(a.value,b.value);return e!=null?e!=-1?i.ebvTrue():i.ebvFalse():i.ebvError()}else return i.ebvFalse()};i.runLtEqFunction=function(a,b){if(i.isEbvError(a)||i.isEbvError(b))return i.ebvError();
if(i.isNumeric(a)&&i.isNumeric(b))return i.ebvBoolean(i.effectiveTypeValue(a)<=i.effectiveTypeValue(b));else if(i.isSimpleLiteral(a)&&i.isSimpleLiteral(b))return i.ebvBoolean(i.effectiveTypeValue(a)<=i.effectiveTypeValue(b));else if(i.isXsdType("string",a)&&i.isXsdType("string",b))return i.ebvBoolean(i.effectiveTypeValue(a)<=i.effectiveTypeValue(b));else if(i.isXsdType("boolean",a)&&i.isXsdType("boolean",b))return i.ebvBoolean(i.effectiveTypeValue(a)<=i.effectiveTypeValue(b));else if((i.isXsdType("dateTime",
a)||i.isXsdType("date",a))&&(i.isXsdType("dateTime",b)||i.isXsdType("date",b))){if(i.isXsdType("dateTime",a)&&i.isXsdType("date",b))return i.ebvFalse();if(i.isXsdType("date",a)&&i.isXsdType("dateTime",b))return i.ebvFalse();var e=v.compareDateComponents(a.value,b.value);return e!=null?e!=1?i.ebvTrue():i.ebvFalse():i.ebvError()}else return i.ebvFalse()};i.runAddition=function(a,b,e,c,h,f){var g=i.runFilter(a,e,c,h,f);if(i.isEbvError(g))return i.ebvError();a=g;if(i.isNumeric(g)){for(g=0;g<b.length;g++){var n=
i.runFilter(b[g].expression,e,c,h,f);if(i.isNumeric(n))b[g].operator==="+"?a=i.runSumFunction(a,n):b[g].operator==="-"&&(a=i.runSubFunction(a,n));else return i.ebvFalse()}return a}else return i.ebvFalse()};i.runSumFunction=function(a,b){if(i.isEbvError(a)||i.isEbvError(b))return i.ebvError();var e=i.effectiveTypeValue(a)+i.effectiveTypeValue(b);return i.isDouble(a)||i.isDouble(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:e}:i.isFloat(a)||i.isFloat(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",
value:e}:i.isDecimal(a)||i.isDecimal(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:e}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:e}};i.runSubFunction=function(a,b){if(i.isEbvError(a)||i.isEbvError(b))return i.ebvError();var e=i.effectiveTypeValue(a)-i.effectiveTypeValue(b);return i.isDouble(a)||i.isDouble(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:e}:i.isFloat(a)||i.isFloat(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",
value:e}:i.isDecimal(a)||i.isDecimal(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:e}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:e}};i.runMultiplication=function(a,b,e,c,h,f){a=i.runFilter(a,e,c,h,f);if(i.isEbvError(a))return a;var g=a;if(i.isNumeric(a)){for(var n=0;n<b.length;n++){var r=i.runFilter(b[n].expression,e,c,h,f);if(i.isEbvError(r))return a;if(i.isNumeric(r))b[n].operator==="*"?g=i.runMulFunction(g,r):b[n].operator==="/"&&(g=i.runDivFunction(g,
r));else return i.ebvFalse()}return g}else return i.ebvFalse()};i.runMulFunction=function(a,b){if(i.isEbvError(a)||i.isEbvError(b))return i.ebvError();var e=i.effectiveTypeValue(a)*i.effectiveTypeValue(b);return i.isDouble(a)||i.isDouble(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:e}:i.isFloat(a)||i.isFloat(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:e}:i.isDecimal(a)||i.isDecimal(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",
value:e}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:e}};i.runDivFunction=function(a,b){if(i.isEbvError(a)||i.isEbvError(b))return i.ebvError();var e=i.effectiveTypeValue(a)/i.effectiveTypeValue(b);return i.isDouble(a)||i.isDouble(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:e}:i.isFloat(a)||i.isFloat(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:e}:i.isDecimal(a)||i.isDecimal(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",
value:e}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:e}};i.runBuiltInCall=function(a,b,e,c,h,f){if(a==="notexists"||a==="exists"){var g=JSON.parse(JSON.stringify(b[0])),g=c.abstractQueryTree.parseSelect({pattern:g},e),g=c.abstractQueryTree.bind(g.pattern,e),e=c.executeSelectUnit([{kind:"*"}],h,g,f);return a==="exists"?i.ebvBoolean(e.length!==0):i.ebvBoolean(e.length===0)}else{for(var g=[],n=0;n<b.length;n++)if(b[n].token==="var")g.push(b[n]);else{var r=i.runFilter(b[n],
e,c,h,f);if(i.isEbvError(r))return r;g.push(r)}if(a==="str")return g[0].token==="literal"?{token:"literal",type:null,value:""+g[0].value}:g[0].token==="uri"?{token:"literal",type:null,value:g[0].value}:i.ebvFalse();else if(a==="lang")return g[0].token==="literal"?g[0].lang!=null?{token:"literal",value:""+g[0].lang}:{token:"literal",value:""}:i.ebvError();else if(a==="datatype")return g[0].token==="literal"?(a=g[0],a.type!=null?typeof a.type==="string"?{token:"uri",value:a.type,prefix:null,suffix:null}:
a.type:a.lang==null?{token:"uri",value:"http://www.w3.org/2001/XMLSchema#string",prefix:null,suffix:null}:i.ebvError()):i.ebvError();else if(a==="isliteral")return g[0].token==="literal"?i.ebvTrue():i.ebvFalse();else if(a==="isblank")return g[0].token==="blank"?i.ebvTrue():i.ebvFalse();else if(a==="isuri"||a==="isiri")return g[0].token==="uri"?i.ebvTrue():i.ebvFalse();else if(a==="sameterm")return a=i.RDFTermEquality(g[0],g[1],c,f),i.isEbvError(a)&&(a=!1),i.ebvBoolean(a);else if(a==="langmatches")return a=
g[0],e=g[1],a.token==="literal"&&e.token==="literal"?e.value==="*"&&a.value!=""?i.ebvTrue():i.ebvBoolean(a.value.toLowerCase().indexOf(e.value.toLowerCase())===0):i.ebvError();else if(a==="bound")return a=g[0].value,a==null?i.ebvError():e[a]!=null?i.ebvTrue():i.ebvFalse();else if(c.customFns[a]!=null)return c.customFns[a](i,g);else throw"Builtin call "+a+" not implemented yet";}};i.runUnaryExpression=function(a,b,e,c,h,f){b=i.runFilter(b,e,c,h,f);if(i.isEbvError(b))return b;if(a==="!"){var g=i.ebv(b);
return i.isEbvError(g)?i.ebvFalse():i.ebvBoolean(!g)}else if(a==="+")return i.isNumeric(b)?b:i.ebvError();else if(a==="-")if(i.isNumeric(b)){a={};for(g in b)a[g]=b[g];a.value=-a.value;return a}else return i.ebvError()};i.runRegex=function(a,b,e,c,h,f,g){if(a!=null)a=i.runFilter(a,c,h,f,g);else return i.ebvError();if(b!=null)b=i.runFilter(b,c,h,f,g);else return i.ebvError();e!=null&&(e=i.runFilter(e,c,h,f,g));if(b!=null&&b.token==="literal"&&(e==null||e.token==="literal"))b=b.value,e=e==null?null:
e.value;else return i.ebvError();if(a!=null&&a.token=="var")if(c[a.value]!=null)a=c[a.value];else return i.ebvError();else if(a!=null&&a.token==="literal")if(a.type==null||i.isXsdType("string",a))a=a.value;else return i.ebvError();else return i.ebvError();return(e==null?RegExp(b):RegExp(b,e.toLowerCase())).exec(a)?i.ebvTrue():i.ebvFalse()};i.normalizeLiteralDatatype=function(a,b,e){if(!(a.value.type==null||typeof a.value.type!="object"))a.value.type=v.lexicalFormBaseUri(a.value.type,e);return a};
i.runIriRefOrFunction=function(a,b,e,c,h,f){if(b==null)return a;else{for(var g=[],n=0;n<b.length;n++)g.push(i.runFilter(b[n],e,c,h,f));a=v.lexicalFormBaseUri(a,f);if(a=="http://www.w3.org/2001/XMLSchema#integer"||a=="http://www.w3.org/2001/XMLSchema#decimal"||a=="http://www.w3.org/2001/XMLSchema#double"||a=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||a=="http://www.w3.org/2001/XMLSchema#negativeInteger"||a=="http://www.w3.org/2001/XMLSchema#long"||a=="http://www.w3.org/2001/XMLSchema#int"||
a=="http://www.w3.org/2001/XMLSchema#short"||a=="http://www.w3.org/2001/XMLSchema#byte"||a=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||a=="http://www.w3.org/2001/XMLSchema#unsignedLong"||a=="http://www.w3.org/2001/XMLSchema#unsignedInt"||a=="http://www.w3.org/2001/XMLSchema#unsignedShort"||a=="http://www.w3.org/2001/XMLSchema#unsignedByte"||a=="http://www.w3.org/2001/XMLSchema#positiveInteger")if(g=g[0],g.token==="literal")if(g=i.normalizeLiteralDatatype(g,c,f),g.type=="http://www.w3.org/2001/XMLSchema#integer"||
g.type=="http://www.w3.org/2001/XMLSchema#decimal"||g.type=="http://www.w3.org/2001/XMLSchema#double"||g.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||g.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||g.type=="http://www.w3.org/2001/XMLSchema#long"||g.type=="http://www.w3.org/2001/XMLSchema#int"||g.type=="http://www.w3.org/2001/XMLSchema#short"||g.type=="http://www.w3.org/2001/XMLSchema#byte"||g.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||g.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||
g.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||g.type=="http://www.w3.org/2001/XMLSchema#unsignedShort"||g.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||g.type=="http://www.w3.org/2001/XMLSchema#positiveInteger")return g.type=a,g;else if(g.type=="http://www.w3.org/2001/XMLSchema#boolean")return i.ebv(g)==!0?(g.type=a,g.value=1):(g.type=a,g.value=0),g;else if(g.type=="http://www.w3.org/2001/XMLSchema#float"||g.type=="http://www.w3.org/2001/XMLSchema#double")return g.type=a,g.value=
parseInt(g.value),g;else if(g.type=="http://www.w3.org/2001/XMLSchema#string"||g.type==null){if(g.value.split(".").length>2)return i.ebvError();else if(g.value.split("-").length>2)return i.ebvError();else if(g.value.split("/").length>2)return i.ebvError();else if(g.value.split("+").length>2)return i.ebvError();if(a=="http://www.w3.org/2001/XMLSchema#decimal"&&(g.value.indexOf("e")!=-1||g.value.indexOf("E")!=-1))return i.ebvError();if(a=="http://www.w3.org/2001/XMLSchema#int"||a=="http://www.w3.org/2001/XMLSchema#integer")if(g.value.indexOf("e")!=
-1||g.value.indexOf("E")!=-1||g.value.indexOf(".")!=-1)return i.ebvError();try{return g.value=parseInt(parseFloat(g.value)),isNaN(g.value)?i.ebvError():(g.type=a,g)}catch(r){return i.ebvError()}}else return i.ebvError();else return i.ebvError();else if(a=="http://www.w3.org/2001/XMLSchema#boolean")return g=g[0],g.token==="literal"&&g.type==null?g.value==="true"||g.value==="1"?i.ebvTrue():g.value==="false"||g.value==="0"?i.ebvFalse():i.ebvError():g.token==="literal"?i.isEbvError(g)?g:i.ebvBoolean(g):
i.ebvError();else if(a=="http://www.w3.org/2001/XMLSchema#string")if(g=g[0],g.token==="literal")if(g=i.normalizeLiteralDatatype(g,c,f),g.type=="http://www.w3.org/2001/XMLSchema#integer"||g.type=="http://www.w3.org/2001/XMLSchema#decimal"||g.type=="http://www.w3.org/2001/XMLSchema#double"||g.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||g.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||g.type=="http://www.w3.org/2001/XMLSchema#long"||g.type=="http://www.w3.org/2001/XMLSchema#int"||
g.type=="http://www.w3.org/2001/XMLSchema#short"||g.type=="http://www.w3.org/2001/XMLSchema#byte"||g.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||g.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||g.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||g.type=="http://www.w3.org/2001/XMLSchema#unsignedShort"||g.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||g.type=="http://www.w3.org/2001/XMLSchema#positiveInteger"||g.type=="http://www.w3.org/2001/XMLSchema#float")return g.type=
a,g.value=""+g.value,g;else if(g.type=="http://www.w3.org/2001/XMLSchema#string")return g;else if(g.type=="http://www.w3.org/2001/XMLSchema#boolean")return i.ebv(g)?(g.type=a,g.value="true"):(g.type=a,g.value="false"),g;else if(g.type=="http://www.w3.org/2001/XMLSchema#dateTime"||g.type=="http://www.w3.org/2001/XMLSchema#date"){g.type=a;if(typeof g.value!="string")g.value=v.iso8601(g.value);return g}else return g.type==null?(g.value=""+g.value,g.type=a,g):i.ebvError();else return g.token==="uri"?
{token:"literal",value:v.lexicalFormBaseUri(g,f),type:a,lang:null}:i.ebvError();else if(a=="http://www.w3.org/2001/XMLSchema#dateTime"||a=="http://www.w3.org/2001/XMLSchema#date")if(g=g[0],g.type=="http://www.w3.org/2001/XMLSchema#dateTime"||g.type=="http://www.w3.org/2001/XMLSchema#date")return g;else if(g.type=="http://www.w3.org/2001/XMLSchema#string"||g.type==null)try{return g.value=v.iso8601(v.parseStrictISO8601(g.value)),g.type=a,g}catch(s){return i.ebvError()}else return i.ebvError();else if(a==
"http://www.w3.org/2001/XMLSchema#float")if(g=g[0],g.token==="literal")if(g=i.normalizeLiteralDatatype(g,c,f),g.type=="http://www.w3.org/2001/XMLSchema#decimal"||g.type=="http://www.w3.org/2001/XMLSchema#int")return g.type=a,g.value=parseFloat(g.value),g;else if(g.type=="http://www.w3.org/2001/XMLSchema#boolean")return i.ebv(g)==!0?(g.type=a,g.value=1):(g.type=a,g.value=0),g;else if(g.type=="http://www.w3.org/2001/XMLSchema#float"||g.type=="http://www.w3.org/2001/XMLSchema#double")return g.type=a,
g.value=parseFloat(g.value),g;else if(g.type=="http://www.w3.org/2001/XMLSchema#string")try{return g.value=parseFloat(g.value),isNaN(g.value)?i.ebvError():(g.type=a,g)}catch(m){return i.ebvError()}else if(g.type==null){if(g.value.split(".").length>2)return i.ebvError();else if(g.value.split("-").length>2)return i.ebvError();else if(g.value.split("/").length>2)return i.ebvError();else if(g.value.split("+").length>2)return i.ebvError();try{return g.value=parseFloat(g.value),isNaN(g.value)?i.ebvError():
(g.type=a,g)}catch(t){return i.ebvError()}}else return i.ebvError();else return i.ebvError();else return i.ebvError()}};var A={variablesInBGP:function(a){var b=a.variables;if(b)return b;var e=a.value||a,b=[],c;for(c in e)e[c]&&e[c].token==="var"?b.push(e[c].value):e[c]&&e[c].token==="blank"&&b.push("blank:"+e[c].value);return a.variables=b},connected:function(a,b){for(var e="/"+a.vars.join("/")+"/",c=0;c<b.vars.length;c++)if(e.indexOf("/"+b.vars[c]+"/")!=-1)return!0;return!1},variablesIntersectionBGP:function(a,
b){for(var e=A.variablesInBGP(a).sort(),c=A.variablesInBGP(b).sort(),h=0,f=0,g=[];h<e.length&&f<c.length;)e[h]===c[f]?(g.push(e[h]),h++,f++):e[h]<c[f]?h++:f++;return g},executeAndBGPsGroups:function(a){for(var b={},e={},c=0,h=0;h<a.length;h++){var f=a[h],g={},i={},r=[],s;for(s in f)s!="_cost"&&(f[s].token==="var"?r.push(f[s].value):f[s].token==="blank"&&r.push(f[s].value));var m=!1,t={},v;for(v in e){for(var y=e[v],m=!1,A=0;A<r.length;A++)if(y.indexOf("/"+r[A]+"/")!=-1){m=!0;break}m?t[v]=!0:(g[v]=
b[v],i[v]=e[v])}if(m){var m=[],A=y="",k;for(k in t)y+=k,m=m.concat(b[k]),A=e[k];A=A+r.join("/")+"/";m.push(f);g[y]=m;i[y]=A}else g[c]=[f],i[c]="/"+r.join("/")+"/",c++;b=g;e=i}a=[];for(c in b)a.push(b[c]);return a},intersectionSize:function(a,b){for(var e=b.i.split("_"),c=0;c<e.length;c++)if(e[c]!=""&&a.i.indexOf("_"+e[c]+"_")!=-1)return 1;return 0},createJoinTree:function(a,b){for(var e="/"+a.vars.join("/")+"/",c=a.vars.concat([]),h=[],f=0;f<b.vars.length;f++)e.indexOf("/"+b.vars[f]+"/")!=-1?b.vars[f].indexOf("_:")==
0?h.push("blank:"+b.vars[f]):h.push(b.vars[f]):c.push(b.vars[f]);for(var g=b.i.split("_"),i=a.i.split("_"),e={},f=0;f<g.length;f++)g[f]!=""&&(e[g[f]]=!0);for(f=0;f<i.length;f++)i[f]!=""&&(e[i[f]]=!0);var f=[],r;for(r in e)f.push(r);return{left:a,right:b,cost:a.cost+b.cost,i:"_"+f.sort().join("_")+"_",vars:c,join:h}}};A.executeBushyTree=function(a,b,e,c){if(a.left==null)return A.executeEmptyJoinBGP(a.right,b,e,c);else if(a.right==null)return A.executeEmptyJoinBGP(a.left,b,e,c);else{var h=A.executeBushyTree(a.left,
b,e,c);if(h!=null)return b=A.executeBushyTree(a.right,b,e,c),b!=null?A.joinBindings2(a.join,h,b):null}};A.executeAndBGPsDPSize=function(a,b,e,c){for(var h=A.executeAndBGPsGroups(a),a=[],f=0;f<h.length;f++){var g=h[f];e.computeCosts(g,c);var i={},r={},s={},m=1,t=null,v={};s["1"]=[];for(var y=0;y<g.length;y++){var m=[],E;for(E in g[y])E!="_cost"&&(g[y][E].token==="var"?m.push(g[y][E].value):g[y][E].token==="blank"&&m.push(g[y][E].value));r["_"+y+"_"]={left:g[y],right:null,cost:g[y]._cost,i:"_"+y+"_",
vars:m};m={left:g[y],right:null,cost:g[y]._cost,i:"_"+y+"_",vars:m};i["_"+y+"_"]=m;delete g[y]._cost;v["_"+y+"_"]=!0;s["1"].push("_"+y+"_");if(t==null||t.cost>m.cost)t=m}for(var k=2;k<=g.length;k++)for(var o=1;o<k;o++)for(var z=s[""+o]||[],u=s[""+(k-o)]||[],y=0;y<z.length;y++)for(var H=0;H<u.length;H++)if(z[y]!==u[H]){var C=r[z[y]],x=r[u[H]];if(A.intersectionSize(C,x)==0&&A.connected(C,x)&&(m=k,x=A.createJoinTree(i[C.i],i[x.i]),!v[x.i])){v[x.i]=!0;var G=x.cost+1;if(i[x.i]!=null)G=i[x.i].cost;C=s[k]||
[];C.push(x.i);r[x.i]=x;s[k]=C;G>x.cost&&(m===k&&(t=x),i[x.i]=x)}}a.push(t)}C=null;for(f=0;f<a.length;f++)E=A.executeBushyTree(a[f],b,e,c),C=C==null?E:A.crossProductBindings(C,E);return C};A.executeEmptyJoinBGP=function(a,b,e,c){return A.executeBGPDatasets(a,b,e,c)};A.executeBGPDatasets=function(a,b,e,c){var h={};if(a.graph==null){for(var f=[],g=0;g<b.implicit.length;g++)if(h[b.implicit[g].oid]==null){h[b.implicit[g].oid]=!0;a.graph=b.implicit[g];var i=e.rangeQuery(a,c),i=A.buildBindingsFromRange(i,
a);f.push(i)}return a=A.unionManyBindings(f)}else if(a.graph.token==="var"){for(var r=a.graph.value,f=[],g=0;g<b.named.length;g++)if(h[b.named[g].oid]==null)if(h[b.named[g].oid]=!0,a.graph=b.named[g],i=e.rangeQuery(a,c),i!=null){for(var i=A.buildBindingsFromRange(i,a),s=0;s<i.length;s++)i[s][r]=b.named[g].oid;f.push(i)}else return null;return a=A.unionManyBindings(f||[])}else return i=e.rangeQuery(a,c),i!=null?i=A.buildBindingsFromRange(i,a):null};A.buildBindingsFromRange=function(a,b){A.variablesInBGP(b);
var e={},c=b.value||b,e={};for(r in c)c[r]&&c[r].token==="var"?e[r]=c[r].value:c[r]&&c[r].token==="blank"&&(e[r]="blank:"+c[r].value);c=[];if(a!=null)for(var h=0;h<a.length;h++){var f={},g=a[h],i=!1,r;for(r in e){var s=g[r];if(f[e[r]]==null||f[e[r]]===s)f[e[r]]=s;else{i=!0;break}}i||c.push(f)}return c};A.areCompatibleBindings=function(a,b){for(var e in a)if(b[e]!=null&&b[e]!=a[e])return!1;return!0};A.mergeBindings=function(a,b){var e={},c;for(c in a)e[c]=a[c];for(c in b)e[c]=b[c];return e};A.joinBindings2=
function(a,b,e){for(var c={},h,f,g,i,r=[],s=0;s<b.length;s++){h=b[s];i=c;for(var m=0;m<a.length;m++)f=a[m],f=h[f],m==a.length-1?(g=i[f]||[],g.push(h),i[f]=g):(g=i[f]||{},i=i[f]=g)}for(s=0;s<e.length;s++){h=e[s];i=c;for(m=0;m<a.length;m++)if(f=a[m],f=h[f],i[f]!=null)if(m==a.length-1)for(b=0;b<i[f].length;b++)r.push(A.mergeBindings(i[f][b],h));else i=i[f]}return r};A.joinBindings=function(a,b){for(var e=[],c=0;c<a.length;c++)for(var h=a[c],f=0;f<b.length;f++){var g=b[f];A.areCompatibleBindings(h,g)&&
e.push(A.mergeBindings(h,g))}return e};A.augmentMissingBindings=function(a,b){for(var e in b)a[e]==null&&(a[e]=null);return a};A.leftOuterJoinBindings=function(a,b){for(var e=[],c=0;c<a.length;c++){for(var h=a[c],f=!1,g=0;g<b.length;g++){var i=b[g];A.areCompatibleBindings(h,i)&&(f=!0,e.push(A.mergeBindings(h,i)))}f===!1&&(A.augmentMissingBindings(h,i),e.push(h))}return e};A.crossProductBindings=function(a,b){for(var e=[],c=0;c<a.length;c++)for(var h=a[c],f=0;f<b.length;f++)e.push(A.mergeBindings(h,
b[f]));return e};A.unionBindings=function(a,b){return a.concat(b)};A.unionManyBindings=function(a){for(var b=[],e=0;e<a.length;e++)b=A.unionBindings(b,a[e]);return b};var E={},da=A;E.QueryEngine=function(a){if(arguments.length!=0)this.backend=a.backend,this.lexicon=a.lexicon,this.eventsOnBatchLoad=a.eventsOnBatchLoad||!1,this.defaultPrefixes={},this.abstractQueryTree=new L.AbstractQueryTree,this.rdfLoader=new W.RDFLoader(a.communication),this.callbacksBackend=new I.CallbacksBackend(this),this.customFns=
a.customFns||{}};E.QueryEngine.prototype.setCustomFunctions=function(a){this.customFns=a};E.QueryEngine.prototype.registerNsInEnvironment=function(a,b){var e=[];if(a!=null&&a.prefixes!=null)e=a.prefixes;var c={},h;for(h in this.defaultPrefixes)c[h]=this.defaultPrefixes[h];for(h=0;h<e.length;h++){var f=e[h];if(f.token==="prefix")c[f.prefix]=f.local}b.namespaces=c;b.base=a!=null&&a.base&&typeof a.base==="object"?a.base.value:null};E.QueryEngine.prototype.applyModifier=function(a,b){if(a=="DISTINCT"){for(var e=
{},c=[],h=0;h<b.length;h++){var f=b[h],g="",i;for(i in f){var r=f[i];r==null?g=g+i+"null":r.token=="literal"?(r.value!=null&&(g+=r.value),r.lang!=null&&(g+=r.lang),r.type!=null&&(g+=r.type)):g=r.value?g+i+r.value:g+i+r}e[g]==null&&(c.push(f),e[g]=!0)}return c}else return b};E.QueryEngine.prototype.applyLimitOffset=function(a,b,e){if(b==null&&a==null)return e;a==null&&(a=0);b=b==null?e.length:a+b;return e.slice(a,b)};E.QueryEngine.prototype.applySingleOrderBy=function(a,b,e,c){for(var h=[],f=0;f<a.length;f++){var g=
i.collect(a[f].expression,[b],e,c,this);h.push(g[0].value)}return{binding:b,value:h}};E.QueryEngine.prototype.applyOrderBy=function(a,b,e,c){var h=this,f=[];if(a!=null&&a.length>0){for(var g=0;g<b.length;g++){var i=h.applySingleOrderBy(a,b[g],e,c);f.push(i)}f.sort(function(b,e){return h.compareFilteredBindings(b,e,a,c)});b=[];for(g=0;g<f.length;g++)b.push(f[g].binding)}return b};E.QueryEngine.prototype.compareFilteredBindings=function(a,b,e,c){for(var h=0;;){if(h==a.value.length)return 0;var f=e[h].direction;
if(a.value[h]==null&&b.value[h]==null)h++;else{if(a.value[h]==null)a={value:!1};else if(b.value[h]==null)a={value:!0};else if(a.value[h].token==="blank"&&b.value[h].token==="blank"){h++;continue}else if(a.value[h].token==="blank")a={value:!1};else if(b.value[h].token==="blank")a={value:!0};else if(a.value[h].token==="uri"&&b.value[h].token==="uri")if(i.runEqualityFunction(a.value[h],b.value[h],[],this,c).value==!0){h++;continue}else a=i.runTotalGtFunction(a.value[h],b.value[h],[]);else if(a.value[h].token===
"uri")a={value:!1};else if(b.value[h].token==="uri")a={value:!0};else if(a.value[h].token==="literal"&&b.value[h].token==="literal"&&a.value[h].type==null&&b.value[h].type==null)if(i.runEqualityFunction(a.value[h],b.value[h],[],this,c).value==!0){h++;continue}else a=i.runTotalGtFunction(a.value[h],b.value[h],[]);else if(a.value[h].token==="literal"&&a.value[h].type==null)a={value:!1};else if(b.value[h].token==="literal"&&b.value[h].type==null)a={value:!0};else if(i.runEqualityFunction(a.value[h],
b.value[h],[],this,c).value==!0){h++;continue}else a=i.runTotalGtFunction(a.value[h],b.value[h],[]);return a.value==!0?f==="ASC"?1:-1:f==="ASC"?-1:1}}};E.QueryEngine.prototype.removeDefaultGraphBindings=function(a,b){for(var e=[],c={},h=0;h<b.named.length;h++)c[b.named[h].oid]=!0;for(h=0;h<b.implicit.length;h++)c[b.implicit[h].oid]==null&&e.push(b.implicit[h].oid);e=[];for(h=0;h<a.length;h++){var f=a[h],g=!1,i;for(i in f){for(var r=0;r<c.length;r++)if(f[i]===c[r]){g=!0;break}if(g)break}g||e.push(f)}return e};
E.QueryEngine.prototype.aggregateBindings=function(a,b,e,c){for(var b=this.copyDenormalizedBindings(b,c.outCache),h={},f=0;f<a.length;f++){var g=i.runAggregator(a[f],b,this,e,c);a[f].alias?h[a[f].alias.value]=g:h[a[f].value.value]=g}return h};E.QueryEngine.prototype.projectBindings=function(a,b,e){if(a[0].kind==="*")return b;else{for(var c=[],h=0;h<b.length;h++){for(var f=b[h],g={},n=!0,r=0;r<a.length;r++)if(a[r].token=="variable"&&a[r].kind!="aliased")g[a[r].value.value]=f[a[r].value.value];else if(a[r].token==
"variable"&&a[r].kind=="aliased"){var s=i.runFilter(a[r].expression,f,this,e,{blanks:{},outCache:{}});if(i.isEbvError(s)){n=!1;break}else g[a[r].alias.value]=s}n===!0&&c.push(g)}return c}};E.QueryEngine.prototype.resolveNsInEnvironment=function(a,b){return b.namespaces[a]};E.QueryEngine.prototype.termCost=function(a,b){if(a.token==="uri"){var e=v.lexicalFormBaseUri(a,b);return e==null?0:this.lexicon.resolveUriCost(e)}else return a.token==="literal"?this.lexicon.resolveLiteralCost(v.lexicalFormLiteral(a,
b)):a.token==="blank"?this.lexicon.resolveBlankCost(a.value):a.token==="var"?this.lexicon.oidCounter/3:null};E.QueryEngine.prototype.normalizeTerm=function(a,b,e){if(a.token==="uri")return b=v.lexicalFormBaseUri(a,b),b==null?null:e?this.lexicon.registerUri(b):this.lexicon.resolveUri(b);else if(a.token==="literal")return b=v.lexicalFormLiteral(a,b),a=e?this.lexicon.registerLiteral(b):this.lexicon.resolveLiteral(b);else if(a.token==="blank"){var c=a.value,a=b.blanks[c];a==null&&(a=e?this.lexicon.registerBlank(c):
this.lexicon.resolveBlank(c),b.blanks[c]=a);return a}else return a.token==="var"?a.value:null};E.QueryEngine.prototype.normalizeDatasets=function(a,b){for(var e=0;e<a.length;e++){var c=a[e];if(c.value===this.lexicon.defaultGraphUri)c.oid=this.lexicon.defaultGraphOid;else{var h=this.normalizeTerm(c,b,!1);if(h!=null)c.oid=h;else return null}}return!0};E.QueryEngine.prototype.normalizeQuad=function(a,b,e){var c=null,h=null,f=c=null,g;if(a.graph==null)f=0;else if(g=this.normalizeTerm(a.graph,b,e),g!=
null)f=g,e===!0&&a.graph.token!="var"&&this.lexicon.registerGraph(g);else return null;g=this.normalizeTerm(a.subject,b,e);if(g!=null)c=g;else return null;g=this.normalizeTerm(a.predicate,b,e);if(g!=null)h=g;else return null;g=this.normalizeTerm(a.object,b,e);return g==null?null:{subject:c,predicate:h,object:g,graph:f}};E.QueryEngine.prototype.quadCost=function(a,b){var e=null,c=null,h=null,f=null,f=a.graph==null?this.lexicon.oidCounter/4:this.termCost(a.graph,b),e=this.termCost(a.subject,b),c=this.termCost(a.predicate,
b),h=this.termCost(a.object,b);return f+e+c+h};E.QueryEngine.prototype.denormalizeBindingsList=function(a,b){for(var e=[],c=0;c<a.length;c++){var h=this.denormalizeBindings(a[c],b);e.push(h)}return e};E.QueryEngine.prototype.copyDenormalizedBindings=function(a,b){for(var e=[],c=0;c<a.length;c++){for(var h={},f=a[c],g=v.keys(f),i=0;i<g.length;i++){var r=f[g[i]];if(r==null)h[g[i]]=null;else if(typeof r==="object")h[g[i]]=r;else{var s=b[r];s==null&&(s=this.lexicon.retrieve(r),b[r]=s);h[g[i]]=s}}e.push(h)}return e};
E.QueryEngine.prototype.denormalizeBindings=function(a,b){for(var e=v.keys(a),c=b.outCache,h=0;h<e.length;h++){var f=a[e[h]];if(f==null)a[e[h]]=null;else if(c[f]!=null)a[e[h]]=c[f];else{var g=this.lexicon.retrieve(f);a[e[h]]=g;g.token==="blank"&&(b.blanks[g.value]=f)}}return a};E.QueryEngine.prototype.execute=function(a,b,e,c){a=v.normalizeUnicodeLiterals(a);a=this.abstractQueryTree.parseQueryString(a);if(a==null)b(!1,"Error parsing query string");else if(a.token==="query"&&a.kind=="update"){this.callbacksBackend.startGraphModification();
var h=this;this.executeUpdate(a,function(a,c){h.lexicon.updateAfterWrite&&h.lexicon.updateAfterWrite();a?h.callbacksBackend.endGraphModification(function(){b(a,c)}):(h.callbacksBackend.cancelGraphModification(),b(a,c))})}else a.token==="query"&&a.kind=="query"&&this.executeQuery(a,b,e,c)};E.QueryEngine.prototype.executeQuery=function(a,b,e,c){var h=a.units,f=this,g={blanks:{},outCache:{}};this.registerNsInEnvironment(a.prologue,g);var i=f.abstractQueryTree.parseExecutableUnit(h[0]);if(i.kind==="select")this.executeSelect(i,
g,e,c,function(a,c){a?typeof c==="object"&&c.denorm===!0?b(!0,c.bindings):(c=f.denormalizeBindingsList(c,g),c!=null?b(!0,c):b(!1,c)):b(!1,c)});else if(i.kind==="ask")i.projection=[{token:"variable",kind:"*"}],this.executeSelect(i,g,e,c,function(a,c){a?a?c.length>0?b(!0,!0):b(!0,!1):b(!1,c):b(!1,c)});else if(i.kind==="construct")i.projection=[{token:"variable",kind:"*"}],f=this,this.executeSelect(i,g,e,c,function(a,c){if(a)if(a)if(c=f.denormalizeBindingsList(c,g),c!=null){var e=new t.Graph;if(i.template==
null)i.template={triplesContext:i.pattern};for(var h=1,v=[],y=0;y<c.length;y++){for(var A=c[y],k=0;k<v.length;k++)delete v[k].valuetmp;for(k=0;k<i.template.triplesContext.length;k++){for(var o=["subject","predicate","object"],z=i.template.triplesContext[k],u=0;u<o.length;u++){var C=o[u];if(z[C].token==="blank"&&!(z[C].valuetmp&&z[C].valuetmp!=null)){var E="_:b"+h;h++;z[C].valuetmp=E;v.push(z[C])}}o=t.buildRDFResource(z.subject,A,f,g);u=t.buildRDFResource(z.predicate,A,f,g);z=t.buildRDFResource(z.object,
A,f,g);o!=null&&u!=null&&z!=null&&(u=new t.Triple(o,u,z),e.add(u))}}b(!0,e)}else b(!1,c);else b(!1,c);else b(!1,c)})};E.QueryEngine.prototype.executeSelect=function(a,b,e,c,h){if(a.kind==="select"||a.kind==="ask"||a.kind==="construct"||a.kind==="modify"){var f=a.projection,g=a.dataset,i=a.modifier,r=a.limit,s=a.offset,m=a.order;if(e!=null||c!=null)g.implicit=e||[],g.named=c||[];g.implicit!=null&&g.implicit.length===0&&g.named!=null&&g.named.length===0&&g.implicit.push(this.lexicon.defaultGraphUriTerm);
if(this.normalizeDatasets(g.implicit.concat(g.named),b)!=null)if(c=this.executeSelectUnit(f,g,a.pattern,b),c!=null){if(a.group!=null&&a.group===""){for(var t=!1,e=0;e<a.projection.length;e++)if(a.projection[e].expression!=null&&a.projection[e].expression.expressionType==="aggregate"){t=!0;break}if(t===!0)a.group="singleGroup"}if(a.group&&a.group!="")if(this.checkGroupSemantics(a.group,f)){r=this.groupSolution(c,a.group,g,b);s=[];for(e=0;e<r.length;e++)i=this.aggregateBindings(f,r[e],g,b),s.push(i);
h(!0,{bindings:s,denorm:!0})}else h(!1,"Incompatible Group and Projection variables");else b=this.applyOrderBy(m,c,g,b),f=this.projectBindings(f,b,g),f=this.applyModifier(i,f),g=this.removeDefaultGraphBindings(this.applyLimitOffset(s,r,f),g),h(!0,g)}else h(!1,c);else h(!1,"Error normalizing datasets")}else h(!1,"Cannot execute "+a.kind+" query as a select query")};E.QueryEngine.prototype.groupSolution=function(a,b,e,c){var h=[],f=[],g=!1;if(b==="singleGroup")return[a];else{for(var n=0;n<a.length;n++){for(var r=
a[n],s=!0,m=0;m<b.length;m++){var t=b[m],v=null;if(t.token==="var")v=t.value,g==!1&&h.push(v);else if(t.token==="aliased_expression")if(v=t.alias.value,g==!1&&h.push(v),t.expression.primaryexpression==="var")r[t.alias.value]=r[t.expression.value.value];else if(v=this.copyDenormalizedBindings([r],c.outCache),v=i.runFilter(t.expression,v[0],this,e,c),i.isEbvError(v))s=!1;else{if(v.value!=null)v.value=""+v.value;r[t.alias.value]=v}else v=this.copyDenormalizedBindings([r],c.outCache),v=i.runFilter(t,
v[0],this,c),i.isEbvError(v)?s=!1:(r["groupCondition"+env._i]=v,v="groupCondition"+env._i,g==!1&&h.push(v))}g==!1&&(g=!0);s===!0&&f.push(r)}a={};for(n=0;n<f.length;n++){b=f[n];e="";for(m=0;m<h.length;m++)c=b[h[m]],e+=typeof c==="object"?c.value:c;a[e]==null?a[e]=[b]:a[e].push(b)}var h=[],y;for(y in a)h.push(a[y]);return h}};E.QueryEngine.prototype.executeSelectUnit=function(a,b,e,c){return e.kind==="BGP"?this.executeAndBGP(a,b,e,c):e.kind==="UNION"?this.executeUNION(a,b,e.value,c):e.kind==="JOIN"?
this.executeJOIN(a,b,e,c):e.kind==="LEFT_JOIN"?this.executeLEFT_JOIN(a,b,e,c):e.kind==="FILTER"?(a=this.executeSelectUnit(a,b,e.value,c),a!=null?a=i.checkFilters(e,a,!1,b,c,this):[]):e.kind==="EMPTY_PATTERN"?[]:e.kind==="ZERO_OR_MORE_PATH"||e.kind==="ONE_OR_MORE_PATH"?this.executeZeroOrMorePath(e,b,c):(console.log("Cannot execute query pattern "+e.kind+". Not implemented yet."),null)};E.QueryEngine.prototype.executeZeroOrMorePath=function(a,b,e){var c=[];a.x.token==="var"&&c.push({token:"variable",
kind:"var",value:a.x.value});a.y.token==="var"&&c.push({token:"variable",kind:"var",value:a.y.value});c.length===0&&c.push({token:"variable",kind:"*"});if(a.x.token==="var"&&a.y.token==="var"){var h=this.executeAndBGP(c,b,a.path,e),f={},c=[],g,i,r,s,m=a.x.value;i=a.x;for(var t=a.path,F=0;F<h.length;F++)if(g=h[F][m],f[g]==null){s=this.lexicon.retrieve(g);a.x=s;a.path=this.abstractQueryTree.replace(t,i,s,e);t=v.clone(a.path);i=this.executeZeroOrMorePath(a,b,e);for(var y=0;y<i.length;y++)r=i[y],r[m]=
g,c.push(r);i=s}return c}else if(a.x.token!=="var"&&a.y.token==="var"){f={};g=!0;s=[];for(m=[];g==!0||s.length!==0;){g===!0?(h=this.executeAndBGP(c,b,a.path,e),i=a.x,g=!1):(t=this.lexicon.retrieve(s.pop()),h=a.path,h=this.abstractQueryTree.replace(h,i,t,e),h=this.executeAndBGP(c,b,h,e),i=t);for(F=0;F<h.length;F++)t=h[F][a.y.value],f[t]!==!0&&(r={},r[a.y.value]=t,m.push(r),f[t]=!0,s.push(t))}return m}else throw"Kind of path not supported!";};E.QueryEngine.prototype.executeUNION=function(a,b,e,c){var h=
e[0],f=e[1],g=null,n=null;if(e.length!=2)throw"SPARQL algebra UNION with more than two components";g=this.executeSelectUnit(a,b,h,c);if(g==null)return null;n=this.executeSelectUnit(a,b,f,c);if(n==null)return null;a=da.unionBindings(g,n);return a=i.checkFilters(e,a,!1,b,c,this)};E.QueryEngine.prototype.executeAndBGP=function(a,b,e,c){a=da.executeAndBGPsDPSize(e.value,b,this,c);return a!=null?i.checkFilters(e,a,!1,b,c,this):null};E.QueryEngine.prototype.executeLEFT_JOIN=function(a,b,e,c){var h=e.rvalue,
f=null,g=null,f=this.executeSelectUnit(a,b,e.lvalue,c);if(f==null)return null;g=this.executeSelectUnit(a,b,h,c);if(g==null)return null;a=da.leftOuterJoinBindings(f,g);b=i.checkFilters(e,a,!0,b,c,this);if(f.length>1&&g.length>1){var e=[],c={},n;for(n in f[0])c[n]=!0;for(n in g[0])c[n]!=!0&&e.push(n);f=[];g={};for(c=0;c<b.length;c++)if(b[c].__nullify__===!0){for(h=0;h<e.length;h++)b[c].bindings[e[h]]=null;h=[];a=[];for(n in b[c].bindings)b[c].bindings[n]!=null&&(h.push(n+b[c].bindings[n]),h.sort(),
a.push(h.join("")));if(g[h.join("")]==null){for(h=0;h<a.length;h++)g[a[h]]=!0;f.push(b[c].bindings)}}else for(n in f.push(b[c]),h=[],b[c])h.push(n+b[c][n]),h.sort(),g[h.join("")]=!0;return f}else return b};E.QueryEngine.prototype.executeJOIN=function(a,b,e,c){var h=e.lvalue,f=e.rvalue,g=null,n=null,g=this.executeSelectUnit(a,b,h,c);if(g==null)return null;n=this.executeSelectUnit(a,b,f,c);if(n==null)return null;a=null;if(g.length===0||n.length===0)a=[];else{var a={},r=[],s;for(s in g[0])a[s]=!1;for(s in n[0])a[s]===
!1&&r.push(s);a=r.length==0?da.joinBindings(g,n):this.abstractQueryTree.treeWithUnion(h)||this.abstractQueryTree.treeWithUnion(f)?da.joinBindings(g,n):da.joinBindings2(r,g,n)}return a=i.checkFilters(e,a,!1,b,c,this)};E.QueryEngine.prototype.rangeQuery=function(a,b){var e=this.normalizeQuad(a,b,!1);return e!=null?(e=this.backend.range(new R.Pattern(e)),e==null||e.length==0?[]:e):(console.log("ERROR normalizing quad"),null)};E.QueryEngine.prototype.executeUpdate=function(a,b){var e=a.units,c=this,h=
{blanks:{},outCache:{}};this.registerNsInEnvironment(a.prologue,h);for(var f=0;f<e.length;f++){var g=c.abstractQueryTree.parseExecutableUnit(e[f]);if(g.kind==="insertdata"){for(var i=0;i<g.quads.length;i++){var r=g.quads[i];if(c._executeQuadInsert(r,h)!==!0)return b(!1,error)}b(!0)}else if(g.kind==="deletedata"){for(i=0;i<g.quads.length;i++)r=g.quads[i],this._executeQuadDelete(r,h);b(!0)}else if(g.kind==="modify")this._executeModifyQuery(g,h,b);else if(g.kind==="create")b(!0);else if(g.kind==="load")i=
{uri:v.lexicalFormBaseUri(g.sourceGraph,h)},g.destinyGraph!=null&&(i={uri:v.lexicalFormBaseUri(g.destinyGraph,h)}),c=this,this.rdfLoader.load(g.sourceGraph.value,i,function(a,e){a==!1?(console.log("Error loading graph"),console.log(e),b(!1,"error batch loading quads")):(e=c.batchLoad(e),b(e!=null,e||"error batch loading quads"))});else if(g.kind==="drop")this._executeClearGraph(g.destinyGraph,h,b);else if(g.kind==="clear")this._executeClearGraph(g.destinyGraph,h,b);else throw Error("not supported execution unit");
}};E.QueryEngine.prototype.batchLoad=function(a,b){var e=null,c=null,h=null,f=null,g=0,i=!0,r={},s,m;this.eventsOnBatchLoad&&this.callbacksBackend.startGraphModification();for(var t=0;t<a.length;t++){m=a[t];if(m.subject.uri||m.subject.token==="uri"){if(s=this.lexicon.registerUri(m.subject.uri||m.subject.value),m.subject.uri!=null)m.subject={token:"uri",value:m.subject.uri},delete m.subject.uri}else if(m.subject.literal||m.subject.token==="literal"){if(s=this.lexicon.registerLiteral(m.subject.literal||
m.subject.value),m.subject.literal!=null)m.subject=this.lexicon.parseLiteral(m.subject.literal),delete m.subject.literal}else if(s=r[m.subject.blank||m.subject.value],s==null&&(s=this.lexicon.registerBlank(m.subject.blank||m.subject.value),r[m.subject.blank||m.subject.value]=s),m.subject.token==null)m.subject.token="blank",m.subject.value=m.subject.blank,delete m.subject.blank;e=s;if(m.predicate.uri||m.predicate.token==="uri"){if(s=this.lexicon.registerUri(m.predicate.uri||m.predicate.value),m.predicate.uri!=
null)m.predicate={token:"uri",value:m.predicate.uri},delete m.subject.uri}else if(m.predicate.literal||m.predicate.token==="literal"){if(s=this.lexicon.registerLiteral(m.predicate.literal||m.predicate.value),m.predicate.literal!=null)m.predicate=this.lexicon.parseLiteral(m.predicate.literal),delete m.predicate.literal}else if(s=r[m.predicate.blank||m.predicate.value],s==null&&(s=this.lexicon.registerBlank(m.predicate.blank||m.predicate.value),r[m.predicate.blank||m.predicate.value]=s),m.predicate.token==
null)m.predicate.token="blank",m.predicate.value=m.predicate.blank,delete m.predicate.blank;c=s;if(m.object.uri||m.object.token==="uri"){if(s=this.lexicon.registerUri(m.object.uri||m.object.value),m.object.uri!=null)m.object={token:"uri",value:m.object.uri},delete m.subject.uri}else if(m.object.literal||m.object.token==="literal"){if(m.object.token==="literal")m.object.value=m.object.type!=null?'"'+m.object.value+'"^^<'+m.object.type+">":m.object.lang!=null?'"'+m.object.value+'"@'+m.object.lang:'"'+
m.object.value+'"';s=this.lexicon.registerLiteral(m.object.literal||m.object.value);if(m.object.literal!=null)m.object=this.lexicon.parseLiteral(m.object.literal),delete m.object.literal}else if(s=r[m.object.blank||m.object.value],s==null&&(s=this.lexicon.registerBlank(m.object.blank||m.object.value),r[m.object.blank||m.object.value]=s),m.object.token==null)m.object.token="blank",m.object.value=m.object.blank,delete m.object.blank;h=s;if(m.graph.uri||m.graph.token==="uri"){s=this.lexicon.registerUri(m.graph.uri||
m.graph.value);if(m.graph.uri!=null)m.graph={token:"uri",value:m.graph.uri},delete m.subject.uri;this.lexicon.registerGraph(s)}else if(m.graph.literal||m.graph.token==="literal"){if(s=this.lexicon.registerLiteral(m.graph.literal||m.graph.value),m.predicate.literal!=null)m.predicate=this.lexicon.parseLiteral(m.predicate.literal),delete m.predicate.literal}else if(s=r[m.graph.blank||m.graph.value],s==null&&(s=this.lexicon.registerBlank(m.graph.blank||m.graph.value),r[m.graph.blank||m.graph.value]=s),
m.graph.token==null)m.graph.token="blank",m.graph.value=m.graph.blank,delete m.graph.blank;f=s;s=m;m={subject:e,predicate:c,object:h,graph:f};e=new R.NodeKey(m);c=this.backend.search(e);if(!c)if(c=this.backend.index(e),c==!0)this.eventsOnBatchLoad&&this.callbacksBackend.nextGraphModification(I.added,[s,m]),g+=1;else{i=!1;break}}this.lexicon.updateAfterWrite!=null&&this.lexicon.updateAfterWrite();var v=function(){i?b&&b(!0,g):b&&b(!1,null)};this.eventsOnBatchLoad?this.callbacksBackend.endGraphModification(function(){v()}):
v();return i?g:null};E.QueryEngine.prototype.computeCosts=function(a,b){for(var e=0;e<a.length;e++)a[e]._cost=this.quadCost(a[e],b);return a};E.QueryEngine.prototype._executeModifyQuery=function(a,b,e){var c=this,h=!0,f=null,g=["subject","predicate","object","graph"];a.insert=a.insert==null?[]:a.insert;a["delete"]=a["delete"]==null?[]:a["delete"];v.seq(function(e){var g=[],i=[];a["with"]!=null&&g.push(a["with"]);if(a.using!=null)for(var i=[],m=0;m<a.using.length;m++){var t=a.using[m];t.kind==="named"?
i.push(t.uri):g.push(t.uri)}a.dataset={};a.projection=[{token:"variable",kind:"*"}];c.executeSelect(a,b,g,i,function(a,g){a?(g=c.denormalizeBindingsList(g,b),g!=null?f=g:h=!1):h=!1;return e()})},function(e){var i=a["with"];if(h){for(var s=[],m=0;m<a["delete"].length;m++)for(var t=a["delete"][m],v=0;v<f.length;v++){for(var y={},A=f[v],k=0;k<g.length;k++){var o=g[k];o=="graph"&&t[o]==null?y.graph=i:y[o]=t[o].token==="var"?A[t[o].value]:t[o]}s.push(y)}for(v=0;v<s.length;v++)y=s[v],c._executeQuadDelete(y,
b)}e()},function(e){var i=a["with"];if(h){for(var s=[],m=0;m<a.insert.length;m++)for(var t=a.insert[m],v=0;v<f.length;v++){for(var y={},A=f[v],k=0;k<g.length;k++){var o=g[k];o=="graph"&&t[o]==null?y.graph=i:y[o]=t[o].token==="var"?A[t[o].value]:t[o]}s.push(y)}for(m=0;m<s.length;m++)y=s[m],c._executeQuadInsert(y,b)}e()})(function(){e(h)})};E.QueryEngine.prototype._executeQuadInsert=function(a,b){var e=this.normalizeQuad(a,b,!0);if(e!=null){var c=new R.NodeKey(e),h=this.backend.search(c);return h?h:
(h=this.backend.index(c),h==!0?(this.callbacksBackend.nextGraphModification(I.added,[a,e]),!0):(console.log("ERROR inserting quad"),!1))}else return console.log("ERROR normalizing quad"),!1};E.QueryEngine.prototype._executeQuadDelete=function(a,b){var e=this.normalizeQuad(a,b,!1);if(e!=null){var c=new R.NodeKey(e);this.backend["delete"](c);return this.lexicon.unregister(a,c)==!0?(this.callbacksBackend.nextGraphModification(I.deleted,[a,e]),!0):(console.log("ERROR unregistering quad"),!1)}else return console.log("ERROR normalizing quad"),
!1};E.QueryEngine.prototype._executeClearGraph=function(a,b,e){if(a==="default")this.execute("DELETE { ?s ?p ?o } WHERE { ?s ?p ?o }",e);else if(a==="named"){var c=this,h=this.lexicon.registeredGraphs(!0);if(h!=null){var f=!1;v.repeat(0,h.length,function(a,b){var e=h[b._i],i=arguments.callee;f?a(i,b):c.execute("DELETE { GRAPH <"+e+"> { ?s ?p ?o } } WHERE { GRAPH <"+e+"> { ?s ?p ?o } }",function(c){f=!c;a(i,b)})},function(){e(!f)})}else e(!1,"Error deleting named graphs")}else a==="all"?(c=this,this.execute("CLEAR DEFAULT",
function(a,b){a?c.execute("CLEAR NAMED",e):e(!1,b)})):a.token=="uri"?(a=v.lexicalFormBaseUri(a,b),a!=null?this.execute("DELETE { GRAPH <"+a+"> { ?s ?p ?o } } WHERE { GRAPH <"+a+"> { ?s ?p ?o } }",e):e(!1,"wrong graph URI")):e(!1,"wrong graph URI")};E.QueryEngine.prototype.checkGroupSemantics=function(a,b){if(a==="singleGroup")return!0;for(var e={},c=0;c<a.length;c++){var h=a[c];h.token==="var"?e[h.value]=!0:h.token==="aliased_expression"&&(e[h.alias.value]=!0)}for(c=0;c<b.length;c++)if(h=b[c],h.kind===
"var"){if(e[h.value.value]==null)return!1}else if(h.kind==="aliased"&&h.expression&&h.expression.primaryexpression==="var"&&e[h.expression.value.value]==null)return!1;return!0};E.QueryEngine.prototype.registerDefaultNamespace=function(a,b){this.defaultPrefixes[a]=b};var I={ANYTHING:{token:"var",value:"_"},added:"added",deleted:"deleted",eventsFlushed:"eventsFlushed",CallbacksBackend:function(a){this.aqt=new L.AbstractQueryTree;this.engine=a;this.indexMap={};this.observersMap={};this.queriesIndexMap=
{};this.emptyNotificationsMap={};this.queriesList=[];this.pendingQueries=[];this.matchedQueries=[];this.updateInProgress=null;this.indices=["SPOG","GP","OGS","POG","GSP","OS"];this.componentOrders={SPOG:["subject","predicate","object","graph"],GP:["graph","predicate","subject","object"],OGS:["object","graph","subject","predicate"],POG:["predicate","object","graph","subject"],GSP:["graph","subject","predicate","object"],OS:["object","subject","predicate","graph"]};this.callbackCounter=0;this.callbacksMap=
{};this.callbacksInverseMap={};this.queryCounter=0;this.queriesMap={};this.queriesCallbacksMap={};this.queriesInverseMap={};for(a=0;a<this.indices.length;a++){var b=this.indices[a];this.indexMap[b]={};this.queriesIndexMap[b]={}}}};I.CallbacksBackend.prototype.startGraphModification=function(){this.pendingQueries=[].concat(this.queriesList);this.matchedQueries=[];if(this.updateInProgress==null)this.updateInProgress={added:[],deleted:[]}};I.CallbacksBackend.prototype.nextGraphModification=function(a,
b){this.updateInProgress[a].push(b)};I.CallbacksBackend.prototype.endGraphModification=function(a){var b=this;if(this.updateInProgress!=null){var e=b.updateInProgress;b.updateInProgress=null;this.sendNotification(I.deleted,e[I.deleted],function(){b.sendNotification(I.added,e[I.added],function(){b.sendEmptyNotification(I.eventsFlushed,null,function(){b.dispatchQueries(function(){a(!0)})})})})}else a(!0)};I.CallbacksBackend.prototype.cancelGraphModification=function(){this.updateInProgress=null};I.CallbacksBackend.prototype.sendNotification=
function(a,b,e){for(var c={},h=0;h<b.length;h++){var f=b[h],g;for(g in this.indexMap){var i=this.indexMap[g],r=this.componentOrders[g];this._searchCallbacksInIndex(i,r,a,f,c);this.pendingQueries.length!=0&&(i=this.queriesIndexMap[g],this._searchQueriesInIndex(i,r,f))}}this.dispatchNotifications(c);e!=null&&e(!0)};I.CallbacksBackend.prototype.sendEmptyNotification=function(a,b,e){for(var c=this.emptyNotificationsMap[a]||[],h=0;h<c.length;h++)c[h](a,b);e()};I.CallbacksBackend.prototype.dispatchNotifications=
function(a){for(var b in a){var e=this.callbacksMap[b],c=a[b][I.deleted];if(c!=null)try{e(I.deleted,c)}catch(h){}for(var f in a[b])if(f!=I.deleted)try{e(f,a[b][f])}catch(g){}}};I.CallbacksBackend.prototype._searchCallbacksInIndex=function(a,b,e,c,h){for(var f=c[1],c=c[0],g=0;g<b.length+1;g++){for(var i=a._||[],r=[],s=0;s<i.length;s++){var m=i[s];this.callbacksMap[m]!=null&&(h[m]=h[m]||{},h[m][e]=h[m][e]||[],h[m][e].push(c),r.push(m))}a._=r;i=b[g];if(a[""+f[i]]!=null)a=a[""+f[i]];else break}};I.CallbacksBackend.prototype.subscribeEmpty=
function(a,b){var e=this.emptyNotificationsMap[a]||[];e.push(b);this.emptyNotificationsMap[a]=e};I.CallbacksBackend.prototype.unsubscribeEmpty=function(a,b){var e=this.emptyNotificationsMap[a];e!=null&&(e=v.remove(e,b));this.emptyNotificationsMap[a]=e};I.CallbacksBackend.prototype.subscribe=function(a,b,e,c,h,f){a=this._tokenizeComponents(a,b,e,c);b={blanks:{},outCache:{}};this.engine.registerNsInEnvironment(null,b);a=this.engine.normalizeQuad(a,b,!0);e=this._indexForPattern(new R.Pattern(a));b=this.componentOrders[e];
e=this.indexMap[e];for(c=0;c<b.length;c++){var g=a[b[c]];if(g==="_"){e._==null&&(e._=[]);this.callbackCounter++;e._.push(this.callbackCounter);this.callbacksMap[this.callbackCounter]=h;this.callbacksInverseMap[h]=this.callbackCounter;break}else c===b.length-1?(e[g]=e[g]||{_:[]},this.callbackCounter++,e[g]._.push(this.callbackCounter),this.callbacksMap[this.callbackCounter]=h,this.callbacksInverseMap[h]=this.callbackCounter):(e[g]=e[g]||{},e=e[g])}f!=null&&f(!0)};I.CallbacksBackend.prototype.unsubscribe=
function(a){var b=this.callbacksInverseMap[a];b!=null&&(delete this.callbacksInverseMap[a],delete this.callbacksMap[b])};I.CallbacksBackend.prototype._tokenizeComponents=function(a,b,e,c){var h={};h.subject=a==null?I.ANYTHING:a.indexOf("_:")==0?{token:"blank",value:a}:{token:"uri",value:a};h.predicate=b==null?I.ANYTHING:{token:"uri",value:b};h.object=e==null?I.ANYTHING:{token:"uri",value:e};h.graph=c==null?I.ANYTHING:{token:"uri",value:c};return h};I.CallbacksBackend.prototype._indexForPattern=function(a){for(var a=
a.indexKey,b=this.indices,e=0;e<b.length;e++)for(var c=b[e],h=this.componentOrders[c],f=0;f<h.length;f++){if(v.include(a,h[f])===!1)break;if(f==a.length-1)return c}return"SPOG"};I.CallbacksBackend.prototype.observeNode=function(){var a,b,e,c;arguments.length===4?(a=arguments[0],b=arguments[1],e=arguments[2],c=arguments[3]):(a=arguments[0],b=this.engine.lexicon.defaultGraphUri,e=arguments[1],c=arguments[2]);b="CONSTRUCT { <"+a+"> ?p ?o } WHERE { GRAPH <"+b+"> { <"+a+"> ?p ?o } }";var h=this,f={blanks:{},
outCache:{}};this.engine.registerNsInEnvironment(null,f);var g=[];this.engine.execute(b,function(b,i){if(b){var s=!1,m=function(a,b){if(a==="eventsFlushed"&&s){s=!1;try{e(i)}catch(c){}}else if(a!=="eventsFlushed"){s=!0;for(var n=0;n<b.length;n++){var k=b[n],m=t.buildRDFResource(k.subject,g,h.engine,f),v=t.buildRDFResource(k.predicate,g,h.engine,f),k=t.buildRDFResource(k.object,g,h.engine,f);m!=null&&v!=null&&k!=null&&(k=new t.Triple(m,v,k),a===I.added?i.add(k):a===I.deleted&&i.remove(k))}}};h.observersMap[e]=
m;h.subscribeEmpty(I.eventsFlushed,m);h.subscribe(a,null,null,null,m,function(){try{e(i)}catch(a){}c&&c(!0)})}else c&&c(!1)})};I.CallbacksBackend.prototype.stopObservingNode=function(a){return(a=this.observersMap[a])?(this.unsubscribe(a),this.unsubscribeEmpty(I.eventsFlushed,a),!0):!1};I.CallbacksBackend.prototype.observeQuery=function(a,b,e){var c=this.aqt.collectBasicTriples(this.aqt.parseSelect(this.aqt.parseQueryString(a).units[0])),h={blanks:{},outCache:{}};this.engine.registerNsInEnvironment(null,
h);var f,g,i,r=this.queryCounter;this.queryCounter++;this.queriesMap[r]=a;this.queriesInverseMap[a]=r;this.queriesList.push(r);this.queriesCallbacksMap[r]=b;for(var s=0;s<c.length;s++){g=c[s];if(g.graph==null)g.graph=this.engine.lexicon.defaultGraphUriTerm;g=this.engine.normalizeQuad(g,h,!0);f=new R.Pattern(g);i=this._indexForPattern(f);f=this.componentOrders[i];i=this.queriesIndexMap[i];for(var m=0;m<f.length;m++){var t=g[f[m]];if(typeof t==="string"){i._==null&&(i._=[]);i._.push(r);break}else m===
f.length-1?(i[t]=i[t]||{_:[]},i[t]._.push(r)):(i[t]=i[t]||{},i=i[t])}}this.engine.execute(a,function(a,c){a?b(c):console.log("ERROR in query callback "+c)});e!=null&&e()};I.CallbacksBackend.prototype.stopObservingQuery=function(a){var b=this.queriesInverseMap[a];if(b!=null)delete this.queriesInverseMap[a],delete this.queriesMap[b],this.queriesList=v.remove(this.queriesList,b)};I.CallbacksBackend.prototype._searchQueriesInIndex=function(a,b,e){for(var e=e[1],c=0;c<b.length+1;c++){for(var h=a._||[],
f=[],g=0;g<h.length;g++){var i=h[g];v.include(this.pendingQueries,i)&&(v.remove(this.pendingQueries,i),this.matchedQueries.push(i));this.queriesMap[i]!=null&&f.push(i)}a._=f;h=b[c];if(a[""+e[h]]!=null)a=a[""+e[h]];else break}};I.CallbacksBackend.prototype.dispatchQueries=function(a){var b=this,e,c,h,f,g={};v.repeat(0,this.matchedQueries.length,function(a,i){e=arguments.callee;h=b.matchedQueries[i._i];g[h]==null?(g[h]=!0,c=b.queriesMap[h],f=b.queriesCallbacksMap[h],v.recur(function(){b.engine.execute(c,
function(b,c){if(b)try{f(c)}catch(g){}a(e,i)})})):a(e,i)},function(){a()})};var K={};try{typeof Worker=="undefined"&&(Worker=null)}catch(kc){Worker=null}if(Worker)K.RDFStoreClient=function(a,b,e){console.log("trying to load "+a);this.connection=Worker.Worker?new Worker.Worker(a):new Worker(a);this.callbacksCounter=1;var c=this;this.rdf=t.rdf;console.log("The worker");console.log(this.connection);c=this;this.connection.onmessage=function(a){c.receive(a)};this.observingCallbacks={};this.callbacks={0:{cb:function(a,
b){a===!0?e(!0,c):e(!1,b)},fn:"create"}};this.connection.postMessage({fn:"create",args:b,callback:"0"})},K.RDFStoreClient.prototype.receive=function(a){a=a.data||a;if(a.fn==="workerRequest:NetworkTransport:load"){var b=this,e=a.callback,a=a.arguments.concat(function(a,c){b.connection.postMessage({fn:"workerRequestResponse",results:[a,c],callback:e})});P.load.apply(P,a)}else{var c=this.callbacks[a.callback];c&&(c.fn==="create"||c.fn==="execute"||c.fn==="insert"||c.fn=="graph"||c.fn==="node"||c.fn===
"insert"||c.fn==="delete"||c.fn==="clear"||c.fn==="load"||c.fn==="startObservingQueryEndCb"||c.fn==="registeredGraphs"?(delete this.callbacks[a.callback],c.cb(a.success,a.result)):c.fn==="startObservingQuery"?c.cb(a.result):c.fn==="startObservingNode"?c.cb(a.result):c.fn==="subscribe"&&c.cb(a.event,a.result))}},K.RDFStoreClient.prototype.registerCallback=function(a,b){var e=""+this.callbacksCounter;this.callbacks[e]={fn:a,cb:b};this.callbacksCounter++;return e},K.RDFStoreClient.prototype.execute=
function(){if(arguments.length===3)this.executeWithEnvironment(arguments[0],arguments[1],arguments[2]);else if(arguments.length===4)this.executeWithEnvironment(arguments[0],arguments[1],arguments[2],arguments[3]);else{var a,b;arguments.length===1?(a=arguments[0],b=function(){}):arguments.length===2&&(a=arguments[0],b=arguments[1]);b=this.registerCallback("execute",b);this.connection.postMessage({fn:"execute",args:[a],callback:b})}},K.RDFStoreClient.prototype.insert=function(){var a,b,e;if(arguments.length===
1)b=arguments[0],this.connection.postMessage({fn:"insert",args:[b]});else if(arguments.length===2)b=arguments[0],e=arguments[1]||function(){},e=this.registerCallback("insert",e),this.connection.postMessage({fn:"insert",args:[b],callback:e});else if(arguments.length===3)b=arguments[0],a=arguments[1],e=arguments[2]||function(){},e=this.registerCallback("insert",e),this.connection.postMessage({fn:"insert",args:[b,a],callback:e});else throw"The triples to insert, an optional graph and callback must be provided";
},K.RDFStoreClient.prototype.graph=function(){var a=null,b=null;if(arguments.length===1)b=arguments[0]||function(){};else if(arguments.length===2)b=arguments[1]||function(){},a=arguments[0];else throw"An optional graph URI and a callback function must be provided";var e=this,c=this.registerCallback("insert",function(a,c){if(a){for(var g,i=0;i<c.triples.length;i++)g=c.triples[i],c.triples[i]=new t.Triple(e.adaptJSInterface(g.subject),e.adaptJSInterface(g.predicate),e.adaptJSInterface(g.object));b(a,
e.rdf.createGraph(c.triples))}else b(a,c)});a==null?this.connection.postMessage({fn:"graph",args:[],callback:c}):this.connection.postMessage({fn:"graph",args:[a],callback:c})},K.RDFStoreClient.prototype.node=function(){var a=null,b=null,e=null;if(arguments.length===2)e=arguments[0],b=arguments[1]||function(){};else if(arguments.length===3)e=arguments[0],a=arguments[1],b=arguments[2]||function(){};else throw"An optional graph URI and a callback function must be provided";var c=this,h=this.registerCallback("insert",
function(a,e){if(a){for(var h,i=0;i<e.triples.length;i++)h=e.triples[i],e.triples[i]=new t.Triple(c.adaptJSInterface(h.subject),c.adaptJSInterface(h.predicate),c.adaptJSInterface(h.object));b(a,c.rdf.createGraph(e.triples))}else b(a,e)});a==null?this.connection.postMessage({fn:"node",args:[e],callback:h}):this.connection.postMessage({fn:"node",args:[e,a],callback:h})},K.RDFStoreClient.prototype.setPrefix=function(a,b){this.rdf.setPrefix(a,b);this.connection.postMessage({fn:"rdf/setPrefix",args:[a,
b],callback:null})},K.RDFStoreClient.prototype.setDefaultPrefix=function(a){this.rdf.setDefaultPrefix(a);this.connection.postMessage({fn:"rdf/setDefaultPrefix",args:[a],callback:null})},K.RDFStoreClient.prototype["delete"]=function(){var a,b,e;if(arguments.length===1)b=arguments[0],this.connection.postMessage({fn:"delete",args:[b]});else if(arguments.length===2)b=arguments[0],e=arguments[1]||function(){},e=this.registerCallback("delete",e),this.connection.postMessage({fn:"delete",args:[b],callback:e});
else if(arguments.length===3)b=arguments[0],a=arguments[1],e=arguments[2]||function(){},e=this.registerCallback("delete",e),this.connection.postMessage({fn:"delete",args:[b,a],callback:e});else throw"The triples to delete, an optional graph and callback must be provided";},K.RDFStoreClient.prototype.clear=function(){var a,b;if(arguments.length===1)b=arguments[0]||function(){},b=this.registerCallback("clear",b),this.connection.postMessage({fn:"clear",args:[],callback:b});else if(arguments.length===
2)a=arguments[0],b=arguments[1]||function(){},b=this.registerCallback("clear",b),this.connection.postMessage({fn:"clear",args:[a],callback:b});else throw"The optional graph and a callback must be provided";},K.RDFStoreClient.prototype.setBatchLoadEvents=function(a){this.connection.postMessage({fn:"setBatchLoadEvents",args:[a]})},K.RDFStoreClient.prototype.registerDefaultNamespace=function(a,b){this.connection.postMessage({fn:"registerDefaultNamespace",args:[a,b]})},K.RDFStoreClient.prototype.registerDefaultProfileNamespaces=
function(){this.connection.postMessage({fn:"registerDefaultProfileNamespaces",args:[]})},K.RDFStoreClient.prototype.load=function(){var a,b,e,c;if(arguments.length===3)a=arguments[0],b=arguments[1],c=arguments[2]||function(){},c=this.registerCallback("load",c),this.connection.postMessage({fn:"load",args:[a,b],callback:c});else if(arguments.length===4)a=arguments[0],b=arguments[1],e=arguments[2],c=arguments[3]||function(){},c=this.registerCallback("load",c),this.connection.postMessage({fn:"load",args:[a,
b,e],callback:c});else if(arguments.length===2)throw"The mediaType of the parser, the data a callback and an optional graph must be provided";},K.RDFStoreClient.prototype.startObservingQuery=function(a,b,e){e!=null?(b=this.registerCallback("startObservingQuery",b),this.observingCallbacks[a]=b,e=this.registerCallback("startObservingQueryEndCb",e),this.connection.postMessage({fn:"startObservingQuery",args:[a],callback:[b,e]})):(b=this.registerCallback("startObservingQuery",b),this.observingCallbacks[a]=
b,this.connection.postMessage({fn:"startObservingQuery",args:[a],callback:[b]}))},K.RDFStoreClient.prototype.stopObservingQuery=function(a){var b=this.observingCallbacks[a];delete this.observingCallbacks[a];delete this.callbacks[b];this.connection.postMessage({fn:"stopObservingQuery",args:[a],callback:[]})},K.RDFStoreClient.prototype.startObservingNode=function(){var a,b,e;if(arguments.length===2){a=arguments[0];e=arguments[1];var c=this,h=this.registerCallback("startObservingNode",function(a){for(var b,
h=0;h<a.triples.length;h++)b=a.triples[h],a.triples[h]=new t.Triple(c.adaptJSInterface(b.subject),c.adaptJSInterface(b.predicate),c.adaptJSInterface(b.object));e(c.rdf.createGraph(a.triples))});this.observingCallbacks[e]=h;this.connection.postMessage({fn:"startObservingNode",args:[a],callback:h})}else arguments.length===3&&(a=arguments[0],b=arguments[1],e=arguments[2],c=this,h=this.registerCallback("startObservingNode",function(a){for(var b,h=0;h<a.triples.length;h++)b=a.triples[h],a.triples[h]=new t.Triple(c.adaptJSInterface(b.subject),
c.adaptJSInterface(b.predicate),c.adaptJSInterface(b.object));e(c.rdf.createGraph(a.triples))}),this.observingCallbacks[e]=h,this.connection.postMessage({fn:"startObservingNode",args:[a,b],callback:h}))},K.RDFStoreClient.prototype.stopObservingNode=function(a){var b=this.observingCallbacks[a];delete this.observingCallbacks[a];delete this.callbacks[b];this.connection.postMessage({fn:"stopObservingNode",args:[b],callback:[]})},K.RDFStoreClient.prototype.subscribe=function(a,b,e,c,h){var f=this,g=this.registerCallback("subscribe",
function(a,b){for(var c,e=0;e<b.length;e++)c=b[e],b[e]=new t.Triple(f.adaptJSInterface(c.subject),f.adaptJSInterface(c.predicate),f.adaptJSInterface(c.object));h(a,b)});this.observingCallbacks[h]=g;this.connection.postMessage({fn:"subscribe",args:[a,b,e,c],callback:g})},K.RDFStoreClient.prototype.unsubscribe=function(a){var b=this.observingCallbacks[a];delete this.observingCallbacks[a];delete this.callbacks[b];this.connection.postMessage({fn:"unsubscribe",args:[b],callback:[]})},K.RDFStoreClient.prototype.registeredGraphs=
function(a){var b=this;this.connection.postMessage({fn:"registeredGraphs",args:[],callback:this.registerCallback("registeredGraphs",function(e,c){if(e)for(var h=0;h<c.length;h++)c[h]=b.adaptJSInterface(c[h]);a(e,c)})})},K.RDFStoreClient.prototype.adaptJSInterface=function(a){if(a.interfaceName==="BlankNode")return new t.BlankNode(a.bnodeId);else if(a.interfaceName==="Literal")return new t.Literal(a.nominalValue,a.language,a.datatype);else if(a.interfaceName==="NamedNode")return new t.NamedNode(a.nominalValue)},
K.RDFStoreClient.prototype.isWebWorkerConnection=!0;var C={},lb={MongodbQueryEngine:function(){throw"MongoDB backend not supported in the browser version";}};C.VERSION="0.7.0";C.connect=function(){var a,b,e;arguments.length==1&&(a=__dirname,b={},e=arguments[0]);arguments.length==2?(typeof arguments[0]==="string"?(a=arguments[0],b={}):(a=__dirname+"/index.js",b=arguments[0]),e=arguments[1]):(a=arguments[0],b=arguments[1],e=arguments[2]);try{Worker?new K.RDFStoreClient(a,b,function(a,b){e(a,b)}):C.create(b,
function(a){e(!1,a)})}catch(c){C.create(b,function(a){e(!1,a)})}};C.create=function(){return arguments.length==1?new C.Store(arguments[0]):arguments.length==2?new C.Store(arguments[0],arguments[1]):new C.Store};C.Store=function(a,b){var e=null,c=null;if(arguments.length==0)c={};else if(arguments.length==1)c={},e=a;else if(arguments.length>1)c=a,e=b;else throw"An optional argument map and a callback must be provided";c.treeOrder==null&&(c.treeOrder=15);this.functionMap={};var h=this;this.customFns=
{};c.engine==="mongodb"?(this.isMongodb=!0,this.engine=new lb.MongodbQueryEngine(c),this.engine.readConfiguration(function(){c.overwrite===!0?h.engine.clean(function(){e(h)}):e(h)})):new M.Lexicon(function(a){c.overwrite===!0&&a.clear();new V.QuadBackend(c,function(b){c.overwrite===!0&&b.clear();c.backend=b;c.lexicon=a;h.engine=new E.QueryEngine(c);e&&e(h)})},c.name)};C.Store.prototype.rdf=t.rdf;C.Store.prototype.rdf.api=t;C.Store.prototype.registerCustomFunction=function(a,b){this.customFns[a]=b;
this.engine.setCustomFunctions(this.customFns)};C.Store.prototype.execute=function(){if(arguments.length===3)this.executeWithEnvironment(arguments[0],arguments[1],arguments[2]);else if(arguments.length===4)this.executeWithEnvironment(arguments[0],arguments[1],arguments[2],arguments[3]);else{var a,b;arguments.length===1?(a=arguments[0],b=function(){}):arguments.length===2&&(a=arguments[0],b=arguments[1]);this.engine.execute(a,b)}};C.Store.prototype.executeWithEnvironment=function(){var a,b,e;if(arguments.length===
3){a=arguments[0];var c=function(){};b=arguments[1];e=arguments[2]}else arguments.length===4&&(a=arguments[0],c=arguments[3],b=arguments[1],e=arguments[2]);for(var h=[],f=[],g=0;g<b.length;g++)h.push({token:"uri",value:b[g]});for(g=0;g<e.length;g++)f.push({token:"uri",value:e[g]});this.engine.execute(a,c,h,f)};C.Store.prototype.graph=function(){var a=null,b=null;if(arguments.length===1)b=arguments[0]||function(){},a=this.engine.lexicon.defaultGraphUri;else if(arguments.length===2)b=arguments[1]||
function(){},a=arguments[0];else throw"An optional graph URI and a callback function must be provided";this.rdf.resolve(a)!=null&&(a=this.rdf.resolve(a));this.engine.execute("CONSTRUCT { ?s ?p ?o } WHERE { GRAPH <"+a+"> { ?s ?p ?o } }",b)};C.Store.prototype.node=function(){var a=null,b=null,e=null;if(arguments.length===2)e=arguments[0],b=arguments[1]||function(){},a=this.engine.lexicon.defaultGraphUri;else if(arguments.length===3)e=arguments[0],a=arguments[1],b=arguments[2]||function(){};else throw"An optional graph URI, node URI and a callback function must be provided";
this.rdf.resolve(a)!=null&&(a=this.rdf.resolve(a));this.rdf.resolve(e)!=null&&(e=this.rdf.resolve(e));this.engine.execute("CONSTRUCT { <"+e+"> ?p ?o } WHERE { GRAPH <"+a+"> { <"+e+"> ?p ?o } }",b)};C.Store.prototype.startObservingNode=function(){var a,b,e;arguments.length===2?(a=arguments[0],e=arguments[1],this.engine.callbacksBackend.observeNode(a,e,function(){})):arguments.length===3&&(a=arguments[0],b=arguments[1],e=arguments[2],this.engine.callbacksBackend.observeNode(a,b,e,function(){}))};C.Store.prototype.stopObservingNode=
function(a){this.engine.callbacksBackend.stopObservingNode(a)};C.Store.prototype.startObservingQuery=function(a,b,e){e!=null?this.engine.callbacksBackend.observeQuery(a,b,e):this.engine.callbacksBackend.observeQuery(a,b,function(){})};C.Store.prototype.stopObservingQuery=function(a){this.engine.callbacksBackend.stopObservingQuery(a)};C.Store.prototype.subscribe=function(a,b,e,c,h){var f=this,g=function(a,b){for(var c=[],e={blanks:{},outCache:{}},g=[],i=0;i<b.length;i++){var v=b[i],A=t.buildRDFResource(v.subject,
g,f.engine,e),k=t.buildRDFResource(v.predicate,g,f.engine,e),v=t.buildRDFResource(v.object,g,f.engine,e);A!=null&&k!=null&&v!=null&&(v=new t.Triple(A,k,v),c.push(v))}h(a,c)};this.functionMap[h]=g;this.engine.callbacksBackend.subscribe(a,b,e,c,g,function(){})};C.Store.prototype.unsubscribe=function(a){this.engine.callbacksBackend.unsubscribe(this.functionMap[a]);delete this.functionMap[a]};C.Store.prototype.setPrefix=function(a,b){this.rdf.setPrefix(a,b)};C.Store.prototype.setDefaultPrefix=function(a){this.rdf.setDefaultPrefix(a)};
C.Store.prototype.insert=function(){var a,b,e;if(arguments.length===1)b=arguments[0];else if(arguments.length===2)a=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),b=arguments[0],e=arguments[1]||function(){};else if(arguments.length===3)b=arguments[0],a=this.rdf.createNamedNode(arguments[1]),e=arguments[2]||function(){};else throw"The triples to insert, an optional graph and callback must be provided";var c="",h=this;b.forEach(function(a){c=c+h._nodeToQuery(a.subject)+h._nodeToQuery(a.predicate)+
h._nodeToQuery(a.object)+"."});c=a!=null?"INSERT DATA { GRAPH "+this._nodeToQuery(a)+" { "+c+" } }":"INSERT DATA { "+this._nodeToQuery(a)+" { "+c+" }";this.engine.execute(c,e)};C.Store.prototype._nodeToQuery=function(a){if(a.interfaceName==="NamedNode"){var b=this.rdf.resolve(a.valueOf());return b!=null?"<"+b+">":"<"+a.valueOf()+">"}else{if(a.interfaceName!=="")if(a.lang!=null)return'"'+a.valueOf()+'"@'+a.lang;else if(a.datatype!=null)return'"'+a.valueOf()+'"^^<'+a.datatype+">";return a.toString()}};
C.Store.prototype["delete"]=function(){var a,b,e;if(arguments.length===1)b=arguments[0];else if(arguments.length===2)a=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),b=arguments[0],e=arguments[1]||function(){};else if(arguments.length===3)b=arguments[0],a=this.rdf.createNamedNode(arguments[1]),e=arguments[2]||function(){};else throw"The triples to delete, an optional graph and callback must be provided";var c="",h=this;b.forEach(function(a){c=c+h._nodeToQuery(a.subject)+h._nodeToQuery(a.predicate)+
h._nodeToQuery(a.object)+"."});c=a!=null?"DELETE DATA { GRAPH "+this._nodeToQuery(a)+" { "+c+" } }":"DELETE DATA { "+this._nodeToQuery(a)+" { "+c+" }";this.engine.execute(c,e)};C.Store.prototype.clear=function(){var a,b;if(arguments.length===0)a=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),b=function(){};else if(arguments.length===1)a=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),b=arguments[0]||function(){};else if(arguments.length===2)a=this.rdf.createNamedNode(arguments[0]),
b=arguments[1]||function(){};else throw"The optional graph and a callback must be provided";this.engine.execute("CLEAR GRAPH "+this._nodeToQuery(a),b)};C.Store.prototype.setBatchLoadEvents=function(a){this.engine.eventsOnBatchLoad=a};C.Store.prototype.registerDefaultNamespace=function(a,b){this.rdf.prefixes.set(a,b);this.engine.registerDefaultNamespace(a,b)};C.Store.prototype.registerDefaultProfileNamespaces=function(){var a=this.rdf.prefixes.values(),b;for(b in a)this.registerDefaultNamespace(b,
a[b])};C.Store.prototype.load=function(){var a,b,e,c;if(arguments.length===3)e=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),a=arguments[0],b=arguments[1],c=arguments[2]||function(){};else if(arguments.length===4)a=arguments[0],b=arguments[1],e=this.rdf.createNamedNode(arguments[2]),c=arguments[3]||function(){};else if(arguments.length===2)throw"The mediaType of the parser, the data a callback and an optional graph must be provided";if(a==="remote")b=this.rdf.createNamedNode(b),this.engine.execute("LOAD <"+
b.valueOf()+"> INTO GRAPH <"+e.valueOf()+">",c);else if(b&&typeof b==="string"&&b.indexOf("file://")===0){a=this.engine.rdfLoader.parsers[a];var h=this;this.engine.rdfLoader.loadFromFile(a,{token:"uri",value:e.valueOf()},b,function(a,b){a?h.engine.batchLoad(b,c):c(a,b)})}else a=this.engine.rdfLoader.parsers[a],h=this,this.engine.rdfLoader.tryToParse(a,{token:"uri",value:e.valueOf()},b,function(a,b){a?h.engine.batchLoad(b,c):c(a,b)})};C.Store.prototype.registerParser=function(a,b){this.engine.rdfLoader.registerParser(a,
b)};C.Store.prototype.registeredGraphs=function(a){if(this.isMongodb)this.engine.registeredGraphs(!0,function(b){for(var c=[],e=0;e<b.length;e++){var h=new t.NamedNode(b[e]);c.push(h)}return a(!0,c)});else{for(var b=this.engine.lexicon.registeredGraphs(!0),e=[],c=0;c<b.length;c++){var h=new t.NamedNode(b[c]);e.push(h)}return a(!0,e)}};C.Store.prototype._nodeToQuery=function(a){if(a.interfaceName==="NamedNode"){var b=this.rdf.resolve(a.valueOf());return b!=null?"<"+b+">":"<"+a.valueOf()+">"}else return a.toString()};
C.Store.prototype.getNetworkTransport=function(){return P};C.Store.prototype.setNetworkTransport=function(a){P=a};C.Store.prototype.close=function(a){a==null&&(a=function(){});this.engine.close?this.engine.close(a):a()};RDFStoreWorker={observingCallbacks:{},workerCallbacksCounter:0,workerCallbacks:{}};RDFStoreWorker.registerCallback=function(a){var b=""+RDFStoreWorker.workerCallbacksCounter;RDFStoreWorker.workerCallbacksCounter++;RDFStoreWorker.workerCallbacks[b]=a;return b};RDFStoreWorker.handleCreate=
function(a,b){typeof P!="undefined"&&P!=null&&(P={load:function(a,b,e){var g=RDFStoreWorker.registerCallback(function(a){e.apply(e,a)});postMessage({fn:"workerRequest:NetworkTransport:load",callback:g,arguments:[a,b]})},loadFromFile:function(){}});var e=[a];e.push(function(a){RDFStoreWorker.store=a;postMessage({callback:b,result:"created",success:!0})});C.create.apply(C,e)};RDFStoreWorker.receive=function(a){var b=a.data||a;if(b.fn==="workerRequestResponse"){var e=b.callback,c=RDFStoreWorker.workerCallbacks[e];
c!=null&&(delete RDFStoreWorker.workerCallbacks[e],c(b.results))}else if(b.fn==="create"&&b.args!=null)RDFStoreWorker.handleCreate(b.args,b.callback);else if(b.fn==="setBatchLoadEvents")RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args);else if(b.fn==="registerDefaultNamespace")RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args);else if(b.fn==="registerDefaultProfileNamespaces")RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args);else if((b.fn==="execute"||b.fn==="executeWithEnvironment"||
b.fn==="graph"||b.fn==="node"||b.fn==="clear"||b.fn==="load")&&b.args!=null){b.args.push(function(a,c){b.callback!=null&&postMessage({callback:b.callback,result:c,success:a})});try{RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args)}catch(h){console.log("Error executing method through connection"),console.log(h)}}else if((b.fn==="insert"||b.fn==="delete")&&b.args!=null)try{b.args.push(function(a,c){b.callback!=null&&postMessage({callback:b.callback,result:c,success:a})});c=b.args[0];for(a=
0;a<c.triples.length;a++)e=c.triples[a],c.triples[a]=new t.Triple(RDFStoreWorker.adaptJSInterface(e.subject),RDFStoreWorker.adaptJSInterface(e.predicate),RDFStoreWorker.adaptJSInterface(e.object));b.args[1].interfaceName!=null&&(b.args[1]=RDFStoreWorker.adaptJSInterface(b.args[1]));b.args[0]=RDFStoreWorker.store.rdf.createGraph(c.triples);RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args)}catch(f){console.log("Error executing method through connection"),console.log(f)}else b.fn==="rdf/setPrefix"&&
b.args!=null?RDFStoreWorker.store.rdf.setPrefix(b.args[0],b.args[1]):b.fn==="rdf/setDefaultPrefix"&&b.args!=null?RDFStoreWorker.store.rdf.setDefaultPrefix(b.args[0]):b.fn==="startObservingQuery"&&b.args!=null?(e=function(a,c){postMessage({callback:b.callback[0],result:c,success:a})},RDFStoreWorker.observingCallbacks[b.args[0]]=e,b.args.push(e),b.args.push(function(a,c){b.callback&&b.callback[1]!=null&&postMessage({callback:b.callback[1],result:c,success:a})}),RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,
b.args)):b.fn==="stopObservingQuery"?((e=RDFStoreWorker.observingCallbacks[b.args[0]])&&RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,[e]),delete RDFStoreWorker.observingCallbacks[b.args[0]]):b.fn==="startObservingNode"&&b.args!=null?(e=function(a){postMessage({callback:b.callback,result:a})},RDFStoreWorker.observingCallbacks[b.callback]=e,b.args.push(e),RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args)):b.fn==="stopObservingNode"&&b.args!=null?((e=RDFStoreWorker.observingCallbacks[b.args[0]])&&
RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,[e]),delete RDFStoreWorker.observingCallbacks[b.args[0]]):b.fn==="subscribe"&&b.args!=null?(e=function(a,c){postMessage({callback:b.callback,event:a,result:c})},RDFStoreWorker.observingCallbacks[b.callback]=e,b.args.push(e),RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args)):b.fn==="stopObservingNode"&&b.args!=null?((e=RDFStoreWorker.observingCallbacks[b.args[0]])&&RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,[e]),delete RDFStoreWorker.observingCallbacks[b.args[0]]):
b.fn==="registeredGraphs"&&b.args!=null&&RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,[function(a,c){b.callback!=null&&postMessage({callback:b.callback,result:c,success:a})}])};RDFStoreWorker.adaptJSInterface=function(a){if(a.interfaceName==="BlankNode")return new t.BlankNode(a.bnodeId);else if(a.interfaceName==="Literal")return new t.Literal(a.nominalValue,a.language,a.datatype);else if(a.interfaceName==="NamedNode")return new t.NamedNode(a.nominalValue)};onmessage=RDFStoreWorker.receive;
try{window.rdfstore=C}catch(lc){}})();
